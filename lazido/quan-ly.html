<!DOCTYPE html>
<html lang="vi" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

<head>
    <meta charset="utf-8">
    <meta name="geo.region" content="vi">
    <meta name="language" content="vi">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>LOZIDO - Quản lý nhà cho thuê</title>
    <meta name="keywords"
        content="Phần mềm nhà trọ, phần mềm phòng trọ, phần mềm quản lý nhà trọ, phần mềm quản lý nhà trọ, quản lý nhà trọ, quản lý trọ, quản lý phòng trọ">
    <meta name="description"
        content="Phần mềm quản lý nhà  trọ trên điện thoại, máy tính, máy tính bảng, iPad hỗ trợ chủ nhà quản lý nhà trọ, phòng trọ, ký túc xá  dễ dàng và tiện lợi mọi lúc mọi nơi, tiết kiệm thời gian và công sức">

    <meta name="robots" content="noindex, nofollow" />
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="csrf-token" content="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">

    <meta name="author" content="LOZIDO - Quản lý nhà cho thuê">
    <meta name="copyright" content="LOZIDO - Quản lý nhà cho thuê - Platform Quan ly nha tro, phong tro">
    <meta name="abstract" content="Phần mềm quản lý nhà trọ, phòng trọ, ký túc xá, chung cư tốt nhất hiện nay">

    <meta property="og:image" content="https://quanlytro.me/householder-admin/images/lozido_facebook-recovered.jpg">
    <meta property="og:image:secure_url"
        content="https://quanlytro.me/householder-admin/images/lozido_facebook-recovered.jpg">
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="370">
    <meta property="og:image:type" content="image/webp">

    <link rel="shortcut icon" href="https://quanlytro.me/images/favicon.ico" type="image/x-icon">
    <link rel="alternate" href="https://quanlytro.me/quan-ly" hreflang="vi-vn" />

    <script type="text/javascript">
        var recaptcha_site_key = '6Ld0LAYeAAAAABA67PAls5DpnkfNJ-rkgHbsSilR';
        var __environment = 'production';
    </script>

    <script src="https://quanlytro.me/plugins/jquery-3.6.0/jquery.min.js"></script>
    <script src="https://quanlytro.me/plugins/jquery-3.6.0/jquery-ui-1.8.13.min.js"></script>
    <script src="https://quanlytro.me/plugins/feather.min.js"></script>
    <!-- <script src="https://quanlytro.me/plugins/sweetalert2@11"></script> -->
    <!-- <script src="https://quanlytro.me/bootstrap-5.0/js/popper.min.js"></script> -->
    <script src="https://quanlytro.me/bootstrap-5.0/js/bootstrap.min.js"></script>

    <!-- <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/helper.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/format.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/route-api.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/index.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/transporter.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/upload-image.js?version=1.3.8"></script> -->
    <!-- <style>
        .modal.show .btn-close {
            outline: 0;
            box-shadow: 0 0 0 .25rem rgb(255 87 34 / 9%);
            opacity: 1;
            border-radius: 100%;
            padding: 10px;
        }
        .btn{
            font-size: 14px!important;
            font-weight: 600!important;
        }
    </style> -->
    <!-- <script type="text/javascript">
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        var __current_block = JSON.parse(JSON.stringify({"id":7081,"name":"ASUS","name_full":"Nh\u00e0 tr\u1ecd ASUS","user_id":8151,"category":0,"category_name":"Nh\u00e0 tr\u1ecd","category_name_short":"Nh\u00e0 tr\u1ecd","room_type":"room","room_type_name":"ph\u00f2ng","type":"floors","room_total":6,"count_floor":2,"area":15,"room_amount":36,"ele_amount":0,"water_amount":0,"price_items_cache":[{"id":23351,"name":"Ti\u1ec1n \u0111i\u1ec7n","type":"constant","unit":"kwh","price":1700,"rooms":[{"id":102158,"name":"Ph\u00f2ng 1","sort":null,"value":102158,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102159,"name":"Ph\u00f2ng 2","sort":null,"value":102159,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102160,"name":"Ph\u00f2ng 3","sort":null,"value":102160,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102161,"name":"Ph\u00f2ng 4","sort":null,"value":102161,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102162,"name":"Ph\u00f2ng 5","sort":null,"value":102162,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102163,"name":"Ph\u00f2ng 6","sort":null,"value":102163,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"}],"value":null,"frames":[],"status":"is_active","history":null,"user_id":8151,"block_id":7081,"category":"ele","type_text":"Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh","unit_text":"KWh","is_default":1,"status_text":"\u0110ang s\u1eed d\u1ee5ng","subtraction":1},{"id":23352,"name":"Ti\u1ec1n n\u01b0\u1edbc","type":"constant","unit":"khoi","price":18000,"rooms":[{"id":102158,"name":"Ph\u00f2ng 1","sort":null,"value":102158,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102159,"name":"Ph\u00f2ng 2","sort":null,"value":102159,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102160,"name":"Ph\u00f2ng 3","sort":null,"value":102160,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102161,"name":"Ph\u00f2ng 4","sort":null,"value":102161,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102162,"name":"Ph\u00f2ng 5","sort":null,"value":102162,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102163,"name":"Ph\u00f2ng 6","sort":null,"value":102163,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"}],"value":null,"frames":[],"status":"is_active","history":null,"user_id":8151,"block_id":7081,"category":"water","type_text":"Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh","unit_text":"Kh\u1ed1i","is_default":1,"status_text":"\u0110ang s\u1eed d\u1ee5ng","subtraction":1}],"circle_order":6,"deadline_bill":10,"bill_setting":{"note":{"content":null},"enable_qr":1,"payment_default":"cash","show_circle_day":0,"single_send_zalo":0,"template_bill_zalo":1,"enable_rounding_money":1,"extract_receipt_expense":0},"app_renter_setting":{"allow_update_car":1,"default_password":123456789,"allow_close_clock":0,"auto_create_account":0,"allow_ticket_contract":1,"allow_update_customer":1},"room_group":[{"id":1,"name":"T\u1ea7ng tr\u1ec7t","index":0,"label":"T\u1ea7ng tr\u1ec7t","value":1},{"id":2,"name":"T\u1ea7ng 1","index":1,"label":"T\u1ea7ng 1","value":2}],"max_member":1,"open_door":null,"close_door":null,"rule":null,"extension":null,"data_log":{"menu_label":{"pay_bill":0,"room_list":"0\/6","new_session":6,"deposit_request":6,"terminate_contract":0}},"setting":{"car_function":1,"post_function":1,"agent_function":1,"asset_function":1,"price_item_ele":3,"price_item_wifi":0,"price_item_trash":0,"price_item_water":3,"task_job_function":1,"send_sms_when_create_bill":1,"contract_document_function":0},"province_id":72,"district_id":712,"ward_id":25732,"address_component":{"address":"63, An T\u1ecbnh, Tr\u1ea3ng B\u00e0ng, T\u00e2y Ninh","ward_id":"25732","position":{"latitude":"10.7829132","longitude":"106.6961898"},"district_id":"712","province_id":"72","address_detail":"63"},"address":"63, An T\u1ecbnh, Tr\u1ea3ng B\u00e0ng, T\u00e2y Ninh","latitude":10.7829132,"longitude":106.6961898,"auto_create_room":1,"post_ids":[]}));

        var __permission_block = JSON.parse(JSON.stringify(null));

        let user = JSON.parse(JSON.stringify({"staff":false,"free":false,"trial":true,"fee":false}));
       
    </script> -->
    <link href="/bootstrap-5.0/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="/householder-admin/css/common.cssversion=1.3.8.css" rel="stylesheet">
    <link href="/householder-admin/css/block.cssversion=1.3.8.css" rel="stylesheet">
</head>

<body>
    <div id="app_loading" class="text-center" style="padding:40vh 10px">
        <div class="inner-loading">
            <img style="margin: auto" src="https://quanlytro.me/images/icons/loading.gif" alt="Đang tải..."
                width="50px" />
            <i class="loading_text" style="font-size: 13px; margin-top: -10px;">Đang tải dữ liệu...</i>
        </div>
    </div>
    <header>
        <div class="header-inner">
            <div class="header-sticky">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <div class="container-fluid">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#lozido-main-menu" aria-controls="lozido-main-menu" aria-expanded="false"
                            aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"> </span>
                        </button>
                        <nav class="collapse navbar-collapse lozido-main-menu">
                            <ul class="navbar-nav main-menu-left  me-auto mb-2 mb-lg-0">
                                <li class="nav-item menu-item active">
                                    <a href="/" class="nav-link ">
                                        <i data-feather="arrow-left"></i>
                                        <img width="180px" src="/images/logo-lozido-quan-ly-tro-white.png" />
                                    </a>
                                </li>
                            </ul>

                            <ul class="topbar-items main-menu-right navbar-nav">
                                <li class="nav-item menu-item active">
                                    <a href="/quan-ly.html" class="nav-link ">
                                        <i data-feather="home"></i>
                                        <span style="margin-top: 5px" class="text">Quản lý nhà</span>
                                    </a>
                                </li>
                                <li class="nav-item menu-item ">
                                    <a href="/bao-cao.html" class="nav-link ">
                                        <i data-feather="pie-chart"></i>
                                        <span style="margin-top: 5px" class="text">Tổng báo cáo</span>
                                    </a>
                                </li>
                                <li class="nav-item menu-item ">
                                    <a href="/dang-tin.html" class="nav-link ">
                                        <i data-feather="plus"></i>
                                        <span style="margin-top: 5px" class="text">Đăng tin</span>
                                    </a>
                                </li>
                                <li class="nav-item menu-item ">
                                    <a href="/moi-gioi.html" class="nav-link ">
                                        <i data-feather="users"></i>
                                        <span style="margin-top: 5px" class="text">Môi giới</span>
                                    </a>
                                </li>
                                <li class="nav-item menu-item ">
                                    <a href="/phan-quyen.html" class="nav-link ">
                                        <i data-feather="box"></i>
                                        <span style="margin-top: 5px" class="text">Công ty/nhóm</span>
                                    </a>
                                </li>
                                <li class="nav-item menu-item ">
                                    <a href="/cai-dat.html" class="nav-link ">
                                        <i data-feather="settings"></i>
                                        <span style="margin-top: 5px" class="text">Cài đặt chung</span>
                                    </a>
                                </li>
                                <li class="nav-item btn-group menu-item ">
                                    <a href="javascript:;" class="nav-link" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        <span class="count-notification badge">0</span>
                                        <i data-feather="bell"></i>
                                        <span style="margin-top: 5px" class="text">Thông báo</span>
                                    </a>
                                    <ul class="dropdown-menu notication-dropdown dropdown-menu-lg-end">
                                        <div class="text-center" style="padding: 20px">
                                            <img style="margin: auto" src="/images/icons/loading.gif" alt="Đang tải..."
                                                width="50px" />
                                            <div>
                                                <i class="loading_text" style="font-size: 13px; margin-top: -10px;">Đang
                                                    tải thông báo...</i>
                                            </div>
                                        </div>
                                    </ul>
                                </li>

                                <li class="nav-item menu-item ">
                                    <a href="/tai-khoan.html" class="nav-link ">
                                        <i data-feather="user"></i>
                                        <span style="margin-top: 5px" class="text">Tài khoản</span>
                                    </a>
                                </li>
                                <li class="nav-item menu-item ">
                                    <a href="/dang-xuat.html" class="nav-link ">
                                        <i data-feather="log-out"></i>
                                        <span style="margin-top: 5px" class="text">Đăng xuất</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    <div>
        <div>
            <style type="text/css">
                .scrollable-content {
                    overflow-x: auto;
                    white-space: nowrap;
                    flex: 1;
                    position: relative;
                    scroll-behavior: smooth;
                    /* Thêm hiệu ứng cuộn mượt */
                }

                .scrollable-content-container button {
                    color: #fff;
                    border: none;
                    cursor: pointer;
                    transition: opacity 0.3s ease;
                    position: absolute;
                    top: 50%;
                    height: 96%;
                    width: 50px;
                    transform: translateY(-50%);
                    z-index: 1;
                }

                .scrollable-content-container button::before {
                    content: "";
                    position: absolute;
                    top: 50%;
                    left: 10px;
                    transform: translateY(-50%);
                    width: 30px;
                    height: 30px;
                    border-radius: 100%;
                    background: #000;
                    z-index: -1;
                }

                .scrollable-content-container button:hover::before {
                    background-color: #2f8932;
                }

                .scrollable-content-container button.hidden {
                    opacity: 0;
                    pointer-events: none;
                    /* Ngăn chặn sự kiện chuột khi ẩn */
                }

                .scrollable-content-container .scroll-left {
                    left: 0px;
                    flex: 0 0 auto;
                    background: linear-gradient(to right, rgb(255 255 255), rgb(255 255 255 / 0%));
                }

                .scrollable-content-container .scroll-right {
                    right: 0px;
                    flex: 0 0 auto;
                    background: linear-gradient(to left, rgb(255 255 255), rgb(255 255 255 / 0%));
                }
            </style>

            <div style="min-height: 125px;display: flex;padding: 0px 10px 0px 0px;">
                <div class="col-md-2 d-flex align-items-center justify-content-center" style="margin-right: 10px;">
                    <div class="current-block d-flex align-items-center" style="position: relative"
                        data-bs-toggle="modal" data-bs-target="#manageBlock">
                        <div class="d-flex align-items-center" style="flex-direction: row; flex:1">
                            <div class="icon-blocks">
                                <span class="count-block">1</span>
                                <i data-feather="home" class="feather-size-18"> </i>
                            </div>

                            <div style="padding: 20px 0px 20px 5px; flex:1">
                                <span style="font-size: 12px;">Đang quản lý</span>
                                <h4
                                    style="font-size: 14px; color: #15a05c; padding:0px; margin:0px; white-space: nowrap;max-width: 150px; overflow: hidden; text-overflow: ellipsis; ">
                                    <span>Nhà trọ ASUS</span>
                                </h4>
                            </div>
                        </div>
                        <button class="shadow" id="add-block" style="position: absolute;
                        right: -14px;
                        top: 29px;
                        border-radius: 100%;
                        height: 35px;
                        width: 35px;
                        text-align: center;
                        padding: 0px;
                        background-color: #7dc343;
                        color: #fff;
                        border: 1px solid #7dc443;
                        z-index: 10;" data-bs-toggle="modal" data-bs-target="#addBlock">
                            <span data-bs-toggle="tooltip" data-bs-placement="top" title="Thêm mới nhà cho thuê">
                                <i data-feather="plus"> </i>
                            </span>
                        </button>
                    </div>
                </div>
                <div class="col-md-10" style="align-items: center; justify-content: space-between; display: flex;">
                    <div class=" scrollable-content-container"
                        style="position: relative; align-items: center; justify-content: space-between; display: flex;overflow: hidden;">
                        <button class="scroll-left">←</button>
                        <div style="display: flex; flex-wrap: nowrap; overflow-x: auto; position: relative;"
                            class="scrollable-content">
                            <a href="/quan-ly" class="item-menu active">
                                <div class="icon text-center">
                                    <img width=55px src="/images/icons/menus/thu_tien.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Quản lý phòng</b></span>
                                </div>
                            </a>
                            <a href="/quan-ly/option/lap-phieu-thu.html" class="item-menu">
                                <div class="icon text-center">
                                    <img width=55px src="/images/icons/menus/thu_tien.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Quản lý hóa đơn</b></span>
                                </div>
                            </a>
                            <a href="/quan-ly/option/quan-ly-dich-vu.html" class="item-menu">
                                <div class="icon text-center">
                                    <img width=55px src="/images/icons/menus/ghi_chu.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Quản lý dịch vụ</b></span>
                                </div>
                            </a>
                            <a href="/quan-ly/option/quan-ly-tai-san.html" class="item-menu">
                                <div class="icon text-center">
                                    <img width=55px src="/images/icons/menus/ghi_chu.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Quản lý tài sản</b></span>
                                </div>
                            </a>
                            <a href="/quan-ly/option/tat-ca-hop-dong.html" class="item-menu">
                                <div class="icon text-center">
                                    <img width=55px src="/images/icons/menus/report_customer_use.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Quản lý hợp đồng</b></span>
                                </div>
                            </a>
                            <a href="/quan-ly/option/tat-ca-khach-thue.html" class="item-menu">
                                <div class="icon text-center">
                                    <img width=55px src="/images/icons/menus/danh_sach_lien_he.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Quản lý khách thuê</b></span>
                                </div>
                            </a>
                            <a href="/quan-ly/option/thu-chi-tong-ket.html" class="item-menu">
                                <div class="icon text-center">
                                    <img width=55px src="/images/icons/menus/thu_tien.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Thu/Chi - Tổng kết</b></span>
                                </div>
                            </a>
                            <a href="/quan-ly/option/cai-dat-nha-tro.html" class="item-menu">
                                <div class="icon text-center">
                                    <img width=55px src="/images/icons/menus/setting.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Cài đặt</b></span>
                                </div>
                            </a>
                            <a href="/quan-ly/option/lich-su-gui-zalo.html" class="item-menu">
                                <div class="icon text-center">
                                    <img width=45px src="/images/icons/icon-zalo.png" />
                                </div>
                                <div class="key">
                                    <span class="title"><b>Lịch sử gửi zalo</b></span>
                                </div>
                            </a>
                        </div>
                        <button class="scroll-right">→</button>
                    </div>
                </div>
            </div>

            <script type="text/javascript">
                const $scrollableContent = $('.scrollable-content');
                const $scrollLeft = $('.scroll-left');
                const $scrollRight = $('.scroll-right');

                function updateButtonVisibility() {
                    const scrollLeft = $scrollableContent.scrollLeft();
                    const scrollWidth = $scrollableContent[0].scrollWidth - 10;
                    const clientWidth = $scrollableContent[0].clientWidth;

                    $scrollLeft.toggleClass('hidden', scrollLeft === 0);
                    $scrollRight.toggleClass('hidden', scrollLeft + clientWidth >= scrollWidth);
                }

                $scrollLeft.click(function () {
                    $scrollableContent.animate({ scrollLeft: 0 }, 100); // Hiệu ứng cuộn mượt
                });

                $scrollRight.click(function () {
                    const scrollWidth = $scrollableContent[0].scrollWidth - 10;
                    $scrollableContent.animate({ scrollLeft: scrollWidth }, 100); // Hiệu ứng cuộn mượt
                });

                $scrollableContent.on('scroll', updateButtonVisibility);

                updateButtonVisibility(); // Cập nhật trạng thái nút khi trang được tải
            </script>
            <div
                style="padding:15px 15px 15px 15px; background-color: #fff; border-radius: 10px; margin: 0 10px 10px 10px">
                <style>
                    .box-home,
                    .item-home {
                        position: relative;
                    }

                    .icon-home {
                        border-radius: 100%;
                        width: 60px;
                        height: 60px;
                        background: hsla(0, 0%, 100%, .2);
                        color: #fff;
                        text-align: center;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-right: 15px;
                    }

                    .icon-warning {
                        display: flex;
                        background-color: #ffe9e9;
                        border-radius: 100%;
                        color: red;
                        width: 50px;
                        height: 50px;
                        align-items: center;
                        justify-content: center;
                        margin-right: 15px;
                    }

                    .item-home .title {
                        flex: 1;
                    }

                    .item-home h3 {
                        font-size: 20px;
                        margin-top: 5px;
                        font-weight: bold
                    }

                    .item-home h3 span {
                        font-size: 18px;
                    }

                    .create-home {
                        position: absolute;
                        bottom: 10px;
                        right: 10px;
                        border-radius: 40px 0 0 0px;
                        width: 60px;
                        height: 55px;
                        background: hsla(0, 0%, 100%, .2);
                        z-index: 2;
                        color: #fff;
                        text-align: center;
                    }

                    .create-home span {
                        width: 40px;
                        height: 40px;
                        line-height: 30px;
                        background: #fff;
                        text-align: center;
                        color: #000;
                        border-radius: 50%;
                        display: flex;
                        margin: 8px 0 0 17px;
                        justify-content: center;
                        align-items: center;
                        border: 0.5px solid #ccc;
                    }

                    .box-home {
                        padding: 15px;
                        border-radius: 10px;
                        color: #fff !important;
                        display: block;
                        background-color: #ffffff !important;
                        border: 0.5px solid #eeeeee;
                        box-shadow: 0 4px 6px 0 rgb(0 0 0 / 6%);
                    }

                    .bt-home {
                        width: 60px;
                        height: 60px;
                        line-height: 60px;
                        text-align: center;
                        border-radius: 10px;
                        font-size: 30px;
                        margin: 0 0 20px 0;
                        background: hsla(0, 0%, 100%, .2);
                    }

                    .box-banner-home {
                        border-radius: 10px;
                        color: #fff;
                        overflow: hidden;
                    }

                    .txt-banner-home {
                        width: 70%;
                        float: left;
                        padding: 20px;
                    }

                    .box-banner-home img {
                        width: 30%;
                        float: left;
                    }

                    .txt-banner-home a {
                        text-decoration: underline;
                        color: #fff;
                    }

                    .span-purple {
                        background-color: #8433e5;
                    }

                    .span-blue {
                        background-color: #03a9f4;
                    }

                    .span-pink {
                        background-color: #ff046d;
                    }


                    .span-primary {
                        background-color: #3ca05c;
                    }

                    .span-primary-white {
                        background-color: #d0ffdf;
                        color: #3ca05c !important;
                    }

                    .span-primary-white .icon-home {
                        color: #3ca05c !important;
                    }

                    .span-primary-white .icon-home {
                        background: hsl(139deg 100% 94.84%) !important
                    }

                    .span-green {
                        background-color: #8bc34a;
                    }

                    .span-yellow {
                        background-color: #ff9800;
                    }

                    .span-blue-2 {
                        background-color: #018dff;
                    }

                    .span-red {
                        background-color: #ff6161;
                    }

                    .span-gray {
                        background-color: #696464;
                    }

                    .span-red-white {
                        background-color: #fff4f4;
                        color: red !important;
                    }

                    .span-red-white .icon-home {
                        color: red !important;
                    }

                    .span-red-white .icon-home {
                        background: hsl(0deg 100% 90.2% / 20%) !important;
                    }

                    .span-yellow-white {
                        background-color: #ffc1072e;
                        color: #ff4b00 !important;
                    }

                    .span-yellow-white .icon-home {
                        color: #ff4b00 !important;
                    }

                    .span-yellow-white .icon-home {
                        background: hsl(36deg 100% 50% / 40%) !important
                    }

                    .tabulator-menu.tabulator-popup-container {
                        width: 40%;
                        display: table;
                    }

                    .tabulator-menu .tabulator-menu-item {
                        width: 50%;
                        flex: 1;
                        display: inline-block;
                    }
                </style>

                <div class="page-home">
                    <!-- Report -->
                    <div>
                        <div class="row g-3 row-box-home" style="margin-top: 0px;">
                            <div class="col-sm-3" style="margin-top:0">
                                <div class="item-home" data-bs-toggle="modal" data-bs-target="#reportBillDebt">
                                    <a href="javascript:;" class="create-home">
                                        <span><i data-feather="arrow-right"></i></span>
                                    </a>
                                    <a href="javascript:;" class="box-home span-red-white">
                                        <div class="d-flex align-items-center">
                                            <span class="icon-home">
                                                <img width="36px"
                                                    src="https://img.icons8.com/?size=100&amp;id=2Sa1k4ZpFptq&amp;format=png">
                                            </span>
                                            <div>
                                                <span class="title">
                                                    Tổng số tiền khách nợ
                                                </span>
                                                <h3>0đ</h3>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>

                            <div class="col-sm-3" style="margin-top:0">
                                <div class="item-home" data-bs-toggle="modal" data-bs-target="#reportContractDeposit">
                                    <a href="javascript:;" class="create-home">
                                        <span><i data-feather="arrow-right"></i></span>
                                    </a>
                                    <a href="javascript:;" class="box-home span-primary-white">
                                        <div class="d-flex align-items-center">
                                            <span class="icon-home">
                                                <img width="36px"
                                                    src="https://img.icons8.com/?size=100&amp;id=lxOi5Rk3GnMh&amp;format=png">
                                            </span>
                                            <div>
                                                <span class="title">
                                                    Tổng số tiền cọc
                                                </span>
                                                <h3>0đ</h3>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <div class="col-sm-3" style="margin-top:0">
                                <div class="item-home" data-bs-toggle="modal" data-bs-target="#reportDepositTemp">
                                    <a href="javascript:;" class="create-home">
                                        <span><i data-feather="arrow-right"></i></span>
                                    </a>
                                    <a href="javascript:;" class="box-home span-primary-white">
                                        <div class="d-flex align-items-center">
                                            <span class="icon-home">
                                                <img width="36px"
                                                    src="https://img.icons8.com/?size=100&amp;id=VLkxUf20RHGE&amp;format=png">
                                            </span>
                                            <div>
                                                <span class="title">
                                                    Tổng số tiền cọc giữ chỗ phòng
                                                </span>
                                                <h3>0đ</h3>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>

                            <div class="col-sm-3" style="margin-top:0">
                                <div class="item-home report">
                                    <a href="javascript:;" class="create-home">
                                        <span><i data-feather="arrow-right"></i></span>
                                    </a>
                                    <a href="javascript:;" class="box-home span-red-white">
                                        <div class="d-flex align-items-center">
                                            <span class="icon-home">
                                                <img width="36px"
                                                    src="https://img.icons8.com/?size=48&amp;id=yjYAciFYtvzW&amp;format=png">
                                            </span>
                                            <div>
                                                <span class="title">
                                                    Sự cố phòng
                                                </span>
                                                <h3>0 Vấn đề</h3>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Tab panes -->
                    <div class="tab-pane" id="manage" role="tabpanel" aria-labelledby="manage-tab">
                        <style>
                            .tabulator-row.done-background {
                                background-color: #4caf5029 !important
                            }

                            .tabulator-row.cancel-background {
                                background-color: #eeeeee82 !important
                            }

                            .tabulator-row.enable-background {
                                background-color: #ff57220f !important
                            }
                        </style>
                        <div style="margin-top: 30px;" row>
                            <div class="header-item">
                                <h4 class="title-item">
                                    Quản lý danh sách phòng
                                    <i class="des">Tất cả danh sách phòng trong Nhà trọ ASUS</i>
                                </h4>
                                <div style="display: flex">
                                    <a href="https://www.youtube.com/watch?v=AH-YrGOP-zI" target="_blank"
                                        data-bs-toggle="tooltip" data-bs-placement="left"
                                        title="Video tổng quan phần mềm" style="width: 50px;
            height: 50px;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, .15);
            border-radius: 50px; margin-right: 15px">
                                        <img width="50px" height="50px"
                                            src="/householder-admin/images/video-play-icon.png" />
                                    </a>
                                    <button class="add-round" data-bs-toggle="modal" data-bs-target="#addRoom">
                                        <span data-bs-toggle="tooltip" data-bs-placement="left" title="Thêm phòng">
                                            <i data-feather="plus"> </i>
                                        </span>
                                    </button>

                                    <div class="d-flex" style="margin-left: 40px;">
                                        <div class="dropdown">
                                            <button style="height: 100%" class="btn btn-primary dropdown-toggle"
                                                type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"
                                                aria-expanded="false">
                                                <i data-feather="file-text"> </i>
                                                Ẩn/Hiện cột
                                                <span id="count_exclude_column"
                                                    style="position: absolute;top: -12px;right: -10px;background-color: #dc3545;font-size: 12px;width: 20px;height: 20px;display: flex;align-items: center;justify-content: center;border-radius: 5px;color: #fff;">0</span>
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton"
                                                id="list-show-column">
                                                <li>
                                                    <label class="dropdown-item">
                                                        <input type="checkbox" checked class="form-check-input"
                                                            name="group_id" value="group_id"> Nhóm
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="dropdown-item">
                                                        <input type="checkbox" checked class="form-check-input"
                                                            name="deposit_contract_amount"
                                                            value="deposit_contract_amount"> Mức tiền cọc
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="dropdown-item">
                                                        <input type="checkbox" checked class="form-check-input"
                                                            name="debt_amount" value="debt_amount"> Tiền nợ
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="dropdown-item">
                                                        <input type="checkbox" checked class="form-check-input"
                                                            name="customers" value="customers"> Khách thuê
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="dropdown-item">
                                                        <input type="checkbox" checked class="form-check-input"
                                                            name="circle_day" value="circle_day"> Ngày lập hóa đơn
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="dropdown-item">
                                                        <input type="checkbox" checked class="form-check-input"
                                                            name="circle_month" value="circle_month"> Chu kỳ thu tiền
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="dropdown-item">
                                                        <input type="checkbox" checked class="form-check-input"
                                                            name="date_join" value="date_join"> Ngày vào ở
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="dropdown-item">
                                                        <input type="checkbox" checked class="form-check-input"
                                                            name="date_terminate" value="date_terminate"> Thời hạn hợp
                                                        đồng
                                                    </label>
                                                </li>
                                            </ul>
                                        </div>
                                        <button id="download-excel" style="margin-left: 10px"
                                            class="ml-2 btn btn-primary">
                                            <i data-feather="file-text"> </i>
                                            Xuất excel
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="header-table header-item" style="padding:10px 10px">
                                <div class="d-flex">
                                    <div class="icon">
                                        <i data-feather="filter"> </i>
                                        <span id="filter-count">0</span>
                                    </div>
                                    <div class="d-flex" style="flex-wrap: wrap;">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="is_active"
                                                data-value="status" value="is_active">
                                            <label class="form-check-label" for="is_active">Đang ở</label>
                                            <span class="count-filter active success">0</span>
                                        </div>

                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="is_empty"
                                                data-value="status" value="is_empty">
                                            <label class="form-check-label" for="is_empty">Đang trống</label>
                                            <span class="count-filter empty error">0</span>
                                        </div>

                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="is_terminate_contract"
                                                data-value="status" value="is_terminate_contract">
                                            <label class="form-check-label" for="is_terminate_contract">Đang báo kết
                                                thúc </label>
                                            <span class="count-filter tick-terminate warning">0</span>
                                        </div>

                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                id="is_will_terminate_contract" data-value="status"
                                                value="is_will_terminate_contract">
                                            <label class="form-check-label" for="is_will_terminate_contract">Sắp hết hạn
                                                hợp đồng</label>
                                            <span class="count-filter will-terminate warning">0</span>
                                        </div>

                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="is_expire"
                                                data-value="status" value="is_expire">
                                            <label class="form-check-label" for="is_expire">Đã quá hạn hợp đồng</label>
                                            <span class="count-filter expire disable">0</span>
                                        </div>

                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="is_deposit_temp"
                                                data-value="status" value="is_deposit_temp">
                                            <label class="form-check-label" for="is_deposit_temp">Đang cọc giữ
                                                chỗ</label>
                                            <span class="count-filter deposit-temp warning">0</span>
                                        </div>

                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="active_status"
                                                data-value="active_status" value="debt_bill,has_bill">
                                            <label class="form-check-label" for="active_status">Đang nợ tiền</label>
                                            <span class="count-filter debt error">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="buttom-save-container">
                                <div style="margin-right: 10px">Bạn có <span id="count-edit">0</span> mục thay đổi bạn
                                    có muốn lưu ?</div>
                                <div id="clear-change" class="btn btn-danger" style="margin-right: 10px"><i
                                        data-feather="x"> </i> Xóa tất cả
                                    thay đổi</div>
                                <div id="save-change" class="btn btn-primary"><i data-feather="save"> </i> Lưu thay đổi
                                </div>
                            </div>

                            <div id="table" class="celled">
                                <div style="border-radius: 10px;">
                                    <div style="border-radius: 10px; padding: 30px; text-align:center">
                                        <img width="200px"
                                            src="https://quanlytro.me/images/empty-box-4085812-3385481.webp" />
                                        <h4>Chưa có phòng/giường nào!</h4>
                                    </div>
                                </div>
                            </div>
                            <script type="text/javascript">
                                $(document).ready(function () {
                                    var __el = {
                                        table: $("#table"),
                                        filter_check: $(".header-item .form-check-input"),
                                        count_filter: $("#filter-count"),
                                        count_edit: $("#count-edit"),
                                        button_save_container: $("#buttom-save-container"),
                                        save_change: $("#save-change"),
                                        clear_change: $("#clear-change"),
                                        download: $("#download-excel")
                                    };

                                    var dataEdited = {};
                                    var groupValues = [];
                                    var tableDataNewSession = {};
                                    var tableDataInit = [];
                                    var tableData = {};
                                    let columns = {};
                                    let filters = {
                                        status: [],
                                        active_status: []
                                    };

                                    //Build Tabulator
                                    let table = new Tabulator(__el.table.get(0), {
                                        index: 'id',
                                        layout: "fitColumns",
                                        resizableColumnFit: true,
                                        //enable reactive data
                                        reactiveData: true,
                                        height: false,
                                        movableRows: true,
                                        columnHeaderVertAlign: 'middle',
                                        groupUpdateOnCellEdit: true,
                                        groupHeader: function (value, count, data, group) {
                                            let findGroupDetail = __helper.array.findObjectInArray(value, 'id', __current_block?.room_group);

                                            if (data.length === 0)
                                                return "<span style='color:red;'>Không có phòng</span>";

                                            return `${findGroupDetail?.name ?? value}<span style='color:#d00; margin-left:10px;'>(${count} phòng)</span> <a style="float: right;margin-left: 50px;color: #0d6efd;text-decoration: underline;" href="/quan-ly/7081/cai-dat-nha-tro">Cài đặt nhóm</a>`;
                                        },
                                        groupHeaderDownload: function (value, count, data, group) {
                                            let findGroupDetail = __helper.array.findObjectInArray(value, 'id', __current_block?.room_group);
                                            return findGroupDetail?.name ?? value;
                                        },
                                        rowFormatter: function (row) {
                                            var data = row.getData();

                                            //'is_terminate_contract','is_empty','is_deposit_temp','is_deposit_temp_terminate','is_active','is_delete','is_achieve'
                                            //'can_not_create_bill','pending_create_bill','debt_bill','has_bill'

                                            if (!['pending_create_bill', 'can_not_create_bill'].includes(row.getData().active_status) || !['is_active'].includes(row.getData().status)) {
                                                row.getElement().classList.add("enable-background");
                                            } else if (['is_active'].includes(row.getData().status)) {
                                                row.getElement().classList.add("done-background");
                                            } else {
                                                row.getElement().classList.add("cancel-background");
                                            }
                                        },
                                        selectable: false,
                                        minHeight: 200,
                                        placeholder: `<div class="empty-table" style="margin: auto; display: inline-grid;"><img width="300px" src="https://quanlytro.me/images/empty-box-4085812-3385481.webp" />Không tìm thấy dữ liệu!</div>`
                                    });

                                    //listen for row move
                                    table.on("rowMoved", function (row) {
                                        tableData = row.getTable().getData().map((item, index) => {
                                            item.sort = index + 1;
                                            if (dataEdited[item.id]) {
                                                let newItemEdit = dataEdited[item.id];
                                                newItemEdit.sort = item.sort;
                                                dataEdited[item.id] = newItemEdit;
                                            } else {
                                                dataEdited[item.id] = item;
                                            }
                                            return item;
                                        });
                                        checkShowEdit();
                                    });

                                    function renderCount() {
                                        __el.count_filter.text(table.getData().length);
                                        if (tableDataInit?.length >= 1) {
                                            $(".count-filter.active").text(__countStatus(tableDataInit, 'is_active'));
                                            $(".count-filter.empty").text(__countStatus(tableDataInit, 'is_empty'));
                                            $(".count-filter.tick-terminate").text(__countStatus(tableDataInit, 'is_terminate_contract'));
                                            $(".count-filter.will-terminate").text(__countStatus(tableDataInit, 'is_will_terminate_contract'));
                                            $(".count-filter.expire").text(__countStatus(tableDataInit, 'is_expire'));
                                            $(".count-filter.deposit-temp").text(__countStatus(tableDataInit, 'is_deposit_temp') + __countStatus(tableDataInit, 'is_deposit_temp_terminate'));
                                            $(".count-filter.debt").text(__countStatus(tableDataInit, 'debt_bill', 'active_status') + __countStatus(tableDataInit, 'has_bill', 'active_status'));
                                        }
                                        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                                        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                                            return new bootstrap.Tooltip(tooltipTriggerEl)
                                        });
                                    }

                                    table.on("renderComplete", function () {
                                        renderCount();
                                    });

                                    table.on("dataChanged", function (data) {
                                        renderCount();
                                    });

                                    table.on("cellEdited", function (cell) {
                                        let dataNew = {
                                            ...cell.getData()
                                        };

                                        //console.log('cell edit: ', cell.getValue(), cell.getInitialValue(), cell.getValue()!=='', cell.getInitialValue(), cell.getInitialValue()===undefined);
                                        if (cell.getValue() !== cell.getInitialValue() && (cell.getValue() !== '' || (cell.getInitialValue() && cell.getInitialValue() === undefined))) {
                                            dataEdited[cell.getData().id] = cell.getData();
                                            $(cell.getRow().getCell('id').getElement()).find('div').addClass("edited");

                                            checkShowEdit();

                                            dataNew.is_edited = true;
                                            cell.getRow().update(dataNew);
                                        }
                                    });

                                    window.roomTable = table;

                                    const prepareColumns = function (column) {
                                        if (column?.clickMenu && typeof commonClickMenu[column?.clickMenu] !== "undefined")
                                            column.clickMenu = commonClickMenu[column?.clickMenu];

                                        if (column?.cellClick && typeof commonCellClick[column?.cellClick] !== "undefined")
                                            column.cellClick = commonCellClick[column?.cellClick];

                                        if (column?.formatter) {
                                            if (column.formatter === 'deposit_contract') {
                                                column.formatter = function (cell, formatterParams) {
                                                    if (cell.getValue() > 0) {
                                                        if (cell.getData().contract) {
                                                            if (cell?.getValue()?.contract?.deposit_contract_amount > cell.getData()?.contract?.real_deposit_contract_amount && cell?.getData()?.contract?.real_deposit_contract_amount > 0) {
                                                                return `<div style="line-height: 100%;width: 100%;"><strong>${__format.currency(cell.getValue())}</strong><div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;"><i style="font-size: 11px;color:${cell.getData().contract.status_text_deposit_contract.color};">(đã thu: ${__format.currency(cell.getData().contract.real_deposit_contract_amount)})</i></div></div>`
                                                            } else {
                                                                return `<div style="line-height: 100%;width: 100%;"><strong>${__format.currency(cell.getValue())}</strong><div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;"><i style="font-size: 11px;color:${cell.getData().contract.status_text_deposit_contract.color};">(${cell.getData().contract.status_text_deposit_contract.text})</i></div></div>`
                                                            }
                                                        } else {
                                                            return `<div style="line-height: 100%;width: 100%;"><strong>${__format.currency(cell.getValue())}</strong><div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;"></div></div>`
                                                        }

                                                    }
                                                    return `<b>0 đ</b>`
                                                };
                                            }

                                            if (column.formatter === 'date') {
                                                if (column.field === 'date_terminate' || column.field === 'date_join') {
                                                    column.formatterParams = {
                                                        default_text: 'Không xác định',
                                                        setCss: function (cell) {
                                                            if (cell.getData().can_new_section) {
                                                                cell.getElement().classList.add("edit_disable");
                                                                cell.getElement().classList.remove("edit_enable");
                                                            } else {
                                                                cell.getElement().classList.remove("edit_disable");
                                                                cell.getElement().classList.add("edit_enable");
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }

                                        if (column?.cellClick === 'viewDetail') {
                                            column.cellClick = function (e, cell) {
                                                window.open(`/quan-ly/${cell.getData().id}/chi-tiet-phong`, '_blank').focus();
                                            }
                                        }

                                        if (__permission_block === null || __permission_block.room.update) {
                                            if (!column?.cssClass) {
                                                if (column?.editor) {
                                                    column.cssClass = "edit_enable"
                                                } else {
                                                    column.cssClass = "edit_disable";
                                                }
                                            }
                                        } else {
                                            column.editable = function (cell) {
                                                return false;
                                            }
                                        }

                                        if (column.editor === 'date') {
                                            if (column.field === 'date_terminate' || column.field === 'date_join') {
                                                column.editorParams = {
                                                    checkEdit: function (cell) {
                                                        if (cell.getData().can_new_section) {
                                                            return false;
                                                        } else {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }

                                        // Loại trừ các cột được thiết lập không hiển thị
                                        let room_exclude_colum = JSON.parse(localStorage.getItem("room_exclude_colum"));
                                        if (room_exclude_colum && room_exclude_colum.includes(column.field)) {
                                            $(`#list-show-column input[type="checkbox"][name="${column.field}"]`).prop('checked', false);
                                            column.visible = false;
                                        }

                                        return column;
                                    };

                                    const checkShowEdit = function () {
                                        dataEdited && Object.keys(dataEdited).length > 0 ?
                                            __el.button_save_container.addClass('show') :
                                            __el.button_save_container.removeClass('show');

                                        __el.count_edit.html(Object.keys(dataEdited)?.length ?? 0);
                                    };

                                    const loadData = (filter = null) => $.transferData({
                                        method: "POST",
                                        data: {
                                            filter: filter ?? null
                                        },
                                        url: __helper.url.urlPattern(__routeApi.room.list, {
                                            block_id: parseInt(7081)
                                        }),
                                        success: (res) => {
                                            if (res?.data?.table_data?.columns) {
                                                columns = res?.data?.table_data?.columns;
                                                tableData = res?.data?.payload;
                                                dataEdited = {};

                                                columns.map((column) => {

                                                    prepareColumns(column);
                                                    if (column?.columns && column.columns.length > 0) {
                                                        column.columns.map((col, index_col) => {
                                                            column.columns[index_col] = prepareColumns(col);
                                                        });
                                                    }
                                                    return column;
                                                });

                                                tableDataNewSession = JSON.parse(JSON.stringify(tableData));
                                                if (!tableDataInit || Object.keys(tableDataInit).length === 0) {
                                                    tableDataInit = [...(res?.data?.payload ?? [])];
                                                }

                                                table.setColumns(columns);
                                                if (__current_block?.room_group.length > 1) {

                                                    __current_block?.room_group.map((item) => {
                                                        groupValues.push(item.value);
                                                    });

                                                    groupValues = [...new Set(groupValues)];

                                                    table.setGroupBy('group_id');
                                                    table.setGroupValues([groupValues]);
                                                }
                                                table.setData(tableData);

                                                // Đếm các cột hiển thị;
                                                $("#count_exclude_column").text($('#list-show-column input[type="checkbox"]:checked').length + 4);

                                                checkShowEdit();
                                            }
                                        },
                                        error: (e) => {
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: 'Đã có lỗi trong quán trình tải danh sách phòng ' + e,
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                        }
                                    });

                                    loadData(null);

                                    __el.filter_check.on('change', (e) => {
                                        let value = e.target.value.split(',');
                                        if (value.length > 1) {
                                            let newData = [...filters[e.target.dataset.value]];
                                            value.map((item) => {
                                                __togglePresent(newData, item);
                                            });

                                            filters[e.target.dataset.value] = newData;
                                        } else {
                                            if (e?.target?.dataset?.value) {
                                                let newData = [...filters[e?.target?.dataset?.value]];
                                                __togglePresent(newData, value[0]);
                                                filters[e.target.dataset.value] = newData;
                                            }
                                        }

                                        // Thực hiện loại trừ các cột
                                        var excludeColum = [];
                                        $('#list-show-column input[type="checkbox"]:not(:checked)').each(function () {
                                            excludeColum.push($(this).val());
                                        });
                                        localStorage.setItem('room_exclude_colum', JSON.stringify(excludeColum));

                                        loadData(filters);
                                    });

                                    __el.clear_change.click(() => {
                                        dataEdited = {};
                                        checkShowEdit();
                                        table.setData(tableDataNewSession);
                                    });

                                    __el.save_change.click(() => {
                                        if (Object.keys(dataEdited).length === 0) {
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: 'Không có gì thay đổi!',
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });

                                            return false;
                                        }

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.room.updateSeries, {
                                                block_id: parseInt(7081)
                                            }),
                                            data: {
                                                data_edited: dataEdited,
                                            },
                                            success: (res) => {
                                                Swal.fire({
                                                    title: 'Thao tác thành công!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonText: 'Đã hiểu'
                                                });

                                                dataEdited = {};
                                                checkShowEdit();


                                                table.getRows().map((row) => {
                                                    $(row.getCell('id').getElement()).find('div').removeClass("edited");
                                                });

                                                table.setData(table.getData().map((item) => {
                                                    item.is_edited = false;
                                                    return item;
                                                }));
                                            },
                                            fail: (res) => {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'warning',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    });

                                    __el.download.click((e) => {
                                        let sheetName = __current_block?.name.slice(0, 30).replace(/[:\.\/?*\[\]]/g, '_');
                                        table.download("xlsx", "danh_sach_phong.xlsx", { sheetName: sheetName });
                                    });

                                    __settingSaveChangeContainer(__el.table);
                                });
                            </script>
                        </div>

                        <!-- Modal -->
                        <div class="modal fade" data-bs-backdrop="static" id="addRoom" tabindex="-1"
                            aria-labelledby="addRoomLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="box"> </i>
                                        </div>
                                        <h5 class="modal-title" id="addRoomLabel">Thêm phòng</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"> </button>
                                    </div>
                                    <div class="modal-body">
                                        <form class="needs-validation" id="add-room-form" novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">
                                                <div class="col-12">
                                                    <div class="title-item-small">
                                                        <b>Thông tin phòng</b>
                                                        <i class="des">Nhập các thông tin cơ bản của
                                                            phòng</i>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="name" id="name"
                                                            required placeholder="Tên phòng">
                                                        <label for="name">Tên phòng</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập tên phòng
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-floating">
                                                        <select data-format="numeric" id="group_id" name="group_id"
                                                            class="form-select form-control" required>
                                                            <option value="1">Tầng trệt</option>
                                                            <option value="2">Tầng 1</option>
                                                        </select>
                                                        <label for="group">Tầng/dãy</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập tên nhóm phòng
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6" style="display: block">
                                                    <div class="form-floating">
                                                        <input data-format="numeric" type="text" value="15"
                                                            class="form-control" min="0" name="area" id="area" required
                                                            placeholder="Nhập diện tích">
                                                        <label for="area">Diện tích (m2)</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập diện tích
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-floating">
                                                        <input data-format="numeric" type="text" class="form-control"
                                                            min="0" name="room_amount" id="room_amount"
                                                            placeholder="Giá thuê" required>
                                                        <label for="room_amount">Giá thuê (đ)</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập giá thuê
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="form-floating">
                                                        <select data-format="numeric" id="circle_day" name="circle_day"
                                                            class="form-select form-control">
                                                            <option value="1">Ngày 1</option>
                                                            <option value="2">Ngày 2</option>
                                                            <option value="3">Ngày 3</option>
                                                            <option value="4">Ngày 4</option>
                                                            <option value="5">Ngày 5</option>
                                                            <option selected value="6">Ngày 6
                                                            </option>
                                                            <option value="7">Ngày 7</option>
                                                            <option value="8">Ngày 8</option>
                                                            <option value="9">Ngày 9</option>
                                                            <option value="10">Ngày 10</option>
                                                            <option value="11">Ngày 11</option>
                                                            <option value="12">Ngày 12</option>
                                                            <option value="13">Ngày 13</option>
                                                            <option value="14">Ngày 14</option>
                                                            <option value="15">Ngày 15</option>
                                                            <option value="16">Ngày 16</option>
                                                            <option value="17">Ngày 17</option>
                                                            <option value="18">Ngày 18</option>
                                                            <option value="19">Ngày 19</option>
                                                            <option value="20">Ngày 20</option>
                                                            <option value="21">Ngày 21</option>
                                                            <option value="22">Ngày 22</option>
                                                            <option value="23">Ngày 23</option>
                                                            <option value="24">Ngày 24</option>
                                                            <option value="25">Ngày 25</option>
                                                            <option value="26">Ngày 26</option>
                                                            <option value="27">Ngày 27</option>
                                                            <option value="28">Ngày 28</option>
                                                            <option value="29">Ngày 29</option>
                                                            <option value="30">Ngày 30</option>
                                                            <option value="31">Ngày 31</option>
                                                        </select>
                                                        <label for="circle_day">Ngày lập hóa đơn hàng tháng</label>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="form-floating">
                                                        <select data-format="numeric" id="priority" name="priority"
                                                            class="form-select form-control">
                                                            <option value="0"> Tất cả</option>
                                                            <option value="1"> Ưu tiên nữ</option>
                                                            <option value="2"> Ưu tiên nam</option>
                                                            <option value="3"> Ưu tiên gia đình</option>
                                                        </select>
                                                        <label for="priority">Ưu tiên người thuê</label>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="title-item-small">
                                                        <b>Dịch vụ sử dụng</b>
                                                        <i class="des">Thêm dịch vụ sử dụng như: điện, nước, rác,
                                                            wifi...</i>
                                                    </div>
                                                    <div class="price-items-checkout-layout">
                                                        <div class="item">
                                                            <div class="item-check-name">
                                                                <input class="form-check-input"
                                                                    id="room_check_price_item_23351" type="checkbox"
                                                                    value="1" name="price_items[23351][is_selected]">

                                                                <label for="room_check_price_item_23351">
                                                                    <b>Tiền điện</b>
                                                                    <p>Giá: <b>1.700đ</b> / KWh</p>
                                                                </label>
                                                            </div>

                                                            <div class="item-value">
                                                                <div class="input-group mb-2">
                                                                    <input class="form-control"
                                                                        id="room_form_room_price_item_23351_0" min="0"
                                                                        type="number" placeholder="Nhập chỉ số hiện tại"
                                                                        required
                                                                        oninput="$(room_form_room_price_item_23351_1).val(this.value)"
                                                                        value="0" name="price_items[23351][value][]">
                                                                    <label style="font-size: 12px"
                                                                        class="input-group-text"
                                                                        for="room_form_room_price_item_23351_0">Chỉ số
                                                                        <br>hiện tại</label>
                                                                </div>
                                                                <div class="input-group" style="display: none">
                                                                    <input class="form-control"
                                                                        id="room_form_room_price_item_23351_1" min="0"
                                                                        type="number"
                                                                        oninput="$(room_form_room_price_item_23351_0).val(this.value)"
                                                                        placeholder="Nhập số mới" required value="0"
                                                                        name="price_items[23351][value][]">
                                                                    <label class="input-group-text"
                                                                        for="room_form_room_price_item_23351_1">Số
                                                                        mới</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="item">
                                                            <div class="item-check-name">
                                                                <input class="form-check-input"
                                                                    id="room_check_price_item_23352" type="checkbox"
                                                                    value="1" name="price_items[23352][is_selected]">

                                                                <label for="room_check_price_item_23352">
                                                                    <b>Tiền nước</b>
                                                                    <p>Giá: <b>18.000đ</b> / Khối</p>
                                                                </label>
                                                            </div>

                                                            <div class="item-value">
                                                                <div class="input-group mb-2">
                                                                    <input class="form-control"
                                                                        id="room_form_room_price_item_23352_0" min="0"
                                                                        type="number" placeholder="Nhập chỉ số hiện tại"
                                                                        required
                                                                        oninput="$(room_form_room_price_item_23352_1).val(this.value)"
                                                                        value="0" name="price_items[23352][value][]">
                                                                    <label style="font-size: 12px"
                                                                        class="input-group-text"
                                                                        for="room_form_room_price_item_23352_0">Chỉ số
                                                                        <br>hiện tại</label>
                                                                </div>
                                                                <div class="input-group" style="display: none">
                                                                    <input class="form-control"
                                                                        id="room_form_room_price_item_23352_1" min="0"
                                                                        type="number"
                                                                        oninput="$(room_form_room_price_item_23352_0).val(this.value)"
                                                                        placeholder="Nhập số mới" required value="0"
                                                                        name="price_items[23352][value][]">
                                                                    <label class="input-group-text"
                                                                        for="room_form_room_price_item_23352_1">Số
                                                                        mới</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                            <i data-feather="x"> </i>
                                            Đóng
                                        </button>
                                        <button type="button" id="submit-room" class="btn btn-primary">
                                            <i data-feather="plus"> </i>
                                            Thêm phòng
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    form: $('#add-room-form'),
                                    modal: $("#addRoom"),
                                    submit: $('#submit-room')
                                };

                                let block_price_item = JSON.parse(JSON.stringify([{ "id": 23351, "name": "Ti\u1ec1n \u0111i\u1ec7n", "type": "constant", "unit": "kwh", "price": 1700, "rooms": [{ "id": 102158, "name": "Ph\u00f2ng 1", "sort": null, "value": 102158, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102159, "name": "Ph\u00f2ng 2", "sort": null, "value": 102159, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102160, "name": "Ph\u00f2ng 3", "sort": null, "value": 102160, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102161, "name": "Ph\u00f2ng 4", "sort": null, "value": 102161, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102162, "name": "Ph\u00f2ng 5", "sort": null, "value": 102162, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102163, "name": "Ph\u00f2ng 6", "sort": null, "value": 102163, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }], "value": null, "frames": [], "status": "is_active", "history": null, "user_id": 8151, "block_id": 7081, "category": "ele", "type_text": "Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh", "unit_text": "KWh", "is_default": 1, "status_text": "\u0110ang s\u1eed d\u1ee5ng", "subtraction": 1 }, { "id": 23352, "name": "Ti\u1ec1n n\u01b0\u1edbc", "type": "constant", "unit": "khoi", "price": 18000, "rooms": [{ "id": 102158, "name": "Ph\u00f2ng 1", "sort": null, "value": 102158, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102159, "name": "Ph\u00f2ng 2", "sort": null, "value": 102159, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102160, "name": "Ph\u00f2ng 3", "sort": null, "value": 102160, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102161, "name": "Ph\u00f2ng 4", "sort": null, "value": 102161, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102162, "name": "Ph\u00f2ng 5", "sort": null, "value": 102162, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102163, "name": "Ph\u00f2ng 6", "sort": null, "value": 102163, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }], "value": null, "frames": [], "status": "is_active", "history": null, "user_id": 8151, "block_id": 7081, "category": "water", "type_text": "Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh", "unit_text": "Kh\u1ed1i", "is_default": 1, "status_text": "\u0110ang s\u1eed d\u1ee5ng", "subtraction": 1 }]));

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0)
                                ).start(null, {
                                    __openModalForm: function (e) {
                                        console.log(e);
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();

                                        if (!__el.form.get(0).checkValidity()) {
                                            $('#add-room-form').get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }

                                        // Xử lý dịch vụ trước khi gửi lên server
                                        let priceItems = [];
                                        let current_price_item_form = __el.form?.getObjectOfForm()?.price_items;

                                        if (data.price_items && current_price_item_form) {
                                            Object.keys(current_price_item_form).map((price_item_id) => {
                                                let searchItem = __helper.array.findObjectInArray(price_item_id, 'id',
                                                    block_price_item);
                                                if (searchItem && parseInt(current_price_item_form[searchItem.id]
                                                    ?.is_selected)) {
                                                    if (searchItem.subtraction) {
                                                        searchItem.value = [0, 0];
                                                        searchItem.value[1] = parseInt(current_price_item_form[searchItem
                                                            .id]['value'][1] ?? '0');
                                                        searchItem.value[0] = parseInt(current_price_item_form[searchItem
                                                            .id]['value'][0] ?? '0');
                                                    } else {
                                                        searchItem.value = [0];
                                                        searchItem.value[0] = parseInt(current_price_item_form[searchItem
                                                            .id]['value'][0] ?? '0');
                                                    }
                                                    priceItems.push(searchItem);
                                                }
                                            });
                                            data.price_items = priceItems;
                                        } else {
                                            data.price_items = null;
                                        }

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.room.create, {
                                                block_id: parseInt(7081)
                                            }),
                                            data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonText: 'Tiếp tục tạo mới',
                                                    confirmButtonColor: '#3c9e47',
                                                    showCancelButton: true,
                                                    cancelButtonText: 'Kết thúc',
                                                }).then((result) => {
                                                    if (!result.isConfirmed)
                                                        bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                                    res.data && window.roomTable &&
                                                        window.roomTable.updateOrAddData([res.data]);
                                                });
                                            },
                                            fail: (res) => {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    },
                                });
                            });
                        </script>
                        <!-- Modal add new contract -->
                        <div class="modal fade" data-bs-backdrop="static" id="addNewContract" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="book"> </i>
                                        </div>
                                        <h5 class="modal-title">Thêm hợp đồng mới <span class="room-name">Tên
                                                phòng</span></h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="add-new-contract" novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">
                                                <div class="col-12">
                                                    <div class="title-has-icon">
                                                        <div class="icon">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="22"
                                                                height="22" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="1.5"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="feather feather-calendar">
                                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2">
                                                                </rect>
                                                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                                                <line x1="3" y1="10" x2="21" y2="10"></line>
                                                            </svg>
                                                        </div>
                                                        <div class="title-item-small">
                                                            <b>Thời hạn hợp đồng</b>
                                                            <i class="des">Dùng xác định ngày vào ở, văn bản hợp
                                                                đồng...</i>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-12">
                                                    <div class="form-floating">
                                                        <select data-format="numeric" id="contract_time"
                                                            name="contract_time" class="form-select form-control">
                                                            <option value="0">Tùy chỉnh</option>
                                                            <option value="1">1 tháng</option>
                                                            <option value="2">2 tháng</option>
                                                            <option value="3">3 tháng</option>
                                                            <option value="4">4 tháng</option>
                                                            <option value="5">5 tháng</option>
                                                            <option value="6">6 tháng</option>
                                                            <option value="7">7 tháng</option>
                                                            <option value="8">8 tháng</option>
                                                            <option value="9">9 tháng</option>
                                                            <option value="10">10 tháng</option>
                                                            <option value="11">11 tháng</option>
                                                            <option value="12">1 năm</option>
                                                            <option value="18">1 năm, 6 tháng</option>
                                                            <option value="24">2 năm</option>
                                                            <option value="32">3 năm</option>
                                                            <option value="48">4 năm</option>
                                                            <option value="60">5 năm</option>
                                                        </select>
                                                        <label for="contract_time">Thời hạn hợp đồng</label>
                                                    </div>
                                                </div>

                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="date_join" id="date_join" data-format="date"
                                                                placeholder="Ngày vào ở"
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}" required>
                                                            <label for="date_join">Ngày vào ở</label>
                                                        </div>
                                                        <label class="input-group-text" for="date_join"><i
                                                                data-feather="calendar"> </i></label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập ngày vào ở và ngày không đúng định dạng. Vui lòng
                                                        kiểm tra lại
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="date_terminate" id="date_terminate"
                                                                placeholder="Ngày kết thúc hợp đồng" data-format="date"
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}">
                                                            <label for="date_terminate">Kết thúc hợp đồng</label>
                                                        </div>
                                                        <label class="input-group-text" for="date_terminate"><i
                                                                data-feather="calendar"> </i></label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Ngày không đúng định dạng. Vui lòng kiểm tra lại
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="title-has-icon">
                                                        <div class="icon">
                                                            <svg viewBox="0 0 24 24" width="24" height="24"
                                                                stroke="currentColor" stroke-width="1.5" fill="none"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="css-i6dzq1">
                                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2">
                                                                </path>
                                                                <circle cx="12" cy="7" r="4"></circle>
                                                            </svg>
                                                        </div>
                                                        <div class="title-item-small">
                                                            <b>Thông tin khách thuê</b>
                                                            <i class="des">Dùng để làm tạm trú, văn bản hợp đồng...</i>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2" style="display: block">
                                                    <div class="form-floating">
                                                        <input data-format="numeric" type="text" class="form-control"
                                                            value="1" name="customer_count" min="0" id="customer_count"
                                                            placeholder="Nhập số người ở" required>
                                                        <label for="customer_count">Số lượng thành viên</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập số lượng thành viên
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="customer_name"
                                                            id="customer_name"
                                                            oninput="this.value = __format.capitalizeFirstStr(this.value)"
                                                            placeholder="Nhập tên người ở" required>
                                                        <label for="customer_name">Tên người ở</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập tên người ở
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control phone"
                                                            name="customer_phone" id="customer_phone"
                                                            placeholder="Nhập sdt người ở" data-format="stringNumber"
                                                            required>
                                                        <label for="customer_phone">Số điện thoại người ở</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập sdt người ở
                                                        </div>
                                                    </div>
                                                </div>
                                                <div
                                                    style="color: #ff6900; font-size: 13px; margin-top: 5px;text-align:right">
                                                    Nhập sđt ZALO để hỗ trợ gửi hóa đơn tự động</div>

                                                <div class="col-12 mt-2 mb-1">
                                                    <div style="padding: 10px;
                            background-color: #fff6ea;
                            border-radius: 10px;">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox"
                                                                name="create_account_renter" id="create_account_renter"
                                                                value="0">
                                                            <label class="form-check-label" for="create_account_renter">
                                                                <b style="color: #2196F3;">Sử dụng APP - Dành cho khách
                                                                    thuê</b>
                                                                <div>Gửi hóa đơn tự động cho khách, hợp đồng online
                                                                    vv...</div>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-check form-check-inline">
                                                        <input data-format="numeric" class="form-check-input"
                                                            type="radio" name="identity_type" id="cccd" checked=""
                                                            value="0">
                                                        <label class="form-check-label" for="cccd">Định dạng
                                                            CCCD</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input data-format="numeric" class="form-check-input"
                                                            type="radio" name="identity_type" id="passport" value="1">
                                                        <label class="form-check-label" for="passport">Định dạng
                                                            Passport/Visa</label>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="identity_number"
                                                            id="identity_number" placeholder="Nhập số CMND/CCCD">
                                                        <label id="label-identity-number"
                                                            for="identity_number">CMND/CCCD</label>
                                                        <div class="invalid-feedback">
                                                            Vui nhập số CMND/CCCD của khách thuê
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="birthday" id="birthday" data-format="date"
                                                                placeholder="Ngày vào ở"
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}">
                                                            <label for="birthday">Ngày sinh</label>
                                                        </div>
                                                        <label class="input-group-text" for="birthday"><i
                                                                data-feather="calendar"> </i></label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập này sinh và phải đúng định dạng
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-floating">
                                                        <select id="customer_sex" name="sex"
                                                            class="form-select form-control" required>
                                                            <option value="1" selected>Nam</option>
                                                            <option value="0">Nữ</option>
                                                            <option value="-1">Chưa xác định</option>
                                                        </select>
                                                        <label for="customer_sex">Giới tính</label>
                                                    </div>
                                                </div>
                                                <div class="collapse row g-2" id="collapseCustomerInCreateContract">
                                                    <div class="col-12">
                                                        <div id="contract_customer_address"
                                                            class="address_component_container row g-2">
                                                            <div class="col-6 mt-2">
                                                                <div class="form-floating">
                                                                    <select data-format="numeric"
                                                                        name="address_component[province_id]"
                                                                        class="form-select form-control province">
                                                                        <option value="">Tỉnh/Thành phố</option>
                                                                    </select>
                                                                    <label for="province">Chọn Tỉnh/Thành phố</label>
                                                                    <div class="invalid-feedback">
                                                                        Vui lòng chọn thành phố
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-6 mt-2">
                                                                <div class="form-floating">
                                                                    <select data-format="numeric"
                                                                        name="address_component[district_id]"
                                                                        class="form-select form-control district">
                                                                        <option value="">Quận/Huyện</option>
                                                                    </select>
                                                                    <label for="district">Chọn Quận/Huyện</label>
                                                                    <div class="invalid-feedback">
                                                                        Vui lòng chọn quận hoặc huyện
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-12 mt-2">
                                                                <div class="form-floating">
                                                                    <select data-format="numeric"
                                                                        name="address_component[ward_id]"
                                                                        class="form-select form-control ward">
                                                                        <option value="">Phường/Xã</option>
                                                                    </select>
                                                                    <label for="ward">Chọn Phường/Xã</label>
                                                                    <div class="invalid-feedback">
                                                                        Vui lòng chọn phường hoặc xã
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-12 mt-2">
                                                                <div class="form-floating">
                                                                    <input type="text"
                                                                        class="form-control address_detail"
                                                                        name="address_component[address_detail]"
                                                                        placeholder="ví dụ: 122 - Đường Nguyễn Duy Trinh">
                                                                    <label for="address_detail">Địa chỉ chi tiết. Ví dụ:
                                                                        122 - Đường Nguyễn Duy Trinh</label>
                                                                    <div class="invalid-feedback">
                                                                        Vui lòng nhập địa chỉ chi tiết
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <script type="text/javascript">
                                                            $(document).ready(function () {
                                                                let __el = {
                                                                    province: $("#contract_customer_address").find(".province"),
                                                                    district: $("#contract_customer_address").find(".district"),
                                                                    ward: $("#contract_customer_address").find(".ward"),

                                                                    address_detail: $("#contract_customer_address").find(".address_detail"),
                                                                    address_show_container: $("#contract_customer_address").find(".address-detail-show-container"),
                                                                    address_show: $("#contract_customer_address").find(".address-detail-show"),
                                                                };

                                                                function getAddressFull() {
                                                                    let arrayText = [
                                                                        __el.address_detail.val(),
                                                                        __el.ward.find('option:selected').text().trim(),
                                                                        __el.district.find('option:selected').text().trim(),
                                                                        __el.province.find('option:selected').text().trim()
                                                                    ];
                                                                    if (arrayText[0].lengh !== '' && arrayText[1].lengh !== '' && arrayText[2].lengh !== '' && arrayText[2].lengh !== '') {
                                                                        __el.address_show_container.show();
                                                                        __el.address_show.text(arrayText.join(', '));
                                                                    } else {
                                                                        __el.address_show_container.hide();
                                                                    }
                                                                }

                                                                __el.address_detail.keyup((e) => {
                                                                    getAddressFull();
                                                                });

                                                                __el.province.change(function () {
                                                                    __el.district.empty();
                                                                    __el.ward.empty();

                                                                    $.transferData({
                                                                        url: __helper.url.urlPattern(__routeApi.location.showProvince, {
                                                                            id: parseInt($(this).val())
                                                                        }),
                                                                        method: 'GET',
                                                                        success: function (res) {
                                                                            __el.district.append(`<option value=''>Quận/Huyện</option>`);
                                                                            $.each(res.data.districts, function (key, value) {
                                                                                __el.district.append(`<option value='${value.id}'>${value.name}</option>`);
                                                                            });
                                                                            getAddressFull();
                                                                        }
                                                                    });

                                                                });

                                                                __el.district.change(function () {
                                                                    __el.ward.empty();
                                                                    $.transferData({
                                                                        url: __helper.url.urlPattern(__routeApi.location.showDistrict, {
                                                                            id: parseInt($(this).val())
                                                                        }),
                                                                        method: 'GET',
                                                                        success: function (res) {
                                                                            __el.ward.append(`<option value=''>Phường/Xã</option>`);
                                                                            $.each(res.data.wards, function (key, value) {
                                                                                __el.ward.append(`<option value='${value.id}'>${value.name}</option>`);
                                                                            });
                                                                            getAddressFull();
                                                                        }
                                                                    });
                                                                });

                                                                __el.ward.change(function () {
                                                                    getAddressFull();
                                                                });
                                                            });
                                                        </script>

                                                    </div>

                                                    <div class="col-12 mt-2">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" name="job"
                                                                id="customer_job"
                                                                placeholder="Nhập công việc khách thuê">
                                                            <label for="customer_job">Nhập công việc</label>
                                                            <div class="invalid-feedback">
                                                                Vui lòng nhập công việc của khách thuê
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-6">
                                                        <div class="input-group">
                                                            <div class="form-floating">
                                                                <input type="text" class="form-control date-flat-picker"
                                                                    name="identity_date" id="identity_date"
                                                                    data-format="date" placeholder="Ngày cấp "
                                                                    pattern="\d{1,2}\/\d{1,2}\/\d{4}">
                                                                <label for="identity_date">Ngày cấp CMND/CCCD</label>
                                                            </div>
                                                            <label class="input-group-text" for="identity_date"><i
                                                                    data-feather="calendar"> </i></label>
                                                        </div>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập ngày đúng định dạng
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control"
                                                                name="identity_place" id="identity_place"
                                                                placeholder="Nhập số CMND/CCCD">
                                                            <label for="identity_place">Nơi cấp CMND/CCCD</label>
                                                            <div class="invalid-feedback">
                                                                Vui nhập nơi cấp CMND/CCCD
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-6 mt-2">
                                                        <div id="image_identity_before_ele" class="image-upload-simple">
                                                        </div>
                                                    </div>

                                                    <div class="col-6 mt-2">
                                                        <div id="image_identity_after_ele" class="image-upload-simple">
                                                        </div>
                                                    </div>
                                                </div>
                                                <a class="collapseCustomerInCreateContract"
                                                    style="text-align: center;color: #007bdd;text-decoration: underline;"
                                                    data-bs-toggle="collapse" href="#collapseCustomerInCreateContract"
                                                    role="button" aria-expanded="false" aria-controls="collapseExample">
                                                    <style>
                                                        .collapseCustomerInCreateContract[aria-expanded="false"] .open {
                                                            display: block;
                                                        }

                                                        .collapseCustomerInCreateContract[aria-expanded="true"] .open {
                                                            display: none;
                                                        }

                                                        .collapseCustomerInCreateContract[aria-expanded="false"] .hidden {
                                                            display: none;
                                                        }

                                                        .collapseCustomerInCreateContract[aria-expanded="true"] .hidden {
                                                            display: block;
                                                        }
                                                    </style>
                                                    <span class="open"><strong>Mở rộng thông tin khách
                                                            thuê</strong></span>
                                                    <span class="hidden"><strong>Ẩn bớt thông tin khách
                                                            thuê</strong></span>
                                                </a>

                                                <div class="col-12">
                                                    <div class="title-has-icon">
                                                        <div class="icon">
                                                            <svg viewBox="0 0 24 24" width="24" height="24"
                                                                stroke="currentColor" stroke-width="1.5" fill="none"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="css-i6dzq1">
                                                                <path
                                                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                                </path>
                                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96">
                                                                </polyline>
                                                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                                            </svg>
                                                        </div>
                                                        <div class="title-item-small">
                                                            <b>Dịch vụ sử dụng</b>
                                                            <i class="des">Thêm dịch vụ sử dụng như: điện, nước, rác,
                                                                wifi...</i>
                                                        </div>
                                                    </div>
                                                    <div class="price-items-checkout-layout">
                                                        <div class="item">
                                                            <div class="item-check-name">
                                                                <input class="form-check-input"
                                                                    id="room_check_price_item_23351" type="checkbox"
                                                                    value="1" name="price_items[23351][is_selected]">

                                                                <label for="room_check_price_item_23351">
                                                                    <b>Tiền điện</b>
                                                                    <p>Giá: <b>1.700đ</b> / KWh</p>
                                                                </label>
                                                            </div>

                                                            <div class="item-value">
                                                                <div class="input-group mb-2">
                                                                    <input class="form-control"
                                                                        id="new_contract_room_price_item_23351_0"
                                                                        min="0" type="number"
                                                                        placeholder="Nhập chỉ số hiện tại" required
                                                                        oninput="$(new_contract_room_price_item_23351_1).val(this.value)"
                                                                        value="0" name="price_items[23351][value][]">
                                                                    <label style="font-size: 12px"
                                                                        class="input-group-text"
                                                                        for="new_contract_room_price_item_23351_0">Chỉ
                                                                        số <br>hiện tại</label>
                                                                </div>
                                                                <div class="input-group" style="display: none">
                                                                    <input class="form-control"
                                                                        id="new_contract_room_price_item_23351_1"
                                                                        min="0" type="number"
                                                                        oninput="$(new_contract_room_price_item_23351_0).val(this.value)"
                                                                        placeholder="Nhập số mới" required value="0"
                                                                        name="price_items[23351][value][]">
                                                                    <label class="input-group-text"
                                                                        for="new_contract_room_price_item_23351_1">Số
                                                                        mới</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="item">
                                                            <div class="item-check-name">
                                                                <input class="form-check-input"
                                                                    id="room_check_price_item_23352" type="checkbox"
                                                                    value="1" name="price_items[23352][is_selected]">

                                                                <label for="room_check_price_item_23352">
                                                                    <b>Tiền nước</b>
                                                                    <p>Giá: <b>18.000đ</b> / Khối</p>
                                                                </label>
                                                            </div>

                                                            <div class="item-value">
                                                                <div class="input-group mb-2">
                                                                    <input class="form-control"
                                                                        id="new_contract_room_price_item_23352_0"
                                                                        min="0" type="number"
                                                                        placeholder="Nhập chỉ số hiện tại" required
                                                                        oninput="$(new_contract_room_price_item_23352_1).val(this.value)"
                                                                        value="0" name="price_items[23352][value][]">
                                                                    <label style="font-size: 12px"
                                                                        class="input-group-text"
                                                                        for="new_contract_room_price_item_23352_0">Chỉ
                                                                        số <br>hiện tại</label>
                                                                </div>
                                                                <div class="input-group" style="display: none">
                                                                    <input class="form-control"
                                                                        id="new_contract_room_price_item_23352_1"
                                                                        min="0" type="number"
                                                                        oninput="$(new_contract_room_price_item_23352_0).val(this.value)"
                                                                        placeholder="Nhập số mới" required value="0"
                                                                        name="price_items[23352][value][]">
                                                                    <label class="input-group-text"
                                                                        for="new_contract_room_price_item_23352_1">Số
                                                                        mới</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="title-has-icon">
                                                        <div class="icon">
                                                            <svg viewBox="0 0 24 24" width="24" height="24"
                                                                stroke="currentColor" stroke-width="1.5" fill="none"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="css-i6dzq1">
                                                                <path
                                                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                                </path>
                                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96">
                                                                </polyline>
                                                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                                            </svg>
                                                        </div>
                                                        <div class="title-item-small">
                                                            <b>Thông tin giá trị hợp đồng:</b>
                                                            <i class="des">Giá tiền phòng và mức tiền cọc sẽ thu</i>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control currency"
                                                            name="room_amount" id="room_amount" data-format="numeric"
                                                            min="0" placeholder="Nhập giá thuê" required>
                                                        <label for="room_amount">Giá thuê (đ)</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập giá thuê
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control currency"
                                                            name="deposit_contract_amount" data-format="numeric" min="0"
                                                            id="deposit_contract_amount" placeholder="Nhập số tiền cọc"
                                                            required>
                                                        <label for="deposit_contract_amount">Mức giá tiền cọc
                                                            (đ)</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập số tiền cọc
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 deposit-contract-temp mt-2 mb-2"
                                                    style="display: none">
                                                    <div class="loz-alert warning">
                                                        <div class="icon flex-0">
                                                            <i data-feather="info" size="20"> </i>
                                                        </div>
                                                        <div class="des flex-1">
                                                            Số tiền cọc giữ chỗ đã thu: <b
                                                                class="deposit-contract-temp-paid"
                                                                style="color:#ff5722">0đ</b>
                                                            <br><i>* Lưu ý: Số tiền này sẽ được chuyển thành tiền cọc
                                                                sau khi bạn tạo hợp đồng này</i>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <select data-format="numeric" id="circle_month"
                                                            name="circle_month" class="form-select form-control">
                                                            <option value="1">1 tháng</option>
                                                            <option value="2">2 tháng</option>
                                                            <option value="3">3 tháng</option>
                                                            <option value="4">4 tháng</option>
                                                            <option value="5">5 tháng</option>
                                                            <option value="6">6 tháng</option>
                                                            <option value="7">7 tháng</option>
                                                            <option value="8">8 tháng</option>
                                                            <option value="9">9 tháng</option>
                                                            <option value="10">10 tháng</option>
                                                            <option value="11">11 tháng</option>
                                                            <option value="12">1 năm</option>
                                                            <option value="18">1 năm, 6 tháng</option>
                                                            <option value="24">2 năm</option>
                                                            <option value="32">3 năm</option>
                                                            <option value="48">4 năm</option>
                                                            <option value="60">5 năm</option>
                                                        </select>
                                                        <label for="circle_month">Chu kỳ thu tiền</label>
                                                    </div>
                                                </div>
                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input type="numeric" class="form-control" name="circle_day"
                                                            data-format="numeric" min="1" max="31" id="circle_day"
                                                            placeholder="Ngày thu" required>
                                                        <label for="circle_day">Ngày thu tiền hàng tháng</label>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-floating">
                                                        <textarea type="text" rows="10" style="min-height: 70px"
                                                            class="form-control" name="note" id="note"
                                                            placeholder="Ghi chú"></textarea>
                                                        <label for="addition_reason">Ghi chú</label>
                                                    </div>
                                                </div>



                                                <div class="col-12">
                                                    <div class="title-has-icon">
                                                        <div class="icon">
                                                            <svg viewBox="0 0 24 24" width="24" height="24"
                                                                stroke="currentColor" stroke-width="1.5" fill="none"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="css-i6dzq1">
                                                                <path
                                                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                                </path>
                                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96">
                                                                </polyline>
                                                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                                            </svg>
                                                        </div>
                                                        <div class="title-item-small">
                                                            <b>Chọn mẫu văn bản hợp đồng</b>
                                                            <i class="des">Bạn có thể cấu hình mẫu của mình, Nếu chưa có
                                                                hãy tạo mẫu</i>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-floating">
                                                        <select data-format="numeric" id="room_contract_template_id"
                                                            name="room_contract_template_id"
                                                            class="form-select form-control">
                                                            <option value="">Mẫu văn bản hợp đồng</option>
                                                            <option value="1">Mẫu mặc định</option>
                                                        </select>
                                                        <label for="room_contract_template_id">Danh sách mẫu văn bản hợp
                                                            đồng đang có</span></label>
                                                    </div>
                                                </div>


                                                <div class="agent-section">
                                                    <div class="col-12">
                                                        <div class="title-has-icon">
                                                            <div class="icon">
                                                                <svg viewBox="0 0 24 24" width="24" height="24"
                                                                    stroke="currentColor" stroke-width="1.5" fill="none"
                                                                    stroke-linecap="round" stroke-linejoin="round"
                                                                    class="css-i6dzq1">
                                                                    <path
                                                                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                                    </path>
                                                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96">
                                                                    </polyline>
                                                                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                                                </svg>
                                                            </div>
                                                            <div class="title-item-small">
                                                                <b>Môi giới</b>
                                                                <i class="des">Chọn người giới thiệu hợp đồng và phí môi
                                                                    giới</i>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-12 mt-2">
                                                        <div class="form-floating">
                                                            <select data-format="numeric" id="agent_id" name="agent_id"
                                                                class="form-select form-control">
                                                                <option data="0" value="">---Chọn môi giới----</option>
                                                            </select>
                                                            <label for="agent_id">Danh sách môi giới</span></label>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-6 mt-2">
                                                            <div class="form-floating">
                                                                <select data-format="numeric" id="commission_rate"
                                                                    name="commission_rate"
                                                                    class="form-select form-control">
                                                                    <option value="">---- % hoa hồng ----</option>
                                                                    <option value="0">0%</option>
                                                                    <option value="10">10%</option>
                                                                    <option value="20">20%</option>
                                                                    <option value="30">30%</option>
                                                                    <option value="40">40%</option>
                                                                    <option value="50">50%</option>
                                                                    <option value="60">60%</option>
                                                                    <option value="70">70%</option>
                                                                    <option value="80">80%</option>
                                                                    <option value="90">90%</option>
                                                                    <option value="100">100%</option>
                                                                </select>
                                                                <label for="commission_rate">Mức hoa hồng</span></label>
                                                            </div>
                                                        </div>

                                                        <div class="col-6 mt-2">
                                                            <div class="form-floating">
                                                                <input type="text" class="form-control currency"
                                                                    name="commission" data-format="numeric" min="0"
                                                                    id="commission" placeholder="Số tiền nhận">
                                                                <label for="commission">Số tiền nhận (đ)</label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-12 mt-2">
                                                        <div class="form-check form-switch">
                                                            <input data-format="numeric" class="form-check-input"
                                                                type="checkbox" value="1" id="auto_receipts_expenses"
                                                                name="auto_receipts_expenses">
                                                            <label class="form-check-label"
                                                                for="auto_receipts_expenses">
                                                                <b>Tạo phiếu chi</b>
                                                                <p>Tạo phiếu chi hoa hồng cho môi giới</p>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-new-contract" class="btn btn-primary">
                                            <i data-feather="plus"> </i>
                                            Thêm hợp đồng mới
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    form: $('#add-new-contract'),
                                    modal: $("#addNewContract"),
                                    submit: $('#submit-new-contract')
                                };

                                let roomData = null;
                                let cell = null;

                                let image_identity_before = null;
                                let image_identity_after = null;
                                let document = null;

                                let block_price_item = JSON.parse(JSON.stringify([{ "id": 23351, "name": "Ti\u1ec1n \u0111i\u1ec7n", "type": "constant", "unit": "kwh", "price": 1700, "rooms": [{ "id": 102158, "name": "Ph\u00f2ng 1", "sort": null, "value": 102158, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102159, "name": "Ph\u00f2ng 2", "sort": null, "value": 102159, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102160, "name": "Ph\u00f2ng 3", "sort": null, "value": 102160, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102161, "name": "Ph\u00f2ng 4", "sort": null, "value": 102161, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102162, "name": "Ph\u00f2ng 5", "sort": null, "value": 102162, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102163, "name": "Ph\u00f2ng 6", "sort": null, "value": 102163, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }], "value": null, "frames": [], "status": "is_active", "history": null, "user_id": 8151, "block_id": 7081, "category": "ele", "type_text": "Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh", "unit_text": "KWh", "is_default": 1, "status_text": "\u0110ang s\u1eed d\u1ee5ng", "subtraction": 1 }, { "id": 23352, "name": "Ti\u1ec1n n\u01b0\u1edbc", "type": "constant", "unit": "khoi", "price": 18000, "rooms": [{ "id": 102158, "name": "Ph\u00f2ng 1", "sort": null, "value": 102158, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102159, "name": "Ph\u00f2ng 2", "sort": null, "value": 102159, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102160, "name": "Ph\u00f2ng 3", "sort": null, "value": 102160, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102161, "name": "Ph\u00f2ng 4", "sort": null, "value": 102161, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102162, "name": "Ph\u00f2ng 5", "sort": null, "value": 102162, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102163, "name": "Ph\u00f2ng 6", "sort": null, "value": 102163, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }], "value": null, "frames": [], "status": "is_active", "history": null, "user_id": 8151, "block_id": 7081, "category": "water", "type_text": "Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh", "unit_text": "Kh\u1ed1i", "is_default": 1, "status_text": "\u0110ang s\u1eed d\u1ee5ng", "subtraction": 1 }]));

                                let block_asset = JSON.parse(JSON.stringify(null));

                                __el.form.find('input[name="identity_type"]').change(function () {
                                    if (parseInt($(this).val()) === 1) {
                                        __el.form.find('#label-identity-number').text('Passport/Visa')
                                        __el.form.find('input[name="identity_type"]').attr('placeholder', 'Passport/Visa');
                                    } else {
                                        __el.form.find('#label-identity-number').text('CMND/CCCD')
                                        __el.form.find('input[name="identity_type"]').attr('placeholder', 'CMND/CCCD');
                                    }
                                });

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0),
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {
                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;

                                        // Tải thông tin thành phố, quận, phường.
                                        $.transferData({
                                            method: "GET",
                                            url: __helper.url.urlPattern(__routeApi.agent.list),
                                            loadingEle: false,
                                            success: (res) => {
                                                __el.modal.find("#agent_id").empty();
                                                __el.modal.find("#agent_id").append(`<option data='0' value=''> --- Chọn môi giới ----</option>`);

                                                __el.modal.find(".agent-section").show();
                                                if (res?.data?.payload?.length) {
                                                    $.each(res?.data?.payload, function (key, value) {
                                                        __el.modal.find("#agent_id").append(`<option data='${value.commission_rate}' value='${value.id}'>${value.name}</option>`);
                                                    });
                                                }
                                            }
                                        });

                                        __el.form.on('change', 'select', function (e) {
                                            if ($(this).attr('name') === 'contract_time') {
                                                let date_join = new Date(__el.form.find('input[name="date_join"]').get(0)._flatpickr.selectedDates[0]);
                                                if (parseInt($(this).val()) > 0) {
                                                    date_join.setMonth(date_join.getMonth() + parseInt($(this).val()));
                                                    __el.form.find('input[name="date_terminate"]').get(0)._flatpickr.setDate(date_join, true, "d/m/Y")
                                                } else {
                                                    __el.form.find('input[name="date_terminate"]').get(0)._flatpickr.setDate(null, true, "d/m/Y")
                                                }
                                            }

                                            // Xử lý cho môi giới
                                            if ($(this).attr('name') === 'agent_id') {
                                                let commission_rate = parseInt($(this).find(':selected').attr('data'));
                                                if (Number.isFinite(commission_rate)) {
                                                    __el.form.find('select[name="commission_rate"]').val(commission_rate).change();
                                                }
                                            }
                                            if ($(this).attr('name') === 'commission_rate') {

                                                let commission_rate = $(this).val()?.length === 0 ? 0 : parseInt($(this).val());
                                                let roomAmount = roomData?.room_amount ?? 0;
                                                let commissionAmount = roomAmount;

                                                if (commission_rate) {
                                                    commissionAmount = (roomAmount * commission_rate) / 100;
                                                    __el.form.find('input[name="commission"]').prop("readonly", true);
                                                } else {
                                                    __el.form.find('input[name="commission"]').prop("readonly", false);
                                                }

                                                __el.form.find('input[name="commission"]').val(commissionAmount);
                                            }
                                        });

                                        //@TODO: chuyển thành config trong tương lai.
                                        __el.form.find('input[name="auto_receipts_expenses"]').prop("checked", true);


                                        flatpickr(__el.form.find('input[name="date_join"]'), {
                                            defaultDate: 'today',
                                            allowInput: true,
                                            enableTime: false,
                                            dateFormat: "d/m/Y",
                                            locale: 'vn',
                                            onChange: function (selectedDates, dateStr, instance) {
                                                let selected = __el.form.find('select[name=contract_time] option').filter(':selected').val()
                                                if (parseInt(selected) > 0) {
                                                    selectedDates[0].setMonth(selectedDates[0].getMonth() + parseInt(selected));
                                                    __el.form.find('input[name="date_terminate"]').get(0)._flatpickr.setDate(selectedDates[0], true, "d/m/Y")
                                                }
                                            },
                                        });

                                        flatpickr(__el.form.find('input[name="date_terminate"]'), {
                                            allowInput: true,
                                            enableTime: false,
                                            dateFormat: "d/m/Y",
                                            locale: 'vn'
                                        });

                                        flatpickr(__el.form.find('input[name="birthday"]'), {
                                            allowInput: true,
                                            enableTime: false,
                                            dateFormat: "d/m/Y",
                                            locale: 'vn'
                                        });

                                        flatpickr(__el.form.find('input[name="identity_date"]'), {
                                            allowInput: true,
                                            enableTime: false,
                                            dateFormat: "d/m/Y",
                                            locale: 'vn'
                                        });

                                        image_identity_before = __el.form.find('#image_identity_before_ele').uploadImageSimple({
                                            label: 'Ảnh mặt trước CMND/CCCD',
                                            name: 'image_identity_before',
                                            error: 'Vui nhập ảnh mặt trước cmnd/cccd',
                                            required: false
                                        });

                                        image_identity_after = __el.form.find('#image_identity_after_ele').uploadImageSimple({
                                            label: 'Ảnh mặt sau CMND/CCCD',
                                            name: 'image_identity_after',
                                            error: 'Vui nhập ảnh mặt sau cmnd/cccd',
                                            required: false
                                        });

                                        document = $('#document-image').uploadImageSimple({
                                            label: 'Hình ảnh chứng từ hợp đồng',
                                            name: 'documents',
                                            error: 'Vui nhập ảnh ',
                                            required: false,
                                            multiple: true,
                                            max: 4
                                        });

                                        image_identity_after.setValue(null);
                                        image_identity_before.setValue(null);
                                        document.setValue(null);

                                        // Tải thông tin thành phố, quận, phường.
                                        $.transferData({
                                            method: "GET",
                                            url: __helper.url.urlPattern(__routeApi.location.provinces),
                                            loadingEle: false,
                                            success: (res) => {
                                                __el.modal.find(".province").empty();
                                                __el.modal.find(".province").append(`<option value=''>Chọn Tỉnh/Thành phố</option>`);
                                                $.each(res.data, function (key, value) {
                                                    __el.modal.find(".province").append(`<option value='${value.id}'>${value.short_name}</option>`);
                                                });
                                            },
                                        });

                                        if (roomData) {
                                            __el.form.find('.deposit-contract-temp').css('display', 'none');
                                            __el.form.find('.deposit-contract-temp-paid').text(`0đ`);
                                            if (roomData?.deposit) {
                                                __el.form.find('input[name="deposit_contract_amount"]').val(roomData.deposit.deposit_temp_amount);
                                                __el.form.find('input[name="customer_name"]').val(roomData.deposit.customer_name);
                                                __el.form.find('input[name="customer_phone"]').val(roomData.deposit.customer_phone);
                                                __el.form.find('input[name="date_join"]').get(0)._flatpickr.setDate(roomData.deposit.date_will_join_format);
                                                __el.form.find('.deposit-contract-temp').css('display', 'block');
                                                __el.form.find('.deposit-contract-temp-paid').text(`${__format.currency(roomData.deposit.deposit_temp_amount) ?? 0}`);
                                                //@TODO: Thêm thông báo để chủ nhà biết là có cọc giữ chỗ trước đó.
                                            }

                                            __el.form.find('input[name="deposit_contract_amount"]').val(roomData.deposit_contract_amount !== 0 ? roomData.deposit_contract_amount : roomData.room_amount);
                                            __el.form.find('input[name="room_amount"]').val(roomData.room_amount);
                                            __el.form.find('input[name="circle_day"]').val(roomData?.circle_day ?? __current_block?.circle_order ?? 1);

                                            __el.modal.find(".room-name").text(`"${roomData.name}"`);

                                            // Set các dịch vụ đã được cho các hợp đồng trước đó
                                            let room_price_item = JSON.parse(JSON.stringify(roomData.price_items)) ?? [];
                                            Array.isArray(room_price_item) &&
                                                room_price_item?.length > 0 &&
                                                room_price_item.map((item, key) => {
                                                    __el.form.find(`input[name="price_items[${item.id}][is_selected]"]`).prop("checked", true);

                                                    let value = __getDefaultPriceItemsValue(item, null);
                                                    if (item.subtraction === 1) {
                                                        __el.form.find(`input[name="price_items[${item.id}][value][]"]`)?.length &&
                                                            __el.form.find(`input[name="price_items[${item.id}][value][]"]`).map((index, el) => {
                                                                $(el).val(value[index] ?? '0')
                                                            });
                                                    } else {
                                                        __el.form.find(`input[name="price_items[${item.id}][value][]"]`).val(value[0] ?? '0');
                                                    }
                                                });

                                            // Set các tài sản đã được thiết lập cho phòng
                                            let room_asset = JSON.parse(JSON.stringify(roomData.asset)) ?? [];
                                            Array.isArray(room_asset) &&
                                                room_asset?.length > 0 &&
                                                room_asset.map((item, key) => {
                                                    __el.form.find(`input[name="assets[${item.id}][is_selected]"]`).prop("checked", true);

                                                    __el.form.find(`input[name="assets[${item.id}][quantity]"]`).val(item?.data?.quantity ?? '0');
                                                });
                                        }
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();
                                        data.room_id = roomData.id;
                                        data.checkPage = 'room';

                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }

                                        // Xử lý dịch vụ trước khi gửi lên server
                                        let priceItems = [];
                                        let current_price_item_form = __el.form?.getObjectOfForm()?.price_items;

                                        if (data.price_items && current_price_item_form) {
                                            Object.keys(current_price_item_form).map((price_item_id) => {
                                                let searchItem = __helper.array.findObjectInArray(price_item_id, 'id', block_price_item);
                                                if (searchItem && parseInt(current_price_item_form[searchItem.id]?.is_selected)) {
                                                    if (searchItem.subtraction) {
                                                        searchItem.value = [0, 0];
                                                        searchItem.value[1] = parseInt(current_price_item_form[searchItem.id]['value'][1] ?? '0');
                                                        searchItem.value[0] = parseInt(current_price_item_form[searchItem.id]['value'][0] ?? '0');
                                                    } else {
                                                        searchItem.value = [0];
                                                        searchItem.value[0] = parseInt(current_price_item_form[searchItem.id]['value'][0] ?? '0');
                                                    }
                                                    priceItems.push(searchItem);
                                                }
                                            });
                                            data.price_items = priceItems;
                                        } else {
                                            data.price_items = null;
                                        }

                                        let assets = [];
                                        let current_asset_form = __el.form?.getObjectOfForm()?.assets;
                                        if (data.assets && current_asset_form) {
                                            Object.keys(current_asset_form).map((asset_id) => {
                                                let searchItem = __helper.array.findObjectInArray(asset_id, 'id', block_asset);
                                                if (parseInt(current_asset_form[asset_id]?.is_selected)) {
                                                    searchItem.quantity_room = 0;
                                                    searchItem.quantity_room = parseInt(current_asset_form[asset_id]['quantity']);
                                                    assets.push(searchItem);
                                                }
                                            });
                                            data.assets = assets;
                                        } else {
                                            data.assets = null;
                                        }

                                        // Thêm hình ảnh vào data
                                        data.image_identity_before = image_identity_before?.value ?? null;
                                        data.image_identity_after = image_identity_after?.value ?? null;
                                        data.documents = document.value ?? null;

                                        let arr_address = [
                                            __el.modal.find(".address_detail").val().length > 0 ? __el.modal.find(".address_detail").val() : null,
                                            __el.modal.find(".ward option:selected").val() ? __el.modal.find(".ward option:selected").text() : null,
                                            __el.modal.find(".district option:selected").val() ? __el.modal.find(".district option:selected").text() : null,
                                            __el.modal.find(".province option:selected").val() ? __el.modal.find(".province option:selected").text() : null,
                                        ];
                                        var filteredArr = arr_address.filter(function (value) {
                                            return value !== null;
                                        });

                                        // Thêm chi tiết địa chỉ
                                        data.address_component['address'] = filteredArr.join(', ');

                                        if (data.circle_day > 31) {
                                            data.circle_day = 31;
                                        }
                                        if (data.circle_day < 1) {
                                            data.circle_day = 1;
                                        }

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.contract.store, {
                                                room_id: data.room_id
                                            }),
                                            data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đóng'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                                    res?.data && cell &&
                                                        cell.getRow().update(res.data);
                                                });
                                            },
                                            fail: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        })
                                    }
                                });
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" data-bs-backdrop="static" id="addDepositTemp" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="anchor"> </i>
                                        </div>
                                        <h5 class="modal-title">Thêm cọc giữ chỗ</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="add-deposit-temp-form"
                                            novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">
                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="date_deposit" id="date_deposit_temp"
                                                                placeholder="Nhập ngày cọc giữ chỗ" data-format="date"
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}" required>
                                                            <label for="date_deposit_temp">Ngày cọc giữ chỗ</label>
                                                        </div>
                                                        <label class="input-group-text" for="date_deposit_temp"><i
                                                                data-feather="calendar"> </i></label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Ngày cọc giữ chỗ là yêu cầu và phải định dạng đúng
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="date_will_join" id="date_will_join"
                                                                data-format="date" placeholder="Nhập ngày dự kiến ở"
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}" required>
                                                            <label for="date_will_join">Ngày dự kiến vào ở</label>
                                                        </div>
                                                        <label class="input-group-text" for="date_will_join"><i
                                                                data-feather="calendar"> </i></label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập ngày dự kiến vào ở và ngày phải đúng định dạng
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="customer_name"
                                                            id="customer_name" placeholder="Nhập tên người ở" required>
                                                        <label for="customer_name">Tên người ở</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập tên người ở
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input data-format="stringNumber" type="text"
                                                            class="form-control" name="customer_phone"
                                                            id="customer_phone" placeholder="Nhập sdt người ở" required>
                                                        <label for="customer_phone">Số điện thoại người ở</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập sdt người ở
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-4">
                                                    <div class="form-floating">
                                                        <input data-format="numeric" type="text" class="form-control"
                                                            name="deposit_temp_amount" id="deposit_temp_amount"
                                                            placeholder="Nhập số tiền cọc" required>
                                                        <label for="deposit_temp_amount">Số tiền cọc giữ chỗ (đ)</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập số tiền cọc giữ chỗ
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <span>Giá thuê hiện tại</span>
                                                    <div class="room_amount"
                                                        style="font-size: 16px;font-weight: bold;color: #3c9d46;">0đ
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-4">
                                                    <div class="form-floating">
                                                        <textarea type="text" rows="10" style="min-height: 100px"
                                                            class="form-control" name="note" id="note"
                                                            placeholder="Nhập ghi chú"></textarea>
                                                        <label for="note">Nhập ghi chú</label>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2 deposit-refund">
                                                    <div class="loz-alert warning mt-2 mb-2">
                                                        <div class="icon flex-0">
                                                            <i data-feather="info" size="20"> </i>
                                                        </div>
                                                        <div class="des flex-1">
                                                            <b>Chú thích:</b> Nếu bạn có hoàn trả lại cho khách số tiện
                                                            cọc này hãy ghi nhập vào đây. Điều này sẽ ghi nhận trong
                                                            thu/chi.
                                                        </div>
                                                    </div>
                                                    <div class="form-floating">
                                                        <input data-format="numeric" type="text" class="form-control"
                                                            name="deposit_temp_amount_refund"
                                                            id="deposit_temp_amount_refund"
                                                            placeholder="Nhập số tiền cọc" min="0">
                                                        <label for="deposit_temp_amount_refund">Số tiền cọc giữ chỗ hoàn
                                                            trả (đ)</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-deposit-temp" class="btn btn-primary">
                                            <i data-feather="plus"> </i>
                                            Thêm cọc giữ chỗ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#addDepositTemp"),
                                    form: $('#add-deposit-temp-form'),
                                    submit: $('#submit-deposit-temp')
                                };

                                let cell = null;
                                let roomData = null;
                                let deposit = null;


                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0)
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {
                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;
                                        deposit = roomData?.deposit ?? null;

                                        flatpickr(__el.form.find('input[name="date_deposit"]'), {
                                            defaultDate: 'today',
                                            allowInput: true,
                                            enableTime: false,
                                            dateFormat: "d/m/Y",
                                            locale: 'vn'
                                        });

                                        flatpickr(__el.form.find('input[name="date_will_join"]'), {
                                            allowInput: true,
                                            enableTime: false,
                                            dateFormat: "d/m/Y",
                                            locale: 'vn',
                                        });

                                        if (deposit) {
                                            __el.modal.find('.modal-title').text(`Hủy cọc giữ chỗ - ${roomData.name}`);
                                            __el.submit.text('Hủy cọc giữ chỗ');
                                            deposit.deposit_temp_amount_refund = 0;
                                            __el.form.setObjectToForm(deposit);

                                            __el.form.find('input[name="date_will_join"]').get(0)._flatpickr.setDate(new Date(deposit.date_will_join), true, "d/m/Y");
                                            __el.form.find('input[name="date_deposit"]').get(0)._flatpickr.setDate(new Date(deposit.date_deposit), true, "d/m/Y");
                                            __el.form.find('input, textarea').attr("readonly", true);
                                            __el.form.find('.deposit-refund').css('display', 'block');
                                            __el.form.find('input[name="deposit_temp_amount_refund"]').attr("readonly", false);

                                        } else {
                                            __el.form.find('input, textarea').attr("readonly", false);
                                            __el.modal.find('.modal-title').text(`Cọc giữ chỗ - ${roomData.name}`);
                                            __el.submit.text('Thêm cọc giữ chỗ');
                                            __el.form.find('.deposit-refund').css('display', 'none');
                                        }

                                        __el.modal.find('.room-name').text(`${roomData.name}`);
                                        __el.modal.find('.room_amount').text(`${__format.currency(roomData.room_amount)}`);

                                        // __el.form.find('input[name="date_will_join"]').get(0)._flatpickr.setDate(new Date(), true, "d/m/Y");
                                        // __el.form.find('input[name="date_deposit"]').get(0)._flatpickr.setDate(new Date(), true, "d/m/Y");

                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();
                                        data.room_id = roomData.id;

                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }

                                        data.deposit_temp_amount_refund = data.deposit_temp_amount_refund ?? 0;
                                        if (data.deposit_temp_amount_refund && data.deposit_temp_amount < data.deposit_temp_amount_refund) {
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Số tiền hoàn trả không thể lớn hơn số tiền cọc",
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }

                                        let url = !deposit ?
                                            __helper.url.urlPattern(__routeApi.deposit.store, {
                                                room_id: data?.room_id ?? 0
                                            }) :
                                            __helper.url.urlPattern(__routeApi.deposit.return, {
                                                room_id: data?.room_id ?? 0,
                                                deposit_id: deposit.id ?? 0
                                            });

                                        $.transferData({
                                            method: "POST",
                                            url,
                                            textLoading: deposit?.id ?
                                                'Đang hủy cọc giữ chỗ...' :
                                                'Đang cọc giữ chỗ...',
                                            data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đóng'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();
                                                    res.data && cell &&
                                                        cell.getRow().update(res.data);
                                                });
                                            },
                                            fail: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            },
                                            error: function (e) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: "Đã có lỗi xảy ra! " + e,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    },
                                });
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" data-bs-backdrop="static" id="addCustomer" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="user-plus"> </i>
                                        </div>
                                        <h5 class="modal-title">Thêm thông tin khách thuê</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="add-customer-form" novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">
                                                <div class="col-12">
                                                    <div class="title-item-small">
                                                        <b>Thông tin các nhân của khách thuê:</b>
                                                        <i class="des">Các thông tin về khách thuê và tiền cọc</i>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2 text-center">
                                                    <div id="avatar" class="image-upload-simple avatar">
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="name"
                                                            id="customer_name"
                                                            oninput="this.value = __format.capitalizeFirstStr(this.value)"
                                                            placeholder="Nhập tên khách thuê" required>
                                                        <label for="customer_name">Tên khách thuê</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập tên khách thuê
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div class="form-floating">
                                                        <input data-format="stringNumber" type="text"
                                                            class="form-control" name="phone" id="customer_phone"
                                                            placeholder="Nhập sdt khách thuê">
                                                        <input data-format="stringNumber" type="hidden"
                                                            class="form-control" name="old_phone"
                                                            placeholder="Nhập sdt người ở">
                                                        <label for="customer_phone">Số điện thoại khách thuê</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập sdt khách thuê
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-check form-check-inline">
                                                        <input data-format="numeric" class="form-check-input"
                                                            type="radio" name="identity_type" id="cccd" checked=""
                                                            value="0">
                                                        <label class="form-check-label" for="cccd">Đinh dạng
                                                            CCCD</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input data-format="numeric" class="form-check-input"
                                                            type="radio" name="identity_type" id="passport" value="1">
                                                        <label class="form-check-label" for="passport">Đinh dạng
                                                            Passport/Visa</label>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="identity_number"
                                                            id="identity_number" placeholder="Nhập số CMND/CCCD">
                                                        <label id="label-identity-number"
                                                            for="identity_number">CMND/CCCD</label>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" data-format="stringNumber"
                                                            class="form-control" name="zalo" id="customer_zalo"
                                                            placeholder="Nhập công Zalo khách thuê">
                                                        <label for="customer_zalo">Zalo của khách</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập Zalo của khách
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="birthday" id="birthday" data-format="date"
                                                                placeholder="Ngày vào ở"
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}">
                                                            <label for="birthday">Ngày sinh</label>
                                                        </div>
                                                        <label class="input-group-text" for="birthday"><i
                                                                data-feather="calendar"> </i></label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập ngày sinh và phải đúng định dạng
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-floating">
                                                        <select id="customer_sex" name="sex"
                                                            class="form-select form-control" required>
                                                            <option value="1" selected>Nam</option>
                                                            <option value="0">Nữ</option>
                                                            <option value="-1">Chưa xác định</option>
                                                        </select>
                                                        <label for="customer_sex">Giới tính</label>
                                                    </div>

                                                </div>
                                                <div class="col-12">
                                                    <div id="customer_address"
                                                        class="address_component_container row g-2">
                                                        <div class="col-6 mt-2">
                                                            <div class="form-floating">
                                                                <select data-format="numeric"
                                                                    name="address_component[province_id]"
                                                                    class="form-select form-control province" required>
                                                                    <option value="">Tỉnh/Thành phố</option>
                                                                </select>
                                                                <label for="province">Chọn Tỉnh/Thành phố</label>
                                                                <div class="invalid-feedback">
                                                                    Vui lòng chọn thành phố
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-6 mt-2">
                                                            <div class="form-floating">
                                                                <select data-format="numeric"
                                                                    name="address_component[district_id]"
                                                                    class="form-select form-control district" required>
                                                                    <option value="">Quận/Huyện</option>
                                                                </select>
                                                                <label for="district">Chọn Quận/Huyện</label>
                                                                <div class="invalid-feedback">
                                                                    Vui lòng chọn quận hoặc huyện
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-12 mt-2">
                                                            <div class="form-floating">
                                                                <select data-format="numeric"
                                                                    name="address_component[ward_id]"
                                                                    class="form-select form-control ward" required>
                                                                    <option value="">Phường/Xã</option>
                                                                </select>
                                                                <label for="ward">Chọn Phường/Xã</label>
                                                                <div class="invalid-feedback">
                                                                    Vui lòng chọn phường hoặc xã
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-12 mt-2">
                                                            <div class="form-floating">
                                                                <input type="text" class="form-control address_detail"
                                                                    name="address_component[address_detail]"
                                                                    placeholder="ví dụ: 122 - Đường Nguyễn Duy Trinh"
                                                                    required>
                                                                <label for="address_detail">Địa chỉ chi tiết. Ví dụ: 122
                                                                    - Đường Nguyễn Duy Trinh</label>
                                                                <div class="invalid-feedback">
                                                                    Vui lòng nhập địa chỉ chi tiết
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <script type="text/javascript">
                                                        $(document).ready(function () {
                                                            let __el = {
                                                                province: $("#customer_address").find(".province"),
                                                                district: $("#customer_address").find(".district"),
                                                                ward: $("#customer_address").find(".ward"),

                                                                address_detail: $("#customer_address").find(".address_detail"),
                                                                address_show_container: $("#customer_address").find(".address-detail-show-container"),
                                                                address_show: $("#customer_address").find(".address-detail-show"),
                                                            };

                                                            function getAddressFull() {
                                                                let arrayText = [
                                                                    __el.address_detail.val(),
                                                                    __el.ward.find('option:selected').text().trim(),
                                                                    __el.district.find('option:selected').text().trim(),
                                                                    __el.province.find('option:selected').text().trim()
                                                                ];
                                                                if (arrayText[0].lengh !== '' && arrayText[1].lengh !== '' && arrayText[2].lengh !== '' && arrayText[2].lengh !== '') {
                                                                    __el.address_show_container.show();
                                                                    __el.address_show.text(arrayText.join(', '));
                                                                } else {
                                                                    __el.address_show_container.hide();
                                                                }
                                                            }

                                                            __el.address_detail.keyup((e) => {
                                                                getAddressFull();
                                                            });

                                                            __el.province.change(function () {
                                                                __el.district.empty();
                                                                __el.ward.empty();

                                                                $.transferData({
                                                                    url: __helper.url.urlPattern(__routeApi.location.showProvince, {
                                                                        id: parseInt($(this).val())
                                                                    }),
                                                                    method: 'GET',
                                                                    success: function (res) {
                                                                        __el.district.append(`<option value=''>Quận/Huyện</option>`);
                                                                        $.each(res.data.districts, function (key, value) {
                                                                            __el.district.append(`<option value='${value.id}'>${value.name}</option>`);
                                                                        });
                                                                        getAddressFull();
                                                                    }
                                                                });

                                                            });

                                                            __el.district.change(function () {
                                                                __el.ward.empty();
                                                                $.transferData({
                                                                    url: __helper.url.urlPattern(__routeApi.location.showDistrict, {
                                                                        id: parseInt($(this).val())
                                                                    }),
                                                                    method: 'GET',
                                                                    success: function (res) {
                                                                        __el.ward.append(`<option value=''>Phường/Xã</option>`);
                                                                        $.each(res.data.wards, function (key, value) {
                                                                            __el.ward.append(`<option value='${value.id}'>${value.name}</option>`);
                                                                        });
                                                                        getAddressFull();
                                                                    }
                                                                });
                                                            });

                                                            __el.ward.change(function () {
                                                                getAddressFull();
                                                            });
                                                        });
                                                    </script>

                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="job"
                                                            id="customer_job" placeholder="Nhập công việc khách thuê">
                                                        <label for="customer_job">Nhập công việc</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập công việc của khách thuê
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="identity_date" id="identity_date"
                                                                data-format="date" placeholder="Ngày cấp "
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}">
                                                            <label for="identity_date">Ngày cấp CMND/CCCD</label>
                                                        </div>
                                                        <label class="input-group-text" for="identity_date"><i
                                                                data-feather="calendar"> </i></label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập ngày đúng định dạng
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="identity_place"
                                                            id="identity_place" placeholder="Nhập số CMND/CCCD">
                                                        <label for="identity_place">Nơi cấp CMND/CCCD</label>
                                                        <div class="invalid-feedback">
                                                            Vui nhập nơi cấp CMND/CCCD
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div id="image_identity_before_ele" class="image-upload-simple">
                                                    </div>
                                                </div>

                                                <div class="col-6 mt-2">
                                                    <div id="image_identity_after_ele" class="image-upload-simple">
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="title-item-small">
                                                        <b>Thông tin quản lý:</b>
                                                        <i class="des">Các thông tin về khách thuê và tiền cọc</i>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2" style="border-bottom: 1px solid #eee">
                                                    <div class="form-check form-switch">
                                                        <input data-format="numeric" class="form-check-input"
                                                            type="checkbox" value="1" id="is_admin" name="is_admin">
                                                        <label class="form-check-label" for="is_admin">
                                                            <b>Là người liên hệ của phòng</b>
                                                            <p>Là người chịu trách nhiệm nhận hóa đơn, báo cáo các vấn
                                                                đề của phòng</p>
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2" style="border-bottom: 1px solid #eee">
                                                    <div class="form-check form-switch">
                                                        <input data-format="numeric" class="form-check-input"
                                                            type="checkbox" value="1" id="is_registry"
                                                            name="is_registry">
                                                        <label class="form-check-label" for="is_registry">
                                                            <b>Đã đăng ký tạm trú</b>
                                                            <p>Tình trạng đăng ký tạm trú của khách thuê</p>
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-check form-switch">
                                                        <input data-format="numeric" class="form-check-input"
                                                            type="checkbox" value="1" id="is_verify" name="is_verify">
                                                        <label class="form-check-label" for="is_verify">
                                                            <b>Thông tin đã được xác minh</b>
                                                            <p>Tình trạng cung cấp thông tin hoặc giấy tờ để chuẩn bị
                                                                làm tạm trú</p>
                                                        </label>
                                                    </div>
                                                </div>

                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-add-customer" class="btn btn-primary">
                                            <i data-feather="plus"></i>
                                            Thêm thông tin khách thuê
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#addCustomer"),
                                    form: $('#add-customer-form'),
                                    submit: $('#submit-add-customer')
                                };

                                let cell = null;
                                let roomData = null;
                                let editCustomer = null;
                                let modalCallback = null;
                                let api = __routeApi.customer.add;

                                let avatar = null;
                                let image_identity_before = null;
                                let image_identity_after = null;

                                __el.form.find('input[name="identity_type"]').change(function () {
                                    if (parseInt($(this).val()) === 1) {
                                        __el.form.find('#label-identity-number').text('Passport/Visa')
                                        __el.form.find('input[name="identity_type"]').attr('placeholder', 'Passport/Visa');
                                    } else {
                                        __el.form.find('#label-identity-number').text('CMND/CCCD')
                                        __el.form.find('input[name="identity_type"]').attr('placeholder', 'CMND/CCCD');
                                    }
                                });

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0)
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {
                                        flatpickr(__el.form.find('input[name="birthday"]'), {
                                            allowInput: true,
                                            enableTime: false,
                                            dateFormat: "d/m/Y",
                                            locale: 'vn'
                                        });

                                        flatpickr(__el.form.find('input[name="identity_date"]'), {
                                            allowInput: true,
                                            enableTime: false,
                                            dateFormat: "d/m/Y",
                                            locale: 'vn'
                                        });

                                        avatar = __el.form.find('#avatar').uploadImageSimple({
                                            label: 'Hình đại diện',
                                            name: 'avatar',
                                            error: 'Vui nhập ảnh avatar',
                                            required: false
                                        });

                                        image_identity_before = __el.form.find('#image_identity_before_ele').uploadImageSimple({
                                            label: 'Ảnh mặt trước CMND/CCCD',
                                            name: 'image_identity_before',
                                            error: 'Vui nhập ảnh mặt trước cmnd/cccd',
                                            required: false
                                        });

                                        image_identity_after = __el.form.find('#image_identity_after_ele').uploadImageSimple({
                                            label: 'Ảnh mặt sau CMND/CCCD',
                                            name: 'image_identity_after',
                                            error: 'Vui nhập ảnh mặt sau cmnd/cccd',
                                            required: false
                                        });



                                        modalCallback = relatedTarget ?? null;
                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;
                                        editCustomer = modalCallback?.currentCustomer ?? null;

                                        if (roomData)
                                            editCustomer = modalCallback?.currentCustomer ?? null;
                                        else
                                            editCustomer = __el.modal.data('customer');

                                        if (editCustomer) {
                                            api = __routeApi.customer.update;
                                            __el.form.setObjectToForm(editCustomer);

                                            if (roomData)
                                                __el.modal.find('.modal-title').text(`Chỉnh sửa khách thuê - ${roomData.name}`);
                                            else
                                                __el.modal.find('.modal-title').text(`Chỉnh sửa khách thuê`);

                                            __el.submit.text("Chỉnh sửa khách thuê");

                                            // Set image cũ cho form
                                            if (editCustomer?.avatar) {
                                                avatar.setValue(editCustomer.avatar)
                                            } else {
                                                avatar.setValue(null);
                                            }

                                            if (editCustomer?.image_identity_before) {
                                                image_identity_before.setValue(editCustomer.image_identity_before)
                                            } else {
                                                image_identity_before.setValue(null);
                                            }

                                            if (editCustomer?.image_identity_after) {
                                                image_identity_after.setValue(editCustomer.image_identity_after)
                                            } else {
                                                image_identity_after.setValue(null);
                                            }
                                            editCustomer?.birthday &&
                                                __el.form.find('input[name="birthday"]').get(0)._flatpickr.setDate(new Date(editCustomer.birthday), true, "d/m/Y");

                                            editCustomer?.identity_date &&
                                                __el.form.find('input[name="identity_date"]').get(0)._flatpickr.setDate(new Date(editCustomer.identity_date), true, "d/m/Y");

                                            if (editCustomer.address_component?.province_id) {
                                                $.transferData({
                                                    method: "POST",
                                                    url: __helper.url.urlPattern(__routeApi.location.init),
                                                    data: {
                                                        'province_id': editCustomer.address_component.province_id ?? null,
                                                        'district_id': editCustomer.address_component.district_id ?? null,
                                                        'ward_id': editCustomer.address_component.ward_id ?? null,
                                                    },
                                                    loadingEle: false,
                                                    success: (res) => {
                                                        $.each(res.data.provinces, function (key, province) {
                                                            __el.modal.find(".province").append(`<option value='${province.id}'>${province.short_name}</option>`);
                                                            if (parseInt(province.id) === parseInt(editCustomer.address_component.province_id))
                                                                $(`.province option[value=${province.id}]`).prop('selected', true);
                                                        });

                                                        $.each(res.data.districts, function (key, district) {
                                                            __el.modal.find(".district").append(`<option value='${district.id}'>${district.name}</option>`);
                                                            if (parseInt(district.id) === parseInt(editCustomer.address_component.district_id))
                                                                $(`.district option[value=${district.id}]`).prop('selected', true);
                                                        });

                                                        $.each(res.data.wards, function (key, ward) {
                                                            __el.modal.find(".ward").append(`<option value='${ward.id}'>${ward.name}</option>`);
                                                            if (parseInt(ward.id) === parseInt(editCustomer.address_component.ward_id))
                                                                $(`.ward option[value=${ward.id}]`).prop('selected', true);
                                                        });
                                                    },
                                                });
                                            } else {
                                                $.transferData({
                                                    method: "GET",
                                                    url: __helper.url.urlPattern(__routeApi.location.provinces),
                                                    loadingEle: false,
                                                    success: (res) => {
                                                        __el.modal.find(".province").empty();
                                                        __el.modal.find(".province").append(`<option value=''>Chọn Tỉnh/Thành phố</option>`);
                                                        $.each(res.data, function (key, value) {
                                                            __el.modal.find(".province").append(`<option value='${value.id}'>${value.short_name}</option>`);
                                                        });
                                                    },
                                                });
                                            }
                                        } else {
                                            api = __routeApi.customer.add;

                                            if (roomData)
                                                __el.modal.find('.modal-title').text(`Chỉnh sửa khách thuê - ${roomData.name}`);
                                            else
                                                __el.modal.find('.modal-title').text(`Chỉnh sửa khách thuê`);

                                            __el.submit.text("Thêm thông tin khách thuê");
                                            image_identity_after.setValue(null);
                                            image_identity_before.setValue(null);
                                            avatar.setValue(null);

                                            __el.modal.find(".district").empty();
                                            __el.modal.find(".ward").empty();
                                            if (!__el.modal.find(".province option[value='79']").length) {
                                                $.transferData({
                                                    method: "GET",
                                                    url: __helper.url.urlPattern(__routeApi.location.provinces),
                                                    loadingEle: false,
                                                    success: (res) => {
                                                        __el.modal.find(".province").empty();
                                                        __el.modal.find(".province").append(`<option value=''>Chọn Tỉnh/Thành phố</option>`);
                                                        $.each(res.data, function (key, value) {
                                                            __el.modal.find(".province").append(`<option value='${value.id}'>${value.short_name}</option>`);
                                                        });
                                                    },
                                                });
                                            }
                                        }
                                    },
                                    __closeModalForm: function (e) {
                                        __el.form.get(0).reset();
                                        __el.form.get(0).classList.remove('was-validated');

                                        if (modalCallback && modalCallback.submit && modalCallback.modalCallback) {
                                            bootstrap.Modal.getInstance(modalCallback.modalCallback.get(0)).show({
                                                cell: modalCallback?.cell ?? null
                                            });
                                        }
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();
                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }
                                        if (editCustomer) {
                                            data.customer_id = editCustomer.id;
                                        }

                                        if (roomData)
                                            data.room_id = roomData.id;
                                        else
                                            data.room_id = parseInt(__el.modal.data('room-id'));

                                        data.avatar = avatar?.value ?? null;
                                        data.image_identity_before = image_identity_before?.value ?? null;
                                        data.image_identity_after = image_identity_after?.value ?? null;

                                        data.address_component['address'] = ([
                                            __el.modal.find(".address_detail").val(),
                                            __el.modal.find(".ward option:selected").val() ? __el.modal.find(".ward option:selected").text() : '',
                                            __el.modal.find(".district option:selected").val() ? __el.modal.find(".district option:selected").text() : '',
                                            __el.modal.find(".province option:selected").val() ? __el.modal.find(".province option:selected").text() : '',
                                        ]).join(', ');

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(api, {
                                                room_id: parseInt(data.room_id)
                                            }),
                                            data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đóng'
                                                }).then((result) => {
                                                    if (res.data && cell) {
                                                        cell.getRow().update(res.data);
                                                    }
                                                    roomData = res.data;
                                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();
                                                });
                                            },
                                            fail: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            },
                                            error: function (e) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: "Đã có lỗi xảy ra! " + e,
                                                    icon: 'error',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    },
                                });
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" data-bs-backdrop="static" id="addCar" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="user-plus"> </i>
                                        </div>
                                        <h5 class="modal-title">Thêm thông tin xe</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="add-car-form" novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">
                                                <div class="col-12 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="name"
                                                            id="car_name"
                                                            oninput="this.value = __format.capitalizeFirstStr(this.value)"
                                                            placeholder="Nhập tên loại xe" required>
                                                        <label for="car_name">Tên loại xe</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập tên loại xe
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 mt-2">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control" name="number_plate"
                                                            id="car_number_plate"
                                                            oninput="this.value = __format.capitalizeFirstStr(this.value)"
                                                            placeholder="Nhập biển số xe" required>
                                                        <label for="car_number_plate">Biển số xe</label>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập biển số xe
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="title-item-small">
                                                        <b>Hình ảnh</b>
                                                        <i class="des">Hình ảnh</i>
                                                    </div>
                                                </div>
                                                <div id="car-image" class="image-upload-simple">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-add-car" class="btn btn-primary">
                                            <i data-feather="plus"></i>
                                            Thêm thông tin xe
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#addCar"),
                                    form: $('#add-car-form'),
                                    submit: $('#submit-add-car')
                                };

                                let image = $('#car-image').uploadImageSimple({
                                    label: 'Chọn tối đa 4 ảnh',
                                    name: 'images',
                                    error: 'Vui nhập ảnh ',
                                    required: false,
                                    multiple: true,
                                    max: 4
                                });

                                let cell = null;
                                let roomData = null;
                                let editCar = null;
                                let modalCallback = null;
                                let api = __routeApi.room.addCar;

                                let data = null;
                                let indexCar = null;
                                let cars = null;


                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0)
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {
                                        modalCallback = relatedTarget ?? null;
                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;
                                        editCar = modalCallback?.currentCar ?? null;


                                        if (editCar) {
                                            api = __routeApi.room.updateCar;
                                            indexCar = modalCallback?.currentIndex;
                                            cars = modalCallback?.cars;
                                            __el.form.setObjectToForm(editCar);
                                            __el.modal.find('.modal-title').text(`Chỉnh sửa xe - ${roomData.name}`);
                                            __el.submit.text("Chỉnh sửa xe");

                                            if (editCar?.images) {
                                                image.setValue(editCar.images)
                                            } else {
                                                image.setValue(null);
                                            }

                                        } else {
                                            api = __routeApi.room.addCar;
                                            image.setValue(null);
                                            __el.modal.find('.modal-title').text(`Thêm thông tin xe - ${roomData.name}`);
                                            __el.submit.text("Thêm thông tin xe");
                                        }
                                    },
                                    __closeModalForm: function (e) {
                                        __el.form.get(0).reset();
                                        __el.form.get(0).classList.remove('was-validated');

                                        if (modalCallback && modalCallback.submit && modalCallback.modalCallback) {
                                            bootstrap.Modal.getInstance(modalCallback.modalCallback.get(0)).show({
                                                cell: modalCallback?.cell ?? null
                                            });
                                        }
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();
                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }



                                        if (editCar) {
                                            data.cars = cars;
                                            data.cars[indexCar]['name'] = data.name;
                                            data.cars[indexCar]['number_plate'] = data.number_plate;

                                            if (image?.value)
                                                data.cars[indexCar]['images'] = image.value;
                                        } else {
                                            data.images = image.value
                                        }

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(api, {
                                                id: parseInt(roomData.id)
                                            }),
                                            data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đóng'
                                                }).then((result) => {
                                                    if (res.data && cell) {
                                                        cell.getRow().update(res.data);
                                                    }
                                                    roomData = res.data;
                                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();
                                                });
                                            },
                                            fail: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            },
                                            error: function (e) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: "Đã có lỗi xảy ra! " + e,
                                                    icon: 'error',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    },
                                });
                            });
                        </script>

                        <!-- Modal deposit temp -->
                        <div class="modal fade" id="customer-view" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="users"> </i>
                                        </div>
                                        <h5 class="modal-title">Danh sách khách thuê - <span class="room-name">Tên
                                                phòng/giường</span></h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"> </button>
                                    </div>
                                    <div class="modal-body">

                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="add-customer" class="btn btn-primary">
                                            <i data-feather="plus"> </i>
                                            Thêm thông tin khách thuê
                                        </button>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#customer-view"),
                                    submit: $('#add-customer')
                                };

                                let cell = null;
                                let roomData = null;
                                let customers = null;

                                const renderCustomer = (customers) => {
                                    __el.modal.find('.modal-body').html('');
                                    customers?.length > 0 &&
                                        customers.map((item) => {
                                            __el.modal.find('.modal-body').append(
                                                $(`<div class="item-feature d-flex align-items-center justify-content-between mb-2">`).append(
                                                    $(`<div class="info" style="flex: 1">
                            <h5>${item.name ?? 'Không biết tên'}</h5>
                            <div>${__format.phone(item.phone) ?? 'Chưa có sdt'}</div>
                            <div>
                                ${item.is_admin ? `<span class="badge" style="font-size: 12px; background-color: ${item.is_contract_color}">Người liên hệ</span>` : ''}
                                ${item.is_contract ? `<span class="badge" style="font-size: 12px; background-color: ${item.is_contract_color}">Đại diên hợp đồng</span>` : ''}
                            </div>
                        </div>`)
                                                ).append(
                                                    (__permission_block === null || __permission_block.customer.delete) ?
                                                        $(`<div class="btn-round btn-delete">`).append(
                                                            $(feather.icons['trash-2'].toSvg())
                                                        ).click((e) => {
                                                            if (parseInt(item.is_contract) === 0) {
                                                                Swal.fire({
                                                                    title: 'Cảnh báo!',
                                                                    text: "Bạn có chắc chắn muốn xóa khách thuê này?",
                                                                    icon: 'warning',
                                                                    showCancelButton: true,
                                                                    cancelButtonColor: '#d33',
                                                                    confirmButtonColor: '#3085d6',
                                                                    confirmButtonText: 'Vâng! tôi muốn xóa',
                                                                    cancelButtonText: 'Không xóa'
                                                                }).then((result) => {
                                                                    if (result.isConfirmed) {
                                                                        $.transferData({
                                                                            method: "POST",
                                                                            url: __helper.url.urlPattern(__routeApi.customer.delete, {
                                                                                customer_id: parseInt(item.id)
                                                                            }),
                                                                            success: (res) => {
                                                                                Swal.fire({
                                                                                    title: 'Thông báo!',
                                                                                    text: res.message,
                                                                                    icon: 'success',
                                                                                    confirmButtonText: 'Đóng'
                                                                                }).then(result => {
                                                                                    renderCustomer(res.data.customers ?? null);
                                                                                    if (res.data && cell) {
                                                                                        cell.getRow().update(res.data);
                                                                                    }
                                                                                });

                                                                            },
                                                                            fail: function (res) {
                                                                                Swal.fire({
                                                                                    title: 'Thông báo!',
                                                                                    text: res.message,
                                                                                    icon: 'error',
                                                                                    confirmButtonText: 'Đã hiểu'
                                                                                });
                                                                            },
                                                                            error: function (e) {
                                                                                Swal.fire({
                                                                                    title: 'Thông báo!',
                                                                                    text: "Đã có lỗi xảy ra! " + e,
                                                                                    icon: 'error',
                                                                                    confirmButtonText: 'Đã hiểu'
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                });
                                                            } else {
                                                                Swal.fire({
                                                                    title: 'Cảnh báo!',
                                                                    text: "Khách thuê này là người đại diện hợp đồng, không thể xóa. Vui lòng thay đổi người đại diện hợp đồng sang thành viên khác để xóa khách thuê này!",
                                                                    icon: 'warning',
                                                                })
                                                            }
                                                        })
                                                        : ''
                                                ).append(
                                                    (__permission_block === null || __permission_block.customer.update) ?
                                                        $(`<div class="btn-round btn-edit">`).append(
                                                            $(`${feather.icons['edit'].toSvg()}`)
                                                        ).click((e) => {
                                                            var addCustomer = bootstrap.Modal.getInstance(document.getElementById('addCustomer')) ?? new bootstrap.Modal(document.getElementById('addCustomer'), null);
                                                            bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                                            addCustomer.show({
                                                                modalCallback: __el.modal,
                                                                submit: __el.submit,
                                                                roomData,
                                                                currentCustomer: item,
                                                                cell
                                                            });
                                                        })
                                                        : ''
                                                )
                                            );
                                        });
                                };

                                __el.submit.click((e) => {
                                    var addCustomer = bootstrap.Modal.getInstance(document.getElementById('addCustomer')) ?? new bootstrap.Modal(document.getElementById('addCustomer'), null);
                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                    addCustomer.show({
                                        modalCallback: __el.modal,
                                        submit: __el.submit,
                                        roomData,
                                        cell
                                    });
                                });

                                __el.modal.get(0).addEventListener('shown.bs.modal', function ({ relatedTarget }) {
                                    cell = relatedTarget?.cell ?? null;
                                    roomData = relatedTarget?.cell?.getData() ?? null;
                                    customers = roomData?.customers ?? null;

                                    __el.modal.find('.modal-body').html('');

                                    renderCustomer(customers);

                                    __el.modal.find(".room-name").text(`"${roomData?.name ?? 'Không xác định được tên'}"`);
                                });

                                __el.modal.get(0).addEventListener('hide.bs.modal', function () {
                                    __el.modal.find('.modal-body').html(`Chưa có khách thuê nào dc ghi nhận!`);
                                });
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" id="car-view" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="users"> </i>
                                        </div>
                                        <h5 class="modal-title">Danh sách xe - <span class="room-name">Tên
                                                phòng/giường</span></h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"> </button>
                                    </div>
                                    <div class="modal-body">

                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="add-car" class="btn btn-primary">
                                            <i data-feather="plus"> </i>
                                            Thêm thông tin xe
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#car-view"),
                                    submit: $('#add-car')
                                };

                                let cell = null;
                                let roomData = null;
                                let cars = null;

                                const renderCar = (cars) => {
                                    __el.modal.find('.modal-body').html('');
                                    let cars_temp = cars;
                                    cars?.length > 0 &&
                                        cars.map((item, i) => {
                                            __el.modal.find('.modal-body').append(
                                                $(`<div class="item-feature d-flex align-items-center justify-content-between mb-2">`).append(
                                                    $(`<div class="info" style="flex: 1">
                            <h5>${item.name ?? 'Không biết tên'}</h5>
                            <div>${item.number_plate ?? 'Chưa có'}</div>
                        </div>`)
                                                ).append(
                                                    (__permission_block === null || __permission_block.room.update) ?
                                                        $(`<div class="btn-round btn-delete">`).append(
                                                            $(feather.icons['trash-2'].toSvg())
                                                        ).click((e) => {
                                                            Swal.fire({
                                                                title: 'Cảnh báo!',
                                                                text: "Bạn có chắc chắn muốn xóa xe này?",
                                                                icon: 'warning',
                                                                showCancelButton: true,
                                                                cancelButtonColor: '#d33',
                                                                confirmButtonColor: '#3085d6',
                                                                confirmButtonText: 'Vâng! tôi muốn xóa',
                                                                cancelButtonText: 'Không xóa'
                                                            }).then((result) => {
                                                                if (result.isConfirmed) {
                                                                    cars_temp.splice(i, 1);
                                                                    $.transferData({
                                                                        method: "POST",
                                                                        url: __helper.url.urlPattern(__routeApi.room.updateCar, {
                                                                            id: parseInt(roomData.id)
                                                                        }),
                                                                        data: {
                                                                            cars: cars_temp
                                                                        },
                                                                        success: (res) => {
                                                                            Swal.fire({
                                                                                title: 'Thông báo!',
                                                                                text: res.message,
                                                                                icon: 'success',
                                                                                confirmButtonText: 'Đóng'
                                                                            }).then(result => {
                                                                                renderCar(res.data.car ?? null);
                                                                                if (res.data && cell) {
                                                                                    cell.getRow().update(res.data);
                                                                                }
                                                                            });

                                                                        },
                                                                        fail: function (res) {
                                                                            Swal.fire({
                                                                                title: 'Thông báo!',
                                                                                text: res.message,
                                                                                icon: 'error',
                                                                                confirmButtonText: 'Đã hiểu'
                                                                            });
                                                                        },
                                                                        error: function (e) {
                                                                            Swal.fire({
                                                                                title: 'Thông báo!',
                                                                                text: "Đã có lỗi xảy ra! " + e,
                                                                                icon: 'error',
                                                                                confirmButtonText: 'Đã hiểu'
                                                                            });
                                                                        }
                                                                    });
                                                                }
                                                            });
                                                        })
                                                        : ''
                                                ).append(
                                                    (__permission_block === null || __permission_block.room.update) ?
                                                        $(`<div class="btn-round btn-edit">`).append(
                                                            $(`${feather.icons['edit'].toSvg()}`)
                                                        ).click((e) => {
                                                            var addCar = bootstrap.Modal.getInstance(document.getElementById('addCar')) ?? new bootstrap.Modal(document.getElementById('addCar'), null);
                                                            bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                                            addCar.show({
                                                                modalCallback: __el.modal,
                                                                submit: __el.submit,
                                                                roomData,
                                                                cars: cars,
                                                                currentIndex: i,
                                                                currentCar: item,
                                                                cell
                                                            });
                                                        })
                                                        : ''
                                                )
                                            );
                                        });
                                };

                                __el.submit.click((e) => {
                                    var addCar = bootstrap.Modal.getInstance(document.getElementById('addCar')) ?? new bootstrap.Modal(document.getElementById('addCar'), null);
                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                    addCar.show({
                                        modalCallback: __el.modal,
                                        submit: __el.submit,
                                        roomData,
                                        cell
                                    });
                                });

                                __el.modal.get(0).addEventListener('shown.bs.modal', function ({ relatedTarget }) {
                                    cell = relatedTarget?.cell ?? null;
                                    roomData = relatedTarget?.cell?.getData() ?? null;
                                    cars = roomData?.car ?? null;

                                    __el.modal.find('.modal-body').html('');

                                    renderCar(cars);

                                    __el.modal.find(".room-name").text(`"${roomData?.name ?? 'Không xác định được tên'}"`);

                                    if (__permission_block !== null && !__permission_block.room.update)
                                        __el.submit.remove();
                                });

                                __el.modal.get(0).addEventListener('hide.bs.modal', function () {
                                    __el.modal.find('.modal-body').html(`Chưa ghi nhận thông tin xe nào`);
                                });
                            });
                        </script>

                        <!-- Modal deposit temp -->
                        <style type="text/css">
                            .total-price {
                                font-size: 18px;
                            }
                        </style>
                        <div class="modal fade" data-bs-backdrop="static" id="addBill" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="dollar-sign"> </i>
                                        </div>
                                        <h5 class="modal-title">Lập hóa đơn cho <span class="room-name">P.012</span>
                                        </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"> </button>
                                    </div>
                                    <div class="room-debt-layout modal-header--sticky"
                                        style="justify-content: space-between;align-items: center;top: 10px;padding: 10px;margin: 10px;border: 2px solid #ffcfcf;background-color: #fff8e5;border-radius: 7px; margin-bottom:0">
                                        <strong>Tiền khách nợ <strong class="room-debt"
                                                style="font-size: 18px;color: red;">1.000.000đ</strong></strong>
                                        <p style="margin-bottom: 0px;">Bạn vẫn tiếp tục lập hóa đơn?</p>
                                    </div>
                                    <div class="modal-body">
                                        <form class="needs-validation" id="add-bill-form" novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">
                                                <div class="col-12 note_contract">
                                                    <div class="loz-alert warning">
                                                        <div class="icon flex-0">
                                                            <i data-feather="info"> </i>
                                                        </div>
                                                        <div class="des flex-1 content_note">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12"
                                                    style="padding-bottom: 15px;border-bottom: 1px solid #ccc;margin-bottom: 10px;">
                                                    <div class="form-floating">
                                                        <select id="reason_id" name="reason_id"
                                                            class="form-select form-control"
                                                            style="border-color: #ffffff;outline: 0;box-shadow: 0 0 0 .25rem rgba(13, 110, 253, .25);"
                                                            data-format="numeric" required>
                                                            <option value="1">Thu tiền hàng tháng</option>
                                                            <option value="2">Thu tiền tháng đầu tiên</option>
                                                            <option value="3">Thu tiền khi kết thúc hợp đồng</option>
                                                            <option value="4">Thu tiền phòng theo chu kỳ</option>
                                                            <option value="5">Thu tiền dịch vụ</option>
                                                            <option value="6">Thu tiền cọc</option>
                                                            <option value="7">Hoàn tiền cọc</option>
                                                        </select>
                                                        <label for="reason_id">Lý do thu tiền</label>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control month-flat-picker"
                                                                name="month" id="month" placeholder="Nhập tháng"
                                                                pattern="\d{1,2}\/\d{4}" required>
                                                            <label for="month">Tháng lập phiếu</label>
                                                        </div>
                                                        <label class="input-group-text" for="month"><i
                                                                data-feather="calendar"> </i></label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập tháng
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="date" data-format="date" id="date-add-bill"
                                                                placeholder="Ngày lập hóa đơn"
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}" required>
                                                            <label for="date-add-bill">Ngày lập hóa đơn</label>
                                                        </div>
                                                        <label class="input-group-text" for="date-add-bill">
                                                            <i data-feather="calendar"> </i>
                                                        </label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập Ngày lập hóa đơn
                                                    </div>
                                                </div>

                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="deadline_bill_date" id="deadline_bill_date"
                                                                data-format="date"
                                                                placeholder="Nhập hạn đóng tiền cho phiếu thu(hóa đơn)"
                                                                pattern="\d{1,2}\/\d{1,2}\/\d{4}" required>
                                                            <label for="deadline_bill_date">Hạn đóng tiền</label>
                                                        </div>
                                                        <label class="input-group-text" for="deadline_bill_date">
                                                            <i data-feather="calendar"> </i>
                                                        </label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập hạn đóng tiền hóa đơn
                                                    </div>
                                                </div>

                                                <div class="col-12 calculate-spent-time-layout">
                                                    <div class="title-has-icon">
                                                        <div class="icon">
                                                            <svg viewBox="0 0 24 24" width="24" height="24"
                                                                stroke="currentColor" stroke-width="1.5" fill="none"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="css-i6dzq1">
                                                                <path
                                                                    d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z">
                                                                </path>
                                                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                                            </svg>
                                                        </div>
                                                        <div class="title-item-small">
                                                            <b class="reason_text">Tiền thuê</b>
                                                            <div class="des">Ngày vào: <strong style="color: #ff5722"
                                                                    class="date-join">01/01/2021</strong>. Chu kỳ thu:
                                                                <strong style="color: #ff5722"
                                                                    class="circle-month">1</strong> <span
                                                                    style="color: #ff5722">tháng, <span
                                                                        class="circle-day">thu cuối tháng</span></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Số tháng, ngày  layout -->
                                                    <div class="row g-2 month-amount-layout"
                                                        style="margin-top: 5px; display:none">
                                                        <div class="col-6 mt-2">
                                                            <div class="form-floating">
                                                                <input data-format="numeric" type="text" min="0"
                                                                    class="form-control" value="1" name="month_amount"
                                                                    id="month_amount" placeholder="Nhập số tháng"
                                                                    readonly required>
                                                                <label for="month_amount">Số tháng</label>
                                                                <div class="invalid-feedback">
                                                                    Vui lòng nhập số tháng tính tiền
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-6 mt-2">
                                                            <div class="form-floating">
                                                                <input data-format="numeric" type="text" min="0"
                                                                    class="form-control" value="0" name="day_amount"
                                                                    id="day_amount" placeholder="Nhập số tháng" readonly
                                                                    required>
                                                                <label for="day_amount">Số ngày lẻ</label>
                                                                <div class="invalid-feedback">
                                                                    Vui lòng nhập số ngày lẻ
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Từ ngày, đến ngày  layout -->
                                                    <div class="row g-2 circle-month-layout" style="margin-top: 5px">
                                                        <div class="col-6 mt-2">
                                                            <div class="form-floating">
                                                                <input type="text" class="form-control date-flat-picker"
                                                                    name="date_from" id="date_from" data-format="date"
                                                                    placeholder="Từ ngày"
                                                                    pattern="\d{1,2}\/\d{1,2}\/\d{4}" required>
                                                                <label for="date_from">Từ ngày</label>
                                                            </div>
                                                        </div>

                                                        <div class="col-6 mt-2">
                                                            <div class="form-floating">
                                                                <input type="text" class="form-control date-flat-picker"
                                                                    name="date_to" id="date_to" data-format="date"
                                                                    placeholder="Đến ngày"
                                                                    pattern="\d{1,2}\/\d{1,2}\/\d{4}" required>
                                                                <label for="date_to">Đến ngày</label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-12 calculate-spent-time-text">
                                                        <div class="label-feature">
                                                            <div class="row g-0">
                                                                <div class="col-6">
                                                                    <div><span>Số ngày khách ở</span></div>
                                                                    <b class="bill-month-amount-text"
                                                                        style="color: #ed6004">0 tháng</b>, <b
                                                                        style="color: #ed6004"
                                                                        class="bill-day-amount-text">0 ngày</b>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-12 room-amount-layout">
                                                        <div class="label-feature">
                                                            <div class="row g-0">
                                                                <div class="col-6">
                                                                    <div><span class="reason_text">Tính tiền nhà</span>
                                                                    </div>
                                                                    <b class="bill-month-amount-text"
                                                                        style="color: #ed6004">0 tháng</b>, <b
                                                                        style="color: #ed6004"
                                                                        class="bill-day-amount-text">0 ngày</b>
                                                                    x <b class="bill-room-amount">0 đ</b>
                                                                </div>
                                                                <div class="col-6 text-end">
                                                                    <div><span>Thành tiền</span></div>
                                                                    <b class="total-price bill-total-room">0 đ</b>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 deposit-layout">
                                                    <div class="title-has-icon">
                                                        <div class="icon">
                                                            <svg viewBox="0 0 24 24" width="24" height="24"
                                                                stroke="currentColor" stroke-width="1.5" fill="none"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="css-i6dzq1">
                                                                <path
                                                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                                </path>
                                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96">
                                                                </polyline>
                                                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                                            </svg>
                                                        </div>
                                                        <div class="title-item-small">
                                                            <b class="title_deposit_contract_type">Thu/Trả tiền cọc:</b>
                                                            <i class="des des_deposit_contract_type">Tiền đặt cọc khi
                                                                thuê phòng</i>
                                                        </div>
                                                    </div>

                                                    <div class="col-12 mt-2">
                                                        <div class="form-floating">
                                                            <input data-format="numeric" type="text" min="0"
                                                                class="form-control" name="deposit_contract_amount"
                                                                id="deposit_contract_amount"
                                                                placeholder="Số tiền cọc thu hoặc trả lại">
                                                            <label for="deposit_contract_amount">Số tiền cọc(đ)</label>
                                                            <input style="display: none" data-format="numeric"
                                                                type="text" min="0" name="real_deposit_contract_amount">
                                                            <input style="display: none" data-format="numeric"
                                                                type="text" min="0"
                                                                name="contract_deposit_contract_amount">
                                                            <input style="display: none" data-format="numeric"
                                                                type="text" min="0" value="-1" name="deposit">
                                                        </div>
                                                        <div style="margin-bottom: 0; margin-top: 10px">
                                                            <div>
                                                                <span class="text-deposit">- Số tiền cọc cần thu
                                                                </span>: <b class="deposit-contact-paid"
                                                                    style="color:#ff5722">0đ</b>
                                                                <div class="pre-deposit-contact-paid"
                                                                    style="display: none"></div>
                                                            </div>
                                                            <div
                                                                style="padding: 10px;border-radius: 10px;background-color: #fff2df; margin-top: 5px;">
                                                                <i class="des">* Lưu ý * <br>1. Số tiền cọc hoàn trả
                                                                    không thể lớn hơn số tiền cọc đã thu. <br>2. Số tiền
                                                                    thu cọc không thể lớn hớn mức giá cọc quy định trong
                                                                    hợp đồng</i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12 price-item-layout">
                                                    <div class="title-has-icon">
                                                        <div class="icon">
                                                            <svg viewBox="0 0 24 24" width="24" height="24"
                                                                stroke="currentColor" stroke-width="1.5" fill="none"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="css-i6dzq1">
                                                                <path
                                                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                                </path>
                                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96">
                                                                </polyline>
                                                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                                            </svg>
                                                        </div>
                                                        <div class="title-item-small">
                                                            <b>Tiền dịch vụ</b>
                                                            <i class="des">Tính tiền dịch vụ khách xài</i>
                                                        </div>
                                                    </div>

                                                    <div class="waring-addtion-price-item mt-2"
                                                        style="display: none; background-color: #fff1dd; border-radius: 10px; padding: 10px;">
                                                        <div class="form-check form-switch">
                                                            <input data-format="numeric" class="form-check-input"
                                                                type="checkbox" value="1"
                                                                id="price_items_belong_to_date"
                                                                name="price_items_belong_to_date">
                                                            <label class="form-check-label"
                                                                for="price_items_belong_to_date">
                                                                <b>Tính dịch vụ theo ngày thực tế</b>
                                                                <p>Áp dụng <strong
                                                                        class="price-item-has-belong-to-date"> </strong>
                                                                    cho <strong style="color: #ff5722"><strong
                                                                            class="spent-days">9</strong> ngày
                                                                        ở</strong></p>
                                                            </label>
                                                        </div>
                                                    </div>

                                                    <div class="room-price-item price-items-checkout-layout">
                                                        <div>Nhà trọ không có dịch vụ nào</div>
                                                    </div>

                                                    <div class="label-feature">
                                                        <div class="row g-0">
                                                            <div class="col-6">
                                                                <div><span>Tính tiền dịch vụ</span></div>
                                                                <div><b><span class="bill-count-price-item">0</span>
                                                                        dịch vụ</b></div>
                                                                <span class="bill-month-amount-text"
                                                                    style="color: #ed6004">0 tháng</span>, <span
                                                                    style="color: #ed6004"
                                                                    class="bill-day-amount-text">0 ngày</span>
                                                            </div>
                                                            <div class="col-6 text-end">
                                                                <div><span>Thành tiền</span></div>
                                                                <b class="total-price bill-total-price-items">0 đ</b>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="addition-layount">
                                                    <div class="col-12">
                                                        <div class="title-has-icon">
                                                            <div class="icon">
                                                                <svg viewBox="0 0 24 24" width="24" height="24"
                                                                    stroke="currentColor" stroke-width="1.5" fill="none"
                                                                    stroke-linecap="round" stroke-linejoin="round"
                                                                    class="css-i6dzq1">
                                                                    <path
                                                                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                                    </path>
                                                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96">
                                                                    </polyline>
                                                                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                                                </svg>
                                                            </div>
                                                            <div class="title-item-small">
                                                                <b>Cộng thêm / Giảm trừ:</b>
                                                                <i class="des">Ví dụ giảm ngày tết, giảm trừ covid, thêm
                                                                    tiền phạt...</i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <style type="text/css">
                                                        #addition-item .item {
                                                            border-radius: 5px;
                                                            border: 1px solid #ced4da;
                                                        }

                                                        #addition-item .form-control {
                                                            border: 0px;
                                                            border-radius: 0;
                                                        }

                                                        #addition-item .middle-item,
                                                        .addition-suggestion-layout .middle-item {
                                                            display: flex;
                                                            flex-direction: column;
                                                            justify-content: center;
                                                            align-items: center;
                                                        }

                                                        #addition-item .center-item {
                                                            display: flex;
                                                            flex-direction: column;
                                                            justify-content: center;
                                                        }

                                                        #addition-item .border-top {
                                                            border-top: 1px solid #ced4da;
                                                        }

                                                        #addition-item .border-bottom {
                                                            border-bottom: 1px solid #ced4da;
                                                        }

                                                        #addition-item .border-left {
                                                            border-left: 1px solid #ced4da;
                                                        }

                                                        #addition-item .border-right {
                                                            border-right: 1px solid #ced4da;
                                                        }

                                                        #addition-item .full {
                                                            height: 100%;
                                                            width: 100%;
                                                        }
                                                    </style>
                                                    <div class="addition-item" id="addition-item">
                                                        <div class="loz-alert warning"
                                                            style="margin-bottom: 10px; margin-top: 10px;">
                                                            <div class="icon flex-0">
                                                                <i data-feather="info"> </i>
                                                            </div>
                                                            <div class="des flex-1">
                                                                Chú ý: Cộng thêm / giảm trừ không nên là tiền cọc. Hãy
                                                                chọn lý do có tiền cọc để nếu cần
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-12">
                                                        <div
                                                            style="border-top: 1px solid #eee; padding-top: 10px; text-align: end;">
                                                            <button type="button" id="addition-add"
                                                                class="btn btn-secondary" style="width: 100%;">
                                                                <i data-feather="plus"> </i>
                                                                Thêm mục cộng thêm / giảm trừ
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div style="display: none">
                                                    <div class="col-12">
                                                        <div class="form-check form-check-inline">
                                                            <input data-format="numeric" class="form-check-input"
                                                                type="radio" name="addition" id="addition_a_bill"
                                                                checked value="1" data-format="numeric">
                                                            <label class="form-check-label" for="addition_a_bill">Cộng
                                                                thêm</label>
                                                        </div>
                                                        <div class="form-check form-check-inline">
                                                            <input data-format="numeric" class="form-check-input"
                                                                type="radio" name="addition" id="addition_b_bill"
                                                                value="-1" data-format="numeric">
                                                            <label class="form-check-label" for="addition_b_bill">Giảm
                                                                trừ</label>
                                                        </div>
                                                    </div>

                                                    <div class="col-12 mt-2">
                                                        <div class="form-floating">
                                                            <input data-format="numeric" type="text" min="0"
                                                                class="form-control" name="addition_value"
                                                                id="addition_value"
                                                                placeholder="Số tiền cộng thêm hoặc giảm trừ">
                                                            <label for="addition_value">Số tiền (đ)</label>
                                                        </div>
                                                    </div>

                                                    <div class="col-12 mt-2">
                                                        <div class="form-floating">
                                                            <textarea type="text" rows="10" style="min-height: 70px"
                                                                class="form-control" name="addition_reason"
                                                                id="addition_reason"
                                                                placeholder="Nhập lý do"></textarea>
                                                            <label for="addition_reason">Lý do</label>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="label-feature">
                                                        <div class="row g-0">
                                                            <div class="col-6">
                                                                <div><span class="bill-addition-text">Cộng thêm / giảm
                                                                        trừ</span></div>
                                                                <div>Lý do: <i class="bill-addition-reason-text">Chưa có
                                                                        lý do</i></div>
                                                            </div>
                                                            <div class="col-6 text-end">
                                                                <div><span>Thành tiền</span></div>
                                                                <b class="total-price bill-total-addition">0 đ</b>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="addition-suggestion-layout">
                                                    <div class="col-12">
                                                        <div class="title-has-icon">
                                                            <div class="icon">
                                                                <img src="/householder-admin/images/icons8-light-100.png"
                                                                    width="60%" />
                                                            </div>
                                                            <div class="title-item-small">
                                                                <b>Đề xuất giảm trừ / cộng thêm</b>
                                                                <i class="des">Các mục bạn có thể giảm trừ / cộng
                                                                    thêm</i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="content-suggest mt-2">
                                                    </div>
                                                </div>

                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky"
                                        style="justify-content: space-between; align-items: center">
                                        <div class="row g-0" style="width: 100%">
                                            <div class="col-8">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="send_to_zalo"
                                                        id="send_to_zalo" value="1" checked>
                                                    <label class="form-check-label" for="send_to_zalo">
                                                        <b style="color: #2196F3">Gửi ZALO & APP khách thuê</b>
                                                        <div>Hệ thống sẽ tự động gửi hóa đơn tới ZALO và APP khách</div>
                                                        <div><strong style="color:orangered">*Lưu ý: Chỉ có thể gửi zalo
                                                                cho khách thuê từ 6.00 đến 22.00 giờ </strong></div>
                                                    </label>
                                                </div>

                                            </div>
                                            <div class="col-4 text-end">
                                                <div><span>Tổng cộng hóa đơn</span></div>
                                                <b class="show-total total-price bill-total"
                                                    style="color:#3c9e47">2.400.000 đ</b>
                                            </div>
                                            <div class="col-12 text-end" style="margin-top: 10px">
                                                <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">Hủy bỏ</button>
                                                <button type="button" id="submit-add-bill" class="btn btn-primary">
                                                    <i data-feather="plus"> </i>
                                                    Thêm hóa đơn
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    room_price_items: $('#add-bill-form .room-price-item'),
                                    form: $('#add-bill-form'),
                                    modal: $("#addBill"),
                                    submit: $('#submit-add-bill')
                                };

                                let block_bill_setting = JSON.parse(JSON.stringify({ "note": { "content": null }, "enable_qr": 1, "payment_default": "cash", "show_circle_day": 0, "single_send_zalo": 0, "template_bill_zalo": 1, "enable_rounding_money": 1, "extract_receipt_expense": 0 }));

                                let cell = null;
                                let roomData = null;
                                let room_price_item_start = null;
                                let room_price_item_save = null;
                                let sugget_addition_items = [];
                                let date_terminate = null;
                                let priceItemHasBelongToDays = [];

                                // Kiểm tra xem có tính tiền thuê phòng/giường;
                                const isShowRoomAmount = (reason_id) => Boolean((reason_id === 1 || reason_id === 2 || reason_id === 4));

                                // Kiểm tra xem có show thời gian ở hay không;
                                const isShowCalculateTime = (reason_id) => Boolean((reason_id === 1 || reason_id === 2 || reason_id === 3 || reason_id === 4 || reason_id === 5));

                                // Kiểm tra xem có tính tiền dịch vụ hay không;
                                const isShowPriceItem = (reason_id) => Boolean(reason_id === 1 || reason_id === 2 || reason_id === 3 || reason_id === 5);

                                // Kiểm tra show thu tiền cọc;
                                const isShowDepositContractAdd = (reason_id) => Boolean(reason_id === 2 || reason_id === 6);
                                // Kiểm tra show hủy tiền cọc;
                                const isShowDepositContractReturn = (reason_id) => Boolean(reason_id === 3 || reason_id === 7);

                                const isShowDepositContract = (reason_id) => Boolean(isShowDepositContractAdd(reason_id) || isShowDepositContractReturn(reason_id));

                                // Render các tổng của các thành phần tính tiền cho người dùng thấy
                                const reRenderTotal = () => {
                                    if (!roomData) {
                                        $.notify({
                                            title: 'Thông báo!',
                                            message: 'Không tìm thấy dữ liệu phòng để lập hóa đơn.'
                                        }, {
                                            type: "error",
                                        });
                                        return false;
                                    }
                                    let totalBill = 0;

                                    let reason_id = parseInt(__el.form.find('#reason_id').find(":selected").val());
                                    let monthAmount = parseInt(__helper.convertStringToNumber(__el.form.find('input[name="month_amount"]').val()) ?? 0);
                                    let dayAmount = parseInt(__helper.convertStringToNumber(__el.form.find('input[name="day_amount"]').val()) ?? 0);

                                    // Tính tiền phòng;
                                    let totalDays = monthAmount * 30 + dayAmount;
                                    let totalRoom = parseInt(totalDays * (roomData.room_amount / 30));
                                    if (isShowRoomAmount(reason_id)) {
                                        totalBill += totalRoom;
                                    }

                                    let priceItems = {
                                        count: 0,
                                        currentPriceItem: [],
                                        total: 0
                                    };

                                    let price_items_belong_to_date = parseInt(__el.form.find('input[name="price_items_belong_to_date"]').val());
                                    let current_price_item_form = __el.form?.getObjectOfForm()?.price_items;

                                    if (room_price_item_start && current_price_item_form) {
                                        Object.keys(current_price_item_form).map((price_item_id) => {
                                            let searchItem = __helper.array.findObjectInArray(price_item_id, 'id', room_price_item_start);

                                            if (searchItem && parseInt(current_price_item_form[searchItem.id]?.is_selected)) {
                                                priceItems.count += 1;

                                                let totalItem = 0;
                                                let priceItemForm = current_price_item_form[searchItem.id];

                                                if (searchItem.subtraction) {
                                                    let subtraction = parseInt(__helper.convertStringToNumber(priceItemForm['value'][1] ?? '0')) - parseInt(__helper.convertStringToNumber(priceItemForm['value'][0] ?? '0'));

                                                    totalItem = (subtraction > 0 ? subtraction : 0) * searchItem.price;

                                                    searchItem.value[1] = parseInt(__helper.convertStringToNumber(priceItemForm['value'][1] ?? '0'));
                                                    searchItem.value[0] = parseInt(__helper.convertStringToNumber(priceItemForm['value'][0] ?? '0'));
                                                } else {
                                                    totalItem = parseInt(__helper.convertStringToNumber(priceItemForm['value'][0] ?? '0')) * searchItem.price;

                                                    searchItem.value = [parseInt(__helper.convertStringToNumber(priceItemForm['value'][0] ?? '0'))];
                                                }

                                                if (['nguoi', 'chiec', 'thang'].includes(searchItem['unit']) && __el.form.find('input[name="price_items_belong_to_date"]').is(':checked')) {
                                                    priceItems.total += monthAmount * totalItem + __helper.roundingMoney(dayAmount * totalItem / 30);
                                                } else {
                                                    priceItems.total += totalItem;
                                                }

                                                priceItems.currentPriceItem.push(searchItem);
                                            }
                                        });
                                        room_price_item_save = priceItems.currentPriceItem;
                                    } else {
                                        room_price_item_save = null;
                                    }
                                    // Tính tiền dịch vụ;
                                    if (isShowPriceItem(reason_id)) {
                                        totalBill += (priceItems?.total ?? 0);
                                    }

                                    // Tính tiền thu cọc hoặc hoàn cọc;
                                    let depositType = parseInt(__el.form.find('input[name="deposit"]').val());
                                    let deposit_contract_amount = depositType * parseInt(__helper.convertStringToNumber(__el.form.find('input[name="deposit_contract_amount"]').val()) ?? 0);
                                    if (isShowDepositContractAdd(reason_id) || isShowDepositContractReturn(reason_id)) {
                                        totalBill += deposit_contract_amount;
                                    }

                                    // Tính tiền giảm trừ cộng thêm;
                                    let addition = parseInt(__el.form.find('input[name="addition"]:checked').val());
                                    let addition_text = addition > 0 ? 'Cộng thêm' : 'Giảm trừ';
                                    let addition_value = addition * parseInt(__helper.convertStringToNumber(__el.form.find('input[name="addition_value"]').val()) ?? 0);
                                    let addition_reason = __el.form.find('textarea[name="addition_reason"]').val();
                                    totalBill += addition_value;

                                    if (totalBill && block_bill_setting?.enable_rounding_money) {
                                        totalBill = __helper.roundingMoney(totalBill);
                                    }

                                    // Xử lý hiển thị tiền nhà;
                                    __el.modal.find(".bill-month-amount-text").text(`${monthAmount} tháng`);
                                    __el.modal.find(".bill-day-amount-text").text(`${dayAmount} ngày`);
                                    __el.modal.find(".bill-room-amount").text(`${__format.currency(roomData.room_amount)}`);
                                    __el.modal.find(".bill-total-room").text(`${__format.currency(totalRoom)}`);

                                    // Xử lý hiển thị tiền dich vụ
                                    __el.modal.find(".bill-count-price-item").text(priceItems.count);
                                    __el.modal.find(".bill-total-price-items").text(`${__format.currency(priceItems.total)}`);

                                    // Xử lý hiển thị tiền addition
                                    __el.modal.find(".bill-total-addition").text(`${__format.currency(addition_value)}`);
                                    __el.modal.find(".bill-addition-text").text(addition_text);
                                    __el.modal.find(".bill-addition-reason-text").text(addition_reason.length > 0 ? addition_reason : 'Chưa có lý do');

                                    // Xử lý hiển thị tổng;
                                    __el.modal.find(".bill-total").text(`${__format.currency(totalBill)}`);
                                };

                                // Renter các price item
                                const reRenderFormPriceItems = (priceItems) => {
                                    if (priceItems) {
                                        __el.room_price_items.html('');
                                        room_price_item_save = JSON.parse(JSON.stringify(priceItems)) ?? [];

                                        Array.isArray(room_price_item_save) &&
                                            room_price_item_save.length > 0 &&
                                            room_price_item_save.sort((itemA, itemB) => {
                                                if (itemA.subtraction && !itemB.subtraction) {
                                                    return -1;
                                                } else if (!itemA.subtraction && itemB.subtraction) {
                                                    return 1;
                                                } else {
                                                    return 0;
                                                }
                                            }).map((item, key) => {
                                                let container = $(`<div class="item">`);
                                                let checkNameContainer = $(`<div class="item-check-name">`);

                                                checkNameContainer.append(`<input class="form-check-input" type="hidden" value="${item.id}" name="price_items[${item.id}][id]">`);
                                                checkNameContainer.append(`<input class="form-check-input" data-price-item-unit="${item.unit}" type="checkbox" id="bill_check_price_item_${item.id}" value="1" checked name="price_items[${item.id}][is_selected]">`);

                                                if (item.type === 'frame' && !__helper.checkType.isEmpty(item.frames)) {
                                                    checkNameContainer.append(`<label for="bill_check_price_item_${item.id}"><b>${item.name}</b>` +
                                                        $.map(item.frames, function (frame, key) {
                                                            return `<div> ${parseInt(key) !== 0 ? item.frames[parseInt(key) - 1]['volume'] : 0} - ${frame.volume}, Giá: <b>${__format.currency(frame.price)}/${item.unit_text}</b></div>`
                                                        }).join('')
                                                        + "</label>")
                                                } else {
                                                    checkNameContainer.append(`<label for="bill_check_price_item_${item.id}"><b>${item.name}</b> <div>Giá: <b>${__format.currency(item.price)}</b> / ${item.unit_text}</div> </label>`);
                                                }

                                                let valueContainer = $('<div class="item-value">');
                                                if (item.subtraction) {
                                                    valueContainer.append(`<div class="input-group mb-2"><input class="form-control" min="0" id="bill_price_item_${item.id}_0" type="number" placeholder="Nhập số cũ" value="${item?.value ? item?.value[0] : 0}" name="price_items[${item.id}][value][0]"><label class="input-group-text" for="bill_price_item_${item.id}_0">Số cũ</label></div>`);
                                                    valueContainer.append(`<div class="input-group"><input class="form-control" min="0" id="bill_price_item_${item.id}_1" type="number" placeholder="Nhập số mới" value="${item?.value ? item?.value[1] : 0}" name="price_items[${item.id}][value][1]"> <label class="input-group-text" for="bill_price_item_${item.id}_1">Số mới</label></div>`);
                                                } else {
                                                    valueContainer.append(`<div class="input-group"><input data-price-item-unit="${item.unit}" class="form-control" min="0" type="number" id="bill_price_item_${item.id}" placeholder="Nhập giá trị" value="${item?.value[0] ?? ''}" name="price_items[${item.id}][value][0]"> <label class="input-group-text" for="bill_price_item_${item.id}">${item.unit_text}</label></div>`);
                                                }
                                                __el.room_price_items.append(container.append(checkNameContainer).append(valueContainer));
                                            });
                                    } else {
                                        __el.room_price_items.html('');
                                    }
                                };

                                // Kiểm tra ngày có hợp lệ không
                                const isValidDate = (dateInput) => {

                                    if (!dateInput instanceof Date) {
                                        console.log(dateInput + " không phải là ngày tháng");
                                        return false;
                                    }

                                    let year = dateInput.getFullYear();
                                    let month = dateInput.getMonth() + 1;
                                    let day = dateInput.getDate();

                                    // Kiểm tra xem năm có trong khoảng từ 1 đến 9999
                                    if (year < 1 || year > 9999) {
                                        console.log("Sai năm " + year);
                                        return false;
                                    }

                                    // Kiểm tra xem tháng có trong khoảng từ 1 đến 12
                                    if (month < 1 || month > 12) {
                                        console.log("Sai tháng " + month);
                                        return false;
                                    }

                                    // Kiểm tra số ngày hợp lệ của từng tháng
                                    const daysInMonth = new Date(year, month, 0).getDate();
                                    if (day < 1 || day > daysInMonth) {
                                        console.log("Sai ngày " + day);
                                        return false;
                                    }

                                    return true;
                                }

                                // Lấy ngày cuối cùng của một ngày cho trước;
                                const getLastDayOfMonth = (dateString) => {
                                    let date = new Date(dateString);
                                    lastDayInMonth = (new Date(date.getFullYear(), date.getMonth() + 1, 0)).getDate();
                                    return new Date(date.getFullYear(), date.getMonth(), lastDayInMonth);
                                }

                                // Lấy số ngày trong tháng của một ngày đã cho
                                const getDaysInMonth = (dateInput) => {
                                    let date = new Date(dateInput);
                                    return (new Date(date.getFullYear(), date.getMonth() + 1, 0)).getDate();
                                }

                                // Kiểm tra một ngày có phải đang ở cuối tháng;
                                const isLastDay = (dateInput) => {
                                    let date = new Date(dateInput);
                                    return getDaysInMonth(date) === date.getDate();
                                }

                                // Tính ra số tháng và ngày lẻ của 2 ngày cho trước;
                                const getMonthsAndDays = (fromDate, toDate, debug = false) => {
                                    let date1 = new Date(fromDate);
                                    let date2 = new Date(toDate);

                                    let startYear = date1.getFullYear();
                                    let startMonth = date1.getMonth();
                                    let startDate = date1.getDate();
                                    let daysInMonthOfStartDate = (new Date(startYear, startMonth + 1, 0)).getDate();

                                    let endYear = date2.getFullYear();
                                    let endMonth = date2.getMonth();
                                    let endDate = date2.getDate();
                                    let daysInMonthOfEndDate = (new Date(endYear, endMonth + 1, 0)).getDate();

                                    // Tổng số ngày khác;
                                    let daysDiff = Math.ceil(Math.abs(date2.setHours(23, 59, 59, 999) - date1.setHours(0, 0, 0, 0)) / (1000 * 3600 * 24))

                                    if (!isValidDate(date1)) {
                                        alert("Ngày bắt đầu không hợp lệ! " + date1);
                                        return {
                                            months: 0,
                                            days: 0,
                                            daysDiff: 0
                                        };
                                    }

                                    if (!isValidDate(date2)) {
                                        alert("Ngày kết thúc không hợp lệ! " + date2);
                                        return {
                                            months: 0,
                                            days: 0,
                                            daysDiff: 0
                                        };
                                    }

                                    // Khởi tạo giá trị;
                                    let months = 0;
                                    let days = 0;

                                    // Duyệt qua từng tháng từ ngày cho trước đến ngày hiện tại
                                    let runYear = startYear;
                                    let runMonth = startMonth;
                                    while ((runYear === endYear && runMonth <= endMonth) || runYear < endYear) {

                                        let isStart = runMonth === startMonth && runYear === startYear;
                                        let isEnd = runMonth === endMonth && runYear === endYear;
                                        let isMiddle = !isStart && !isEnd;

                                        if (!isMiddle) {
                                            // So sánh trong 1 tháng
                                            if (isStart && isEnd) {
                                                if (startDate === 1 && endDate === daysInMonthOfStartDate) {
                                                    months++;
                                                } else {
                                                    days += (endDate - startDate) + 1;
                                                }
                                            } else {

                                                // Nếu là điểm bắt đầu;
                                                if (isStart) {
                                                    // Đếm số ngày ở;
                                                    let countDays = (daysInMonthOfStartDate - startDate) + 1;

                                                    if (countDays === daysInMonthOfStartDate) {
                                                        months++;
                                                    } else {
                                                        days += countDays;
                                                    }
                                                }

                                                // Nếu là điểm cuối;
                                                if (isEnd) {
                                                    if (endDate === daysInMonthOfEndDate) {
                                                        months++;
                                                    } else {
                                                        days += (endDate === 1 ? 0 : endDate);
                                                    }
                                                }
                                            }
                                        } else {
                                            // Nếu là các tháng chính giữ (Middle);
                                            months++;
                                        }

                                        debug &&
                                            console.log(isStart, isMiddle, isEnd, "runing month: " + (runMonth + 1), 'last day: ' + (new Date(runYear, runMonth + 1, 0)).getDate(), 'months: ' + months, 'days: ' + days);

                                        // Tăng thêm runMonth & và kiểm tra xem khi đạt tới 12 tháng;
                                        runMonth++;
                                        if (runMonth === 12) {
                                            runMonth = 0;
                                            runYear++;
                                        }
                                    }

                                    // Xử lý 2 ngày đầu và ngày cuối trùng nhau chỉ khác tháng hoặc năm;
                                    if (startDate === endDate && startDate !== 1 && (startMonth !== endMonth || startYear !== endYear)) {
                                        return {
                                            months: endDate !== daysInMonthOfEndDate ? months + 1 : months,
                                            days: 0,
                                            daysDiff: daysDiff
                                        };
                                    }

                                    // Xử lý khi số ngày lẻ lớn hơn 30. Gây ra do tổng ngày lẻ của điển bắt đầu & ngày lẻ của diểm cuối;
                                    if (days >= 30) {
                                        months = months + Math.floor(days / 30);
                                        days = days % 30;
                                    }

                                    return {
                                        months: months,
                                        days: days,
                                        daysDiff: daysDiff
                                    };
                                };

                                // Lấy thông tin ngày tháng và số tháng ngày lẻ đã ở;
                                const calculateSpentTime = (reasonIdInit = null, contract = null, currentRoom = null, dateFromInput = null, dateToInput = null) => {
                                    if (dateFromInput && dateToInput) {
                                        const { months, days, daysDiff } = getMonthsAndDays(dateFromInput, dateToInput);
                                        return {
                                            date_from: dateFromInput,
                                            date_to: dateToInput,

                                            month_amount: months,
                                            day_amount: days,
                                        };
                                    }

                                    let date_from = null;
                                    let date_to = null;

                                    let bills_count = contract?.bills_count ?? null;
                                    let circle_month = currentRoom?.circle_month ?? null;
                                    let circle_day = currentRoom?.circle_day ?? null;

                                    // Ngày vào ở;
                                    let date_join = contract?.date_join ? new Date(contract?.date_join) : null;

                                    // Lấy ra ngày cuối cùng thanh toán phí;
                                    let date_last_room_amount = currentRoom?.room_amount_date_to ?? null;
                                    if (date_last_room_amount) {
                                        date_last_room_amount = new Date(date_last_room_amount);
                                        // Kiểm tra xem có phải là ngày cuối tháng;
                                        if (isLastDay(date_last_room_amount)) {
                                            date_last_room_amount.setDate(date_last_room_amount.getDate() + 1);
                                        }
                                    }

                                    date_from = dateFromInput;
                                    if (!dateFromInput) {
                                        if (!bills_count) {
                                            // Kiểm tra phòng/giường chưa có bill nào;
                                            let dateFromInit = date_last_room_amount ?? date_join;
                                            date_from = dateFromInit ? new Date(dateFromInit) : new Date();
                                        } else {
                                            // Kiểm tra phòng/giường đã có bill;
                                            let dateFrom = date_last_room_amount ?? null;
                                            if (dateFrom && isValidDate(new Date(dateFrom))) {
                                                date_from = new Date(dateFrom);
                                            }
                                        }
                                    }

                                    if ((reasonIdInit === 2 && circle_month === 1) || (reasonIdInit === 2 && date_from.getDate() === 1 && circle_month === 1)) {
                                        // Nếu thu tiền của tháng đầu tiên & chu kỳ thu tiền 1 tháng
                                        if (currentRoom?.circle_day) {
                                            if (date_from.getDate() >= circle_day) {
                                                // Lấy ngày kết thúc là ngày ngày của circle của tháng tới số với ngày bắt đầu
                                                date_to = new Date(date_from.getFullYear(), date_from.getMonth() + circle_month, circle_day);
                                            } else {
                                                // Lấy ngày kết thúc là ngày của circle trong cùng một tháng so với ngày bắt đầu;
                                                date_to = new Date(date_from.getFullYear(), date_from.getMonth(), circle_day);
                                            }
                                        } else {
                                            // Ngày cuối tháng
                                            date_to = new Date(date_from.getFullYear(), date_from.getMonth() + 1, 0);
                                        }
                                    } else {
                                        // Cộng thêm chu kỳ 1 hoặc nhiều tháng vào ngày bắt đầu để tạo ra ngày kết thúc;
                                        date_to = new Date(date_from.getFullYear(), date_from.getMonth() + (circle_month ?? 1), date_from.getDate());
                                    }

                                    if (!date_from || !date_to) {
                                        return {
                                            date_from,
                                            date_to,
                                            month_amount: 0,
                                            day_amount: 0,
                                        };
                                    }

                                    const { months, days } = getMonthsAndDays(date_from, date_to);
                                    return {
                                        date_from,
                                        date_to,
                                        month_amount: months,
                                        day_amount: days,
                                    };
                                };

                                flatpickr(__el.form.find('input[name="month"]'), {
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "m/Y",
                                    locale: 'vn',
                                    defaultDate: 'today',
                                    plugins: [
                                        new monthSelectPlugin({
                                            shorthand: true, //defaults to false
                                            dateFormat: "m/Y", //defaults to "F Y"
                                            altFormat: "F Y", //defaults to "F Y"
                                            theme: "light" // defaults to "light"
                                        })
                                    ]
                                });

                                flatpickr(__el.form.find('input[name="date"]'), {
                                    defaultDate: 'today',
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "d/m/Y",
                                    locale: 'vn'
                                });

                                flatpickr(__el.form.find('input[name="deadline_bill_date"]'), {
                                    defaultDate: new Date().fp_incr(__current_block?.deadline_bill ?? 0).toLocaleDateString('vi', {
                                        year: "numeric",
                                        month: "2-digit",
                                        day: "numeric"
                                    }),
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "d/m/Y",
                                    locale: 'vn'
                                });

                                let date_from_pre = null;
                                flatpickr(__el.form.find('input[name="date_from"]'), {
                                    defaultDate: null,
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "d/m/Y",
                                    locale: 'vn',
                                    onOpen: function (selectedDates, dateStr, instance) {
                                        date_from_pre = selectedDates.length !== 0 ? selectedDates[0].toLocaleDateString() : null;
                                    },
                                    onChange: function (selectedDates, dateStr, instance) {
                                        let dateFrom = new Date(selectedDates[0]);
                                        let reason_id = parseInt(__el.form.find('#reason_id').find(":selected").val());

                                        if (date_from_pre !== dateFrom.toLocaleDateString()) {

                                            date_from_pre = dateFrom.toLocaleDateString();
                                            let dateTo = null;
                                            if (date_terminate && reason_id === 3) {
                                                dateTo = date_terminate;
                                            }

                                            const {
                                                date_from,
                                                date_to
                                            } = calculateSpentTime(reason_id, roomData?.contract, roomData, dateFrom, dateTo);

                                            prepareStore(reason_id, room_price_item_save, date_from, date_to);
                                        }
                                    }
                                });

                                let date_to_pre = null;
                                flatpickr(__el.form.find('input[name="date_to"]'), {
                                    defaultDate: null,
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "d/m/Y",
                                    locale: 'vn',
                                    onOpen: function (selectedDates, dateStr, instance) {
                                        date_from_pre = selectedDates.length !== 0 ? selectedDates[0].toLocaleDateString() : null;
                                    },
                                    onChange: function (selectedDates, dateStr, instance) {
                                        let dateTo = new Date(selectedDates[0]);
                                        let reason_id = parseInt(__el.form.find('#reason_id').find(":selected").val());

                                        let data = __el.form.getObjectOfForm();
                                        let dateFrom = new Date(data?.date_from) ?? new Date();

                                        if (date_to_pre !== dateTo.toLocaleDateString()) {

                                            date_to_pre = dateTo.toLocaleDateString();
                                            if (reason_id === 3) {
                                                date_terminate = dateTo;
                                            }

                                            const {
                                                date_from,
                                                date_to
                                            } = calculateSpentTime(reason_id, roomData?.contract, roomData, dateFrom, dateTo);

                                            prepareStore(reason_id, room_price_item_save, date_from, date_to);
                                        }
                                    }
                                });

                                const getAdditionFromItem = () => {
                                    let data = __el.form.getObjectOfForm();

                                    let addition_amount = 0;
                                    let addition_reason = [];

                                    if (Object.keys(data?.addition_items ?? {}).length !== 0) {
                                        Object.keys(data.addition_items).map((index) => {
                                            let item = data.addition_items[index];
                                            addition_amount += item.addition * item.addition_value;

                                            if (item.addition_reason)
                                                addition_reason.push(item.addition_reason);
                                        });
                                        if (addition_amount > 0)
                                            __el.form.find('input[name="addition"][value="1"]').prop("checked", true);

                                        if (addition_amount < 0)
                                            __el.form.find('input[name="addition"][value="-1"]').prop("checked", true);

                                        __el.form.find('input[name="addition_value"]').val(Math.abs(addition_amount));
                                        __el.form.find('textarea[name="addition_reason"]').val(addition_reason.join(', '));
                                    } else {
                                        __el.form.find('input[name="addition"][value="1"]').prop("checked", true);
                                        __el.form.find('input[name="addition_value"]').val('');
                                        __el.form.find('textarea[name="addition_reason"]').val('');
                                    }

                                    reRenderTotal();
                                }

                                const additionAdd = (index = null, dataDefault = null) => {
                                    if (!index) {
                                        index = __el.form.find('#addition-item .item').length;
                                    }

                                    // Tạo phần tử mới
                                    const newItem = `
                <div class="row g-0 item mt-1 mb-1">
                    <div class="col-3">
                        <div class="middle-item border-right full">
                            <div class="border-bottom center-item full p-2">
                                <div class="form-check">
                                    <input data-format="numeric" class="form-check-input" type="radio" name="addition_items[${index}]['addition']" id="addition_a_bill_${index}" checked="${dataDefault?.addition && dataDefault?.addition === 1}" value="1">
                                    <label class="form-check-label" for="addition_a_bill_${index}">Cộng [+]</label>
                                </div>
                            </div>
                            <div class="center-item full p-2">
                                <div class="form-check">
                                    <input data-format="numeric" class="form-check-input" type="radio" name="addition_items[${index}]['addition']" id="addition_b_bill_${index}" checked="${dataDefault?.addition && dataDefault?.addition === -1}" value="-1">
                                    <label class="form-check-label" for="addition_b_bill_${index}">Giảm [-]</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-8 border-right">
                        <div class="row">
                            <div class="col-12">
                                <div class="form-floating">
                                    <input data-format="numeric" type="text" min="0" class="border-bottom form-control" name="addition_items[${index}]['addition_value']" placeholder="Số tiền cộng thêm hoặc giảm trừ" value="${dataDefault?.addition_value ? __format.currencyInput(dataDefault?.addition_value) : ''}" required>
                                    <label for="addition_value_${index}">Số tiền (đ)</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating">
                                    <textarea type="text" rows="10" style="min-height: 60px" class="form-control" name="addition_items[${index}]['addition_reason']" placeholder="Nhập lý do" value="${dataDefault?.addition_reason ? dataDefault?.addition_reason : ''}" required>${dataDefault?.addition_reason ? dataDefault?.addition_reason : ''}</textarea>
                                    <label for="addition_reason_${index}">Lý do</label>
                                </div>
                            </div>
                        </div>    
                    </div>  
                    <div class="col-1" style="border-radius: 0 5px 5px 0;display: flex;flex-direction: column;justify-content: center;align-items: center;background-color: #ffeee9;">
                        <button class="btn delete" type="button" style="color:red; height: 100%;">Xóa</button>
                    </div>  
                </div>`;

                                    // Thêm phần tử mới vào addition-item
                                    __el.form.find('#addition-item').append(newItem);

                                    __el.form.find('input[data-format="numeric"][type="text"]').on('input', function () {
                                        let value = $(this).val();

                                        let number = __helper.convertStringToNumber(value);
                                        let newVal = __format.currencyInput(number);

                                        $(this).val(value === '' ? '' : isNaN(number) ? '' : newVal);
                                    });

                                    getAdditionFromItem();

                                    // Cật nhật là thuộc tính sử dụng của đề nghị;
                                    if (dataDefault && dataDefault.length !== 0) {
                                        sugget_addition_items = sugget_addition_items.map((item) => {
                                            if (item.id === dataDefault.id) {
                                                item.has_use = 1;
                                            }
                                            return item;
                                        });
                                        renderAdditionSuggestion(sugget_addition_items);
                                    }
                                };

                                const renderAdditionSuggestion = (data = null) => {
                                    __el.form.find('.addition-suggestion-layout .content-suggest').html('');
                                    let showSuggest = false;
                                    if (data?.length > 0) {
                                        data = data.map((item) => {
                                            if (!item?.has_use) {
                                                showSuggest = 1;
                                                __el.form.find('.addition-suggestion-layout .content-suggest').append($('<div class="col-12 d-flex mb-2" style="padding: 10px;border: 1px solid #ced4da;border-radius: 7px;">').append(
                                                    `
                            <div style="flex:1">
                                <b>${item.addition_title}</b>
                                <div style="font-size: 20px;color:${item.addition > 0 ? '#4CAF50' : '#FF5722'}"><b>${__format.currencyInput(item.addition * item.addition_value)}đ</b></div>
                                <p>${item.addition_reason}</p>
                            </div>
                        `
                                                ).append($(`
                            <div class="middle-item">
                                <a href="javascript:;" style="color: #0d6efd;text-decoration: underline;border: 1px solid;border-radius: 5px;padding:7px 10px;margin-left: 10px;">
                                    Áp dụng
                                </a>
                            </div>
                        `).click(() => additionAdd(null, item))));
                                            }
                                            return item;
                                        });
                                    }
                                    __el.form.find('.addition-suggestion-layout').css('display', showSuggest ? 'block' : 'none');
                                }

                                // Áp dụng mục đề xuất tới addition;
                                const useAdditionSuggest = (additionSuggestItem) => {
                                    additionAdd(null, additionSuggestItem);
                                }

                                __el.form.on('keyup', '#addition-item textarea', function (e) {
                                    getAdditionFromItem();
                                });

                                // Xóa phần tử khi nhấn nút xóa
                                $(document).find('.addition-layount ').on('click', '.delete', function () {
                                    $(this).closest('.item').remove();
                                    getAdditionFromItem();
                                });

                                __el.form.find('.addition-layount #addition-add').on('click', (e) => {
                                    additionAdd();
                                });


                                __el.form.on('change', 'input', function (e) {
                                    if (['radio', 'number', 'text', 'checkbox'].includes($(this).attr('type'))) {
                                        getAdditionFromItem();
                                        reRenderTotal();
                                    }
                                });

                                __el.form.on('keyup', 'input', function (e) {
                                    if (['radio', 'number', 'text', 'checkbox'].includes($(this).attr('type'))) {
                                        getAdditionFromItem();
                                        reRenderTotal();
                                    }
                                });

                                __el.form.on('change', 'textarea', function (e) {
                                    reRenderTotal();
                                });

                                __el.form.find('#reason_id').on('change', function () {
                                    let reason_id = parseInt($(this).find(":selected").val());
                                    let data = __el.form.getObjectOfForm();

                                    let dateFrom = data?.date_from ?? null;
                                    let dateTo = data?.date_to ?? null;

                                    const {
                                        date_from,
                                        date_to
                                    } = calculateSpentTime(reason_id, roomData?.contract, roomData, dateFrom, dateTo);

                                    prepareStore(reason_id, room_price_item_save, date_from, date_to);
                                });


                                /**
                                 * Tính ra khối lượng khách sử dụng của một item
                                 * Tính tổng số tiền khách sử dụng của một item
                                 * @param  {*} priceItem 
                                 * @param  {*} price_items_belong_to_date 
                                 * @param  {*} month 
                                 * @param  {*} day 
                                 * @returns  
                                 */
                                const getCustomerUse = (priceItem, price_items_belong_to_date = 0, days = 0) => {
                                    let customerUse = 0;
                                    let customerUseDescription = "";

                                    let total = 0;
                                    let totalDescription = "";

                                    let textDeta = "";

                                    if (priceItem?.subtraction === 1) {
                                        textDeta = `[0 - 0]`;
                                        if (!__helper.checkType.isEmpty(priceItem?.value)) {
                                            customerUse = (parseInt(priceItem?.value[1] ?? 0) - parseInt(priceItem.value[0] ?? 0)) ?? 0;
                                            customerUseDescription = `Số cũ: ${parseInt(priceItem.value[0] ?? 0)} - Số mới: ${parseInt(priceItem?.value[1] ?? 0)}`;
                                            textDeta = `[${parseInt(priceItem.value[0] ?? 0)} - ${parseInt(priceItem?.value[1] ?? 0)}]`;
                                        } else {
                                            textDeta = `Không sử dụng`;
                                        }
                                    }

                                    if (priceItem?.subtraction === 0) {
                                        if (!__helper.checkType.isEmpty(priceItem?.value)) {
                                            customerUse = parseInt(priceItem.value[0] ?? 0) ?? 0;
                                        }
                                    }

                                    total = priceItem.price * customerUse;
                                    totalDescription = customerUse ? `${customerUse} ${priceItem.unit_text} x ${priceItem.price} đ` : 'Không sử dụng';

                                    // Khi dịch vụ phụ thuộc vào ngày ở;
                                    if (['nguoi', 'chiec', 'thang'].includes(priceItem?.unit) && price_items_belong_to_date) {
                                        total = __helper.roundingMoney(days * total / 30);
                                        if (priceItem?.unit === 'thang') {
                                            totalDescription = customerUse ? `${priceItem.price} đ/${priceItem.unit_text} cho ${days} ngày` : 'Không sử dụng';
                                        } else {
                                            totalDescription = customerUse ? `${customerUse} ${priceItem.unit_text} x ${__format.currency(priceItem.price)} đ cho ${days} ngày` : 'Không sử dụng';
                                        }

                                    }

                                    // Tính theo giá bậc thang;
                                    if (customerUse && priceItem.type === 'frame' && !__helper.checkType.isEmpty(priceItem.frames)) {
                                        let remain = customerUse;
                                        for (const [index, frame] of priceItem.frames.entries()) {
                                            if (!__helper.checkType.isEmpty(frame)) {
                                                const deltaVolume = parseInt(frame.volume) - (index > 0 ? priceItem.frames[index - 1].volume : 0);
                                                if (remain <= deltaVolume) {
                                                    total = remain * frame.price;
                                                    break;
                                                }
                                                remain = remain - deltaVolume;

                                                total = (deltaVolume + remain * Number(index + 1 === priceItem.frames.length)) * frame.price;
                                            }
                                        }
                                        totalDescription = customerUse ? `Tính theo định mức` : 'Không sử dụng';
                                    }

                                    return {
                                        customerUse,
                                        customerUseDescription,

                                        total,
                                        totalDescription,

                                        textDeta
                                    };
                                }

                                const prepareStore = (reason_id, price_items_input = null, date_from_input = null, date_to_input = null) => {
                                    // Lấy giá trị form hiện tại;
                                    let dataForm = __el.form.getObjectOfForm();
                                    let price_items_init = null;

                                    if (price_items_input) {
                                        price_items_init = price_items_input;
                                    }
                                    if (dataForm?.price_items && room_price_item_save) {
                                        price_items_init = room_price_item_save;
                                    }

                                    $.transferData({
                                        method: "POST",
                                        url: __helper.url.urlPattern(__routeApi.bill.prepareStore, {
                                            room_id: roomData.id
                                        }),
                                        data: {
                                            month: parseInt(__el.form.find('input[name="month"]').val().split("/")[0]),
                                            reason_id: reason_id ?? null,
                                            price_items: price_items_init,

                                            date_from: date_from_input ?? null,
                                            date_to: date_to_input ?? null
                                        },
                                        success: function (res) {
                                            let dataRes = res?.data;
                                            let roomDetail = dataRes?.room;
                                            let contract = dataRes?.room?.contract ?? null;
                                            let reason_id_default = dataRes?.reason_id_default ?? [];

                                            let room_debt = dataRes?.room_debt ?? 0;
                                            let room_debt_format = dataRes?.room_debt_format ?? 0;

                                            let date_from = dataRes?.date_from ?? null;
                                            let date_to = dataRes?.date_to ?? null;
                                            let month_amount = dataRes?.month_amount ?? 0;
                                            let day_amount = dataRes?.day_amount ?? 0;
                                            let total_day = (month_amount * 30) + day_amount;

                                            sugget_addition_items = dataRes?.sugget_addition_items ?? [];

                                            renderAdditionSuggestion(sugget_addition_items);

                                            // Xử lý: Lý do thu tiền
                                            let reasonId = reason_id_default ?? reason_id ?? parseInt(__el.form.find('#reason_id').find(":selected").val()) ?? 1;

                                            // Xử lý tiền dịch vụ
                                            let price_items = [];
                                            if (isShowPriceItem(reasonId)) {

                                                if (!__helper.checkType.isEmpty(roomDetail?.price_items)) {
                                                    price_items = roomDetail?.price_items;
                                                }
                                                if (!__helper.checkType.isEmpty(price_items_input)) {
                                                    price_items = price_items_input;
                                                }

                                                if (!__helper.checkType.isEmpty(price_items)) {
                                                    priceItemHasBelongToDays = [];
                                                    $.each(price_items, function (index, item) {
                                                        if (['nguoi', 'chiec', 'thang'].includes(item?.unit)) {
                                                            const { customerUse } = getCustomerUse(item, price_items_belong_to_date, (month_amount * 30 + day_amount));
                                                            if (customerUse > 0)
                                                                priceItemHasBelongToDays.push(item.name);
                                                        }
                                                    });

                                                    if (!__helper.checkType.isEmpty(priceItemHasBelongToDays))
                                                        __el.modal.find(".price-item-has-belong-to-date").text(priceItemHasBelongToDays.join(', '))
                                                }
                                            }


                                            // prepare HTML;
                                            __el.modal.find(".room-name").text(`"${roomDetail.name}"`);
                                            __el.modal.find("#reason_id").val(reasonId);

                                            __el.modal.find(".room-debt-layout").css('display', room_debt ? 'block' : 'none');
                                            __el.modal.find(".room-debt").text(room_debt_format);

                                            // Hiển thị note nếu có;
                                            __el.form.find('.content_note').empty();
                                            if (roomDetail?.contract?.note) {
                                                __el.form.find('.note_contract').show();
                                                __el.form.find('.content_note').append(`<b>Ghi chú cho ${__current_block?.room_type_name ?? ''}: </b> ${roomDetail.contract.note}`)
                                            } else {
                                                __el.form.find('.note_contract').hide();
                                            }

                                            __el.form.find('input[name="month"]').get(0)._flatpickr.setDate(dataForm.month);
                                            __el.form.find('input[name="date"]').get(0)._flatpickr.setDate(dataForm.date);
                                            __el.form.find('input[name="deadline_bill_date"]').get(0)._flatpickr.setDate(new Date(dataForm.date).fp_incr(__current_block?.deadline_bill ?? 5));

                                            // Xử lý layout tính số ngày ở;
                                            __el.form.find('.calculate-spent-time-layout').css('display', 'none');
                                            if (isShowCalculateTime(reasonId)) {
                                                __el.form.find('.calculate-spent-time-layout').css('display', 'block');
                                                __el.form.find('.calculate-spent-time-text').css('display', 'block');
                                            }

                                            // Set ngày thanh toán tiền phòng;
                                            __el.form.find('.room-amount-layout').css('display', 'none');
                                            __el.form.find('.room-amount-layout input').map((index, input) => { input.removeAttribute('required') });
                                            __el.form.find('.reason_text').text(__el.form.find('#reason_id').find(":selected").text());
                                            if (isShowRoomAmount(reasonId)) {
                                                __el.form.find('.room-amount-layout input').map((index, input) => {
                                                    input.setAttribute('required', '');
                                                });
                                                __el.form.find('.room-amount-layout').css('display', 'block');
                                                __el.form.find('.calculate-spent-time-text').css('display', 'none');
                                            }

                                            __el.form.find('.date-join').text(roomDetail.contract.date_join_format ?? 'Không xác định');
                                            __el.form.find('.circle-month').text(roomDetail.circle_month ?? 'Không xác định');
                                            __el.form.find('.circle-day').text(roomDetail?.circle_day ? `ngày ${roomDetail.circle_day} thu` : 'thu cuối tháng');

                                            __el.form.find('input[name="month_amount"]').val(month_amount);
                                            __el.form.find('input[name="day_amount"]').val(day_amount);
                                            __el.form.find('input[name="date_from"]').get(0)._flatpickr.setDate(date_from);
                                            __el.form.find('input[name="date_to"]').get(0)._flatpickr.setDate(date_to);

                                            // Xử lý tiền cọc
                                            let deposit_contract_amount = 0;
                                            let depositType = -1;

                                            __el.form.find('.deposit-layout').css('display', 'none');
                                            if (isShowDepositContractAdd(reasonId)) {
                                                // Tính ra tiền cọc cần thu;
                                                deposit_contract_amount = parseInt(contract?.deposit_contract_amount ?? 0) - parseInt(contract?.real_deposit_contract_amount ?? 0);

                                                __el.form.find('.deposit-layout').css('display', 'block');
                                                __el.form.find('.title_deposit_contract_type').text("Thu tiền cọc");
                                                __el.form.find('.des_deposit_contract_type').text("Thu tiền cọc nếu có phát sinh");
                                                __el.form.find('.text-deposit').text("Số tiền cọc cần thu ");
                                                __el.form.find(".deposit-contact-paid").text(`${__format.currency(deposit_contract_amount)}`);

                                                if (contract?.real_deposit_contract_amount) {
                                                    __el.form.find(".pre-deposit-contact-paid").css('display', 'initial').html(`, Số tiền đã thu trước đó <b style="color: #3c9e47">${__format.currency(contract.real_deposit_contract_amount)}</b>`);
                                                } else {
                                                    __el.form.find(".pre-deposit-contact-paid").css('display', 'none').html(``);
                                                }

                                                // Set thể loại là thu tiền cọc;
                                                depositType = 1;
                                            }

                                            if (isShowDepositContractReturn(reasonId)) {
                                                deposit_contract_amount = contract.real_deposit_contract_amount ?? 0
                                                __el.form.find('.deposit-layout').css('display', 'block');
                                                __el.form.find('.title_deposit_contract_type').text("Trả tiền cọc");
                                                __el.form.find('.des_deposit_contract_type').text("Trả tiền cọc nếu trước đó có thu khi vào làm hợp đồng");
                                                __el.form.find('.text-deposit').text("Số tiền cọc cần hoàn ");
                                                __el.form.find(".deposit-contact-paid").text(`${__format.currency(deposit_contract_amount)}`);

                                                // Set thể loại là trả tiền cọc;
                                                depositType = -1;
                                            }

                                            __el.form.find('input[name="real_deposit_contract_amount"]').val(contract?.real_deposit_contract_amount ?? 0);
                                            __el.form.find('input[name="contract_deposit_contract_amount"]').val(contract?.deposit_contract_amount ?? 0);
                                            __el.form.find('input[name="deposit_contract_amount"]').val(__format.currencyInput(deposit_contract_amount ?? 0));
                                            __el.form.find('input[name="deposit"]').val(depositType);


                                            //Xử lý tiền dịch vụ
                                            if (!isShowPriceItem(reasonId)) {
                                                __el.form.find('.price-item-layout').css('display', 'none');
                                                __el.form.find('.waring-addtion-price-item').css('display', 'none');

                                                reRenderFormPriceItems(null);
                                            } else {
                                                __el.form.find('.price-item-layout').css('display', 'block');

                                                if (total_day != 30 && total_day > 0 && !__helper.checkType.isEmpty(priceItemHasBelongToDays)) {
                                                    __el.form.find('.waring-addtion-price-item').css('display', 'block');
                                                    __el.form.find('.spent-days').text(total_day ?? '');
                                                } else {
                                                    __el.form.find('.waring-addtion-price-item').css('display', 'none');
                                                }
                                                reRenderFormPriceItems(room_price_item_start);
                                            }

                                            reRenderTotal();
                                        },
                                        fail: (res) => {
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: res.message,
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                        }
                                    });
                                }

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0)
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {
                                        // Set data của room và price item
                                        check_terminate = relatedTarget?.__type ?? null;
                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;
                                        room_price_item_start = JSON.parse(JSON.stringify(__preparePriceItems(roomData.price_items ?? null, roomData ?? null)));

                                        __el.form.find('input[name="month"]').get(0)._flatpickr.setDate(new Date());
                                        __el.form.find('input[name="date"]').get(0)._flatpickr.setDate(new Date());
                                        __el.form.find('input[name="deadline_bill_date"]').get(0)._flatpickr.setDate(new Date().fp_incr(__current_block?.deadline_bill ?? 5));

                                        date_terminate = (relatedTarget?.date_to ?? null);

                                        prepareStore((relatedTarget?.reason_id ?? null), null, null, date_terminate);
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();
                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }

                                        if (data.addition_value && (data.addition_reason === 'undefined' || !data?.addition_reason || data?.addition_reason?.length === 0)) {
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập lý do giảm trừ hoặc cộng thêm",
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }

                                        if (parseInt(data.deposit) < 0 && data.deposit_contract_amount) {
                                            if (parseInt(roomData.contract.deposit_contract_amount) === 0) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: "Phòng này chưa được thu tiền cọc. Không thể hoàn cọc",
                                                    icon: 'error',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                                return false;
                                            }

                                            if (parseInt(roomData.contract.deposit_contract_amount) < parseInt(data.deposit_contract_amount)) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: "Số tiền hoàn lại lớn hơn số tiền đã thu. Không thể hoàn cọc",
                                                    icon: 'error',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                                return false;
                                            }
                                        }

                                        if (__el.modal.find('#send_to_zalo').is(":checked")) {
                                            var value = __el.modal.find('#send_to_zalo').val()
                                            data.send_to_zalo = parseInt(value)
                                        }

                                        data.room_id = roomData.id;
                                        data.price_items = room_price_item_save;
                                        data.month = parseInt(__el.form.find('input[name="month"]').val().split("/")[0]);
                                        data.year = parseInt(__el.form.find('input[name="month"]').val().split("/")[1]);
                                        data.reason_text = __el.form.find('select[name="reason_id"] option:selected').text();
                                        data.addition_value = parseInt(data.addition) * data.addition_value;

                                        let addition_items = Object.values(data?.addition_items ?? {});
                                        data.addition_items = addition_items.length !== 0 ? addition_items : null;

                                        if (data.deposit_contract_amount)
                                            data.deposit_contract_amount = parseInt(data.deposit) * parseInt(data.deposit_contract_amount);

                                        if (!__helper.checkType.isEmpty(data.price_items)) {
                                            let price_items_belong_to_date = __el.form.find('input[name="price_items_belong_to_date"]').is(':checked') ? 1 : 0;

                                            $.each(data.price_items, function (index, item) {
                                                const { customerUse, customerUseDescription, total, totalDescription } = getCustomerUse(item, price_items_belong_to_date, (data.month_amount * 30 + data.day_amount));
                                                item.use = customerUse
                                                item.use_description = customerUseDescription
                                                item.total = total
                                                item.total_description = totalDescription
                                            });
                                        }

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.bill.store, {
                                                room_id: data.room_id
                                            }),
                                            data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thành công!',
                                                    html: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đóng'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                                    res?.data?.room && cell &&
                                                        cell.getRow().update(res.data.room);
                                                });
                                            },
                                            fail: (res) => {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    html: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    },
                                    __closeModalForm: function (e) {
                                        __el.form.get(0).reset();
                                        check_terminate = null;
                                    },
                                });
                            });
                        </script>
                        <!-- Modal add new session -->
                        <div class="modal fade" data-bs-backdrop="static" id="terminateTicketModal" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="log-out"> </i>
                                        </div>
                                        <h5 class="modal-title">Báo kết thúc hợp đồng - <span class="room-name">Tên
                                                phòng</span> </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="terminate-ticket-form"
                                            novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">
                                                <div class="terminate-setting">
                                                    <div class="col-12">
                                                        <div class="input-group">
                                                            <div class="form-floating">
                                                                <input type="text" class="form-control date-flat-picker"
                                                                    name="date_tick_terminate"
                                                                    id="date_tick_terminate_form"
                                                                    placeholder="Ngày kết thúc hợp đồng"
                                                                    data-format="date" required>
                                                                <label for="date_tick_terminate_form">Ngày báo kết thúc
                                                                    hợp đồng</label>
                                                            </div>
                                                            <label class="input-group-text"
                                                                for="date_tick_terminate_form">
                                                                <i data-feather="calendar"> </i>
                                                            </label>
                                                        </div>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập này báo kết thúc hợp đồng
                                                        </div>
                                                    </div>
                                                    <div class="col-12 mt-2">
                                                        <div class="loz-alert info">
                                                            <div class="icon flex-0">
                                                                <i data-feather="info"> </i>
                                                            </div>
                                                            <div class="des flex-1">
                                                                <b>Thông tin:</b>
                                                                <p>- Khi khách muốn chuyển đi khách sẽ báo trước ngày
                                                                    chuyển đi. Bạn sẽ ghi nhận ngày để chuẩn bị tìm
                                                                    khách mới.</p>
                                                                <p>- Khi phòng/căn hộ/giường ở trạng thái "Đang báo kết
                                                                    thúc hợp đồng" sau hành động này. Khách mới có thể
                                                                    cọc giữ chỗ</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="task-container"></div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-terminate-ticket" class="btn btn-primary">
                                            <i data-feather="bell"> </i>
                                            Báo kết thúc hợp đồng
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    form: $('#terminate-ticket-form'),
                                    modal: $("#terminateTicketModal"),
                                    submit: $("#submit-terminate-ticket")
                                };

                                flatpickr(__el.form.find('input[name="date_tick_terminate"]'), {
                                    defaultDate: 'today',
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "d/m/Y",
                                    locale: 'vn'
                                });

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0),
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {

                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;

                                        roomData &&
                                            __el.modal.find('.room-name').text(roomData.name);
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();

                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return;
                                        }

                                        data.room_id = roomData.id;
                                        data.type = "terminate_ticket";

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.terminate.store, {
                                                room_id: data.room_id
                                            }),
                                            data: data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thành công!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0))
                                                        .hide();
                                                    res.data && cell &&
                                                        cell.getRow().update(res.data);
                                                });
                                            },
                                            fail: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    }
                                });
                            });
                        </script>
                        <!-- Modal add new session -->
                        <div class="modal fade" data-bs-backdrop="static" id="terminateModal" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="log-out"> </i>
                                        </div>
                                        <h5 class="modal-title">Kết thúc hợp đồng - <span class="room-name">Tên
                                                phòng</span> </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="terminate-form" novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">
                                                <div class="terminate-setting">
                                                    <div class="col-12">
                                                        <div class="input-group">
                                                            <div class="form-floating">
                                                                <input type="text" class="form-control date-flat-picker"
                                                                    name="date_tick_terminate" id="date_terminate_form"
                                                                    placeholder="Ngày kết thúc hợp đồng"
                                                                    data-format="date" required>
                                                                <label for="date_terminate_form">Ngày kết thúc hợp
                                                                    đồng</label>
                                                            </div>
                                                            <label class="input-group-text" for="date_terminate_form">
                                                                <i data-feather="calendar"> </i>
                                                            </label>
                                                        </div>
                                                        <div class="invalid-feedback">
                                                            Vui lòng nhập này kết thúc hợp đồng
                                                        </div>
                                                    </div>
                                                    <div class="col-12 mt-2">
                                                        <div class="loz-alert info">
                                                            <div class="icon flex-0">
                                                                <i data-feather="info"> </i>
                                                            </div>
                                                            <div class="des flex-1">
                                                                <b>Thông tin:</b>
                                                                <p>- Kết thúc hợp đồng là hành động kết thúc khi khách
                                                                    muốn chuyển đi. Sau khi kết thúc bạn có thể "Lập hợp
                                                                    đồng" cho khách mới</p>
                                                                <p>- Các thông tin như <b>Khách thuê, hợp đồng cũ</b> sẽ
                                                                    xóa bỏ để sẳn sàng cho hợp đồng mới.</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="terminate-info">
                                                    <div class="info-cancel-terminate d-flex"
                                                        style="background-color: #ff572247; border: 1px solid #ff5722;border-radius: 5px; padding: 10px;">
                                                        <i data-feather="alert-triangle"> </i>
                                                        <div style="margin-left: 20px">
                                                            <h6>Khách thuê đã báo kết thúc hợp đồng vào <span
                                                                    class="date-tick-terminate">00/00/0000</span> trước
                                                                đó</h6>
                                                            <p>Nhấn vào "kết thúc hợp đồng" để kết thúc ngay ngay bây
                                                                giờ</p>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div id="task-container"></div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-terminate" class="btn btn-primary">
                                            <i data-feather="plus"> </i>
                                            Kết thúc
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Modal deposit temp -->
                        <style type="text/css">
                            #billDetail .item.d-flex.justify-content-between {
                                padding: 10px;
                            }

                            #billDetail .item.d-flex.justify-content-between:not(:last-child) {
                                border-bottom: 0.5px solid #ccc;
                            }
                        </style>
                        <div class="modal fade" data-bs-backdrop="static" id="billDetail" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="file-text"> </i>
                                        </div>
                                        <h5 class="modal-title">Chi tiết hóa đơn</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body" style="position: relative; display: grid;">
                                        <div class="bill-detail-loading" style="position: absolute;
                width: 100%;
                height: 100%;
                background-color: #00000030;
                align-items: center;
                justify-content: center;
                display: flex;">
                                            <div class="text-center" style="padding: 20px">
                                                <img style="margin: auto"
                                                    src="https://quanlytro.me/images/icons/loading.gif"
                                                    alt="Đang tải..." width="50px" />
                                                <div>
                                                    <i class="loading_text"
                                                        style="font-size: 13px; margin-top: -10px;">Đang tải thông
                                                        báo...</i>
                                                </div>
                                            </div>
                                        </div>
                                        <form method="POST" class="needs-validation" id="bill-detail-form" novalidate>
                                            <div class="row mt-2 bill-detail">
                                                <div class="col-12">
                                                    <div style="border: 0.5px solid #ccc; border-radius: 10px;">
                                                        <div class="item d-flex justify-content-between">
                                                            <span>Ngày tạo hóa đơn</span><b class="bill-date"></b>
                                                        </div>
                                                        <div class="item d-flex justify-content-between">
                                                            <span>Ly do thu tiền</span><b class="bill-reason"></b>
                                                        </div>
                                                        <div class="item d-flex justify-content-between">
                                                            <span>Số điện thoại liên hệ</span><b class="bill-phone"></b>
                                                        </div>
                                                        <div class="item d-flex justify-content-between">
                                                            <span>Tình trạng</span><span style="background-color: #000"
                                                                class="badge bill-status"></span>
                                                        </div>
                                                        <div class="item justify-content-between"
                                                            style="padding: 10px; border-bottom: 0.5px solid #ccc;">
                                                            <div class="d-flex justify-content-start"
                                                                style="margin-bottom: 10px">
                                                                <i style="margin-right: 5px" data-feather="file-text">
                                                                </i>
                                                                <b>Danh mục tính tiền</b>
                                                            </div>
                                                            <div>
                                                                <div class="item-bill-room-amount"
                                                                    style="background-color: #eee; margin-bottom: 10px; border-radius: 7px">
                                                                    <div
                                                                        class="item d-flex justify-content-between align-items-center">
                                                                        <div>
                                                                            <div>Tiền thuê</div>
                                                                            <div>
                                                                                <b class="detail-room-amount">
                                                                                    30 ngày x 2.000.000đ
                                                                                </b>
                                                                            </div>
                                                                        </div>
                                                                        <b class="total_room_amount">2.200.000đ</b>
                                                                    </div>
                                                                </div>

                                                                <div class="item-bill-deposit"
                                                                    style="background-color: #eee; margin-bottom: 10px; border-radius: 7px">
                                                                    <div
                                                                        class="item d-flex justify-content-between align-items-center">
                                                                        <div>
                                                                            <div class="label-deposit">Tiền cọc</div>
                                                                        </div>
                                                                        <b
                                                                            class="deposit_contract_amount">2.200.000đ</b>
                                                                    </div>
                                                                    <div class="item-bill-pre-deposit item d-flex justify-content-between align-items-center"
                                                                        style="font-size: 12px;
                                            color: gray;">
                                                                        <div>
                                                                            <div class="label-pre-deposit">Tiền cọc đã
                                                                                thu trước</div>
                                                                        </div>
                                                                        <b class="pre_deposit_contract_amount">0 đ</b>
                                                                    </div>
                                                                </div>

                                                                <div class="item-bill-price-item"
                                                                    style="background-color: #eee; margin-bottom: 10px; border-radius: 7px">
                                                                    <div
                                                                        class="item d-flex justify-content-between align-items-center">
                                                                        <div>
                                                                            <div>Tiền dịch vụ</div>
                                                                        </div>
                                                                        <b class="total_price_item">2.200.000đ</b>
                                                                    </div>
                                                                </div>
                                                                <div class="item-bill-addition"
                                                                    style="background-color: #eee; margin-bottom: 10px; border-radius: 7px">
                                                                    <div
                                                                        class="item d-flex justify-content-between align-items-center">
                                                                        <div>
                                                                            <div class="addition_text">Giảm trừ</div>
                                                                        </div>
                                                                        <b class="addition_value">2.200.000đ</b>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="item d-flex justify-content-between">
                                                            <span>Giá trị hóa đơn</span><b class="bill-value"></b>
                                                        </div>
                                                        <div class="item d-flex justify-content-between">
                                                            <span class="bill-paid-total-text">Đã thu</span><b
                                                                class="bill-paid-total"></b>
                                                        </div>
                                                        <div class="item d-flex justify-content-between">
                                                            <span>Tổng số lần thu</span><b><b
                                                                    class="bill-count_pay_bill"></b> Lần</b>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="bill-history">
                                                    <div class="col-12 mt-2 mb-2">
                                                        <div class="title-item-small">
                                                            <b>Lịch sử thu tiền</b>
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <div style="border: 0.5px solid #ccc; border-radius: 10px;">
                                                            <div class="history-pay">

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal_bill_detail: $("#billDetail")
                                };

                                __el.modal_bill_detail.get(0).addEventListener('shown.bs.modal', function (e) {
                                    if (!e?.relatedTarget?.bill_id) {
                                        Swal.fire({
                                            title: 'Thông báo!',
                                            text: 'Không chỉ định thông tin hóa đơn!',
                                            icon: 'error',
                                            confirmButtonText: 'Đã hiểu'
                                        });
                                        return false;
                                    }

                                    $.transferData({
                                        method: "GET",
                                        url: __helper.url.urlPattern(__routeApi.bill.show, {
                                            id: parseInt(e?.relatedTarget?.bill_id)
                                        }),
                                        loadingEle: __el.modal_bill_detail.find('.bill-detail-loading'),
                                        textLoading: 'Đang tải chi tiết hóa đơn...',
                                        success: (res) => {
                                            let bill = res.data;
                                            //@TODO: show price item....
                                            __el.modal_bill_detail.find('.bill-date').text(bill.date_format);
                                            // Xử lý tiền thuê nhà
                                            if (bill.total_room_amount > 0) {
                                                __el.modal_bill_detail.find('.item-bill-room-amount').show();
                                                __el.modal_bill_detail.find('.detail-room-amount').text(`${bill.total_day} ngày x ${__format.currency(bill.room_amount_unit)}`);
                                                __el.modal_bill_detail.find('.total_room_amount').text(`${__format.currency(bill.total_room_amount)}`);
                                            } else {
                                                __el.modal_bill_detail.find('.item-bill-room-amount').hide();
                                            }

                                            // Xử lý tiền cọc
                                            if (bill.deposit_contract_amount) {
                                                __el.modal_bill_detail.find('.item-bill-deposit').show();
                                                if (bill.deposit_contract_amount > 0) {
                                                    __el.modal_bill_detail.find('.label-deposit').text("Thu tiền cọc");
                                                    __el.modal_bill_detail.find('.deposit_contract_amount').text(__format.currency(bill.deposit_contract_amount));

                                                } else {
                                                    __el.modal_bill_detail.find('.label-deposit').text("Trả tiền cọc");
                                                    __el.modal_bill_detail.find('.deposit_contract_amount').text(`${__format.currency(bill.deposit_contract_amount)}`);
                                                }
                                            } else {
                                                __el.modal_bill_detail.find('.item-bill-deposit').hide();
                                            }

                                            // Xử lý tiền cọc giữ chỗ
                                            if (parseInt(bill.pre_deposit_contract_amount) > 0) {
                                                __el.modal_bill_detail.find('.item-bill-pre-deposit').show();
                                                __el.modal_bill_detail.find('.label-pre-deposit').text("Tiền cọc đã thu trước");
                                                __el.modal_bill_detail.find('.pre_deposit_contract_amount').text(__format.currency(bill.pre_deposit_contract_amount));
                                            } else {
                                                __el.modal_bill_detail.find('.item-bill-pre-deposit').hide();
                                            }

                                            // Xử lý tiền dịch vụ
                                            if (bill.total_price_item > 0) {
                                                __el.modal_bill_detail.find('.item-bill-price-item').show();
                                                __el.modal_bill_detail.find('.total_price_item').text(`${__format.currency(bill.total_price_item)}`);
                                            } else {
                                                __el.modal_bill_detail.find('.item-bill-price-item').hide();
                                            }

                                            // Xử lý tiền giảm trừ/cộng thêm
                                            if (bill.addition != 0) {
                                                __el.modal_bill_detail.find('.item-bill-addition').show();
                                                bill.addition === 1 ? __el.modal_bill_detail.find('.addition_text').text('Cộng thêm') : __el.modal_bill_detail.find('.addition_text').text('Giảm trừ')
                                                __el.modal_bill_detail.find('.addition_value').text(`${__format.currency(bill.addition_value)}`);
                                            } else {
                                                __el.modal_bill_detail.find('.item-bill-addition').hide();
                                            }

                                            bill.total > 0 ? __el.modal_bill_detail.find('.bill-paid-total-text').text('Đã thu') : __el.modal_bill_detail.find('.bill-paid-total-text').text('Đã hoàn lại');
                                            __el.modal_bill_detail.find('.bill-phone').text(bill?.room?.customers[0]?.phone);
                                            __el.modal_bill_detail.find('.bill-value').text(__format.currency(bill.total));
                                            __el.modal_bill_detail.find('.bill-paid-total').text(__format.currency(bill.paid_total));

                                            __el.modal_bill_detail.find('.bill-reason').text(bill.reason);
                                            __el.modal_bill_detail.find('.bill-count_pay_bill').text(bill.count_pay_bill);

                                            if (bill.payBills.length > 0) {
                                                __el.modal_bill_detail.find('.bill-history').show();
                                                $.each(bill.payBills, function (index, item) {
                                                    __el.modal_bill_detail.find('.history-pay').append(`
                            <div class="item d-flex justify-content-between">
                                <span>Ngày thu</span><span class="bill-pay-date">${item.created_at_format}</span>
                            </div>
                            <div class="item d-flex justify-content-between">
                                <span>Số tiền thu</span><span class="bill-pay-date">${__format.currency(item.paid_total)}</span>
                            </div>
                            `)
                                                });
                                            } else {
                                                __el.modal_bill_detail.find('.bill-history').hide();
                                            }
                                        },
                                    });
                                });

                                __el.modal_bill_detail.get(0).addEventListener('hide.bs.modal', function (e) {
                                    __el.modal_bill_detail.find('.history-pay .item').remove();
                                    __el.modal_bill_detail.find('.bill-date').text('');
                                });
                            });
                        </script>

                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    form: $('#terminate-form'),
                                    modal: $("#terminateModal"),
                                    submit: $("#submit-terminate"),
                                    modal_bill_detail: $("#billDetail")
                                };

                                let cell = null;
                                let roomData = null;
                                let tasks = [];
                                let taskChecked = [];
                                let modal_bill_detail = bootstrap.Modal.getInstance(__el.modal_bill_detail.get(0)) || new bootstrap.Modal(__el.modal_bill_detail.get(0), null);

                                flatpickr(__el.form.find('input[name="date_tick_terminate"]'), {
                                    defaultDate: 'today',
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "d/m/Y",
                                    locale: 'vn'
                                });

                                const doTask = (action_name, key, data) => {
                                    if (!tasks?.length || tasks?.length === 0) {
                                        Swal.fire({
                                            title: 'Thông báo lỗi!',
                                            text: 'Không có công việc cần thực hiện',
                                            icon: 'warning',
                                            confirmButtonColor: '#3c9e47',
                                            confirmButtonText: 'Đã hiểu'
                                        });
                                        return;
                                    }

                                    if (typeof tasks[key] === 'undefined' || (tasks[key] && tasks[key].done === 1)) {
                                        Swal.fire({
                                            title: 'Thông báo lỗi!',
                                            text: 'Công việc đã được thực hiện!',
                                            icon: 'warning',
                                            confirmButtonColor: '#3c9e47',
                                            confirmButtonText: 'Đã hiểu'
                                        });
                                        return;
                                    }

                                    if (['bill_collect', 'bill_return'].includes(action_name)) {
                                        $.transferData({
                                            url: __helper.url.urlPattern(__routeApi.billPay.store, {
                                                bill_id: data.id
                                            }),
                                            method: 'POST',
                                            textLoading: action_name === 'bill_collect' ? 'Đang thu tiền...' :
                                                'Đang hoàn trả tiền...',
                                            data: {
                                                bill_id: data.id,
                                                block_id: data.block_id,
                                                room_id: data.room_id,
                                                paid_amount: Math.abs(data.remain_total),
                                                is_refund_amount: 1,
                                                payment_method: 'cash',
                                                type: action_name,
                                            },
                                            success: (res) => {
                                                taskChecked.push(res.data.action);
                                                tasks[key].done = 1;
                                                renderTask(tasks);
                                                //@TODO: Yêu cầu server trả lại room và cập nhật bảng
                                            },
                                            fail: (res) => {
                                                Swal.fire({
                                                    title: 'Thông báo lỗi!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            },
                                            error: (e) => {
                                                Swal.fire({
                                                    title: 'Thông báo lỗi!',
                                                    text: e,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            },
                                        });
                                    } else if (['terminate_deposit_contract', 'bill_terminate', 'check_asset'].includes(action_name)) {
                                        taskChecked.push(action_name);
                                        tasks[key].done = 1;
                                        renderTask(tasks);
                                    } else {
                                        Swal.fire({
                                            title: 'Thông báo lỗi!',
                                            text: 'Đã có sự nhầm lẫn! Vui lòng báo cho nhà cung cấp dịch vụ để được khắc phục',
                                            icon: 'error',
                                            confirmButtonColor: '#3c9e47',
                                            confirmButtonText: 'Đã hiểu'
                                        });
                                    }
                                };

                                const renderDataTaskItem = (action_name, data) => {
                                    if (!data) {
                                        return $('<span></span>');
                                    }
                                    let container = $(`<div class="data">`);
                                    if (action_name === 'bill_collect') {
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Số tiền cần thu:</div><b>${__format.currency(data.remain_total)}</b></div>`
                                        );
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Kỳ thu:</div><b>${data.month}/${data.year}</b></div>`
                                        );
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Lý do phiếu thu:</div><b>${data.reason}</b></div>`
                                        );
                                    }

                                    if (action_name === 'bill_return') {
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Số tiền hoàn</div><b>${__format.currency(data.remain_total)}</b></div>`
                                        );
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Lý do</div><b>Hoàn tiền lại cho khách thuê</b></div>`
                                        );
                                    }

                                    if (action_name === 'terminate_deposit_contract') {
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Người đặt cọc</div><b>${data.customer_name}</b></div>`
                                        );
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Số tiền đặt cọc</div><b>${__format.currency(data.deposit_contract_amount)}</b></div>`
                                        );
                                    }

                                    if (action_name === 'terminate_deposit_temp') {
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Người đặt cọc</div><b>${data.customer_name}</b></div>`
                                        );
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Số tiền đặt cọc giữ chỗ</div><b>${__format.currency(data.deposit_temp_amount)}</b></div>`
                                        );
                                    }

                                    if (action_name === 'debt_amount') {
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Số tiền khách thuê nợ</div><b>${__format.currency(data.debt_amount)}</b></div>`
                                        );
                                    }

                                    if (action_name === 'my_debt_amount') {
                                        container.append(
                                            `<div class="item d-flex justify-content-between"><div>Số tiền bạn nợ khách</div><b>${__format.currency(data.debt_amount)}</b></div>`
                                        );
                                    }
                                    return container;
                                };

                                const renterButtomTaks = function (item, key) {
                                    if (item.done !== 0)
                                        return $(`<span> </span>`);

                                    if (item.action === 'bill_terminate') {
                                        return $(`<div class="row g-2">`).append(
                                            $(`<div class="col-md-5">`).append($(`<button type="button" class="btn btn-white" style="margin-top: 10px; width: 100%">${feather.icons['alert-circle'].toSvg({ width: 20, height: 20 })} ${item.name}</button>`).click((e) => {
                                                doTask(item.action, key, item.data);
                                                renderTask(tasks ?? null)
                                            }))
                                        ).append(
                                            $(`<div class="col-md-7">`).append($(`<button type="button" class="btn btn-primary" style="margin-top: 10px; width: 100%">Tạo hóa đơn tháng cuối</button>`).click((e) => {
                                                e.preventDefault();

                                                var addBill = bootstrap.Modal.getInstance(document.getElementById('addBill')) ?? new bootstrap.Modal(document.getElementById('addBill'), null);

                                                let dataFrom = __el.form.getObjectOfForm();
                                                let date_tick_terminate = dataFrom?.date_tick_terminate ?? null;

                                                addBill.show({
                                                    cell: cell,
                                                    __type: 'terminate',
                                                    reason_id: 3,
                                                    date_to: date_tick_terminate ? (new Date(date_tick_terminate)).getTime() : null
                                                });

                                                bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                                return false;
                                            }))
                                        );
                                    } else if (item.action === 'bill_collect') {
                                        return $(`<div class="row g-2">`).append(
                                            $(`<div class="col-md-5">`).append($(`<button type="button" class="btn btn-white" style="margin-top: 10px; width: 100%">${feather.icons['file-text'].toSvg({ width: 20, height: 20 })} Xem</button>`).click((e) => {
                                                e.preventDefault();

                                                let date_tick_terminate = __el.form.find('input[name="date_tick_terminate"]').val();
                                                let cellOld = cell;
                                                let tasksOld = tasks;
                                                let taskCheckedOld = taskChecked;

                                                let showModal = function (e) {
                                                    __modalFormTerminate.show({
                                                        cell: cellOld,
                                                        tasks: tasksOld,
                                                        taskChecked: taskCheckedOld,
                                                        date_tick_terminate: date_tick_terminate
                                                    });
                                                    __el.modal_bill_detail.get(0).removeEventListener('hide.bs.modal', showModal);
                                                };

                                                let __modalFormTerminate = bootstrap.Modal.getInstance(__el.modal.get(0)) || new bootstrap.Modal(__el.modal.get(0), null);
                                                __el.modal_bill_detail.get(0).addEventListener('hide.bs.modal', showModal);

                                                __modalFormTerminate.hide();

                                                modal_bill_detail.show({
                                                    bill_id: item.data.id
                                                });
                                                return false;
                                            }))
                                        ).append(
                                            $(`<div class="col-md-7">`).append($(`<button type="button" class="btn btn-primary" style="margin-top: 10px; width: 100%">${feather.icons['dollar-sign'].toSvg({ width: 20, height: 20 })} Thu tiền nhanh</button>`).click((e) => {
                                                doTask(item.action, key, item.data);
                                                renderTask(tasks ?? null)
                                            }))
                                        );
                                    } else {
                                        return $(`<button type="button" class="btn btn-primary" style="margin-top: 10px; width: 100%">${item.name}</button>`).click((e) => {
                                            doTask(item.action, key, item.data);
                                            renderTask(tasks ?? null)
                                        });
                                    }
                                };

                                const renderTask = function () {
                                    if (!tasks || (tasks && tasks.length === 0)) {
                                        __el.form.find('#task-container').html('<div>Không có việc cần</div>');
                                        return false;
                                    }
                                    __el.form.find('#task-container').html('');
                                    __el.form.find('#task-container').append(
                                        $(`<h5 class="title text-center mt-3">
                            Công việc cần làm trước khi kết thúc hợp đồng
                            <p>(${taskChecked.length}/${tasks.length})</p>
                       </h5>`)
                                    );
                                    tasks.map((item, key) => {
                                        __el.form.find('#task-container').append(
                                            $(`<div class="task-item d-flex">`).append(
                                                $(`<div class="flex-shrink-1">`).append(
                                                    item.done !== 1 ?
                                                        $(`<div class="icon doing">${feather.icons['x'].toSvg()}</div>`) :
                                                        $(`<div class="icon done">${feather.icons['check'].toSvg()}</div>`)
                                                )
                                            ).append(
                                                $(`<div class="item flex-shrink-1" style="flex: 1">`).append(
                                                    $(`<h6 class="label">${item.label}</h6>${item.require ? '<p style="font-style: italic; color: red">Công việc bắt buộc thực hiện</p>' : ''}`)
                                                ).append(
                                                    $(`<p class="des">${item.description}</p>`)
                                                ).append(
                                                    renderDataTaskItem(item.action, item.data)
                                                ).append(
                                                    renterButtomTaks(item, key)
                                                )
                                            )
                                        );
                                    });
                                };

                                const loadTask = function () {
                                    $.transferData({
                                        url: __helper.url.urlPattern(__routeApi.terminate.tasks, {
                                            room_id: roomData.id
                                        }),
                                        textLoading: 'Đang tải việc cần làm...',
                                        success: (res) => {
                                            tasks = res?.data?.tasks ?? [];
                                            renderTask();
                                        },
                                        fail: res => {
                                            tasks = [];
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: res.message,
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            })
                                        }
                                    });
                                };

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0),
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {

                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;

                                        tasks = relatedTarget?.tasks ?? [];
                                        taskChecked = relatedTarget?.taskChecked ?? [];

                                        __el.form.find('.terminate-info').hide();
                                        __el.form.find('.terminate-setting').show();
                                        __el.form.find('input[name="date_tick_terminate"]').attr('readonly', false);
                                        __el.form.find('input[name="date_tick_terminate"]').get(0)._flatpickr.setDate(relatedTarget?.date_tick_terminate ?? new Date(), true, "d/m/Y");

                                        roomData &&
                                            __el.modal.find('.room-name').text(roomData.name);

                                        if (tasks?.length === 0) {
                                            loadTask();
                                        }
                                    },
                                    __closeModalForm: function () {
                                        tasks = [];
                                        taskChecked = [];
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();

                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return;
                                        }

                                        if (tasks?.length > 0 && taskChecked.length !== tasks.length) {
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Phải hoàn thành các công việc trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return;
                                        }

                                        data.type = 'terminate';
                                        data.room_id = roomData.id;
                                        data.taks = tasks;
                                        data.taskChecked = taskChecked;

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.terminate.store, {
                                                room_id: data.room_id
                                            }),
                                            data: data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thành công!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0))
                                                        .hide();
                                                    res.data && cell &&
                                                        cell.getRow().update(res.data);
                                                });
                                            },
                                            fail: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    }
                                });
                            });
                        </script>
                        <!-- Modal add new session -->
                        <div class="modal fade" data-bs-backdrop="static" id="extendModal" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="log-out"> </i>
                                        </div>
                                        <h5 class="modal-title">Gia han hợp đồng - <span class="room-name">Tên
                                                phòng</span> </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="extend-form" novalidate>
                                            <input type="hidden" name="_token"
                                                value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                                            <div class="row g-2">

                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="date_contract" id="date_contract"
                                                                placeholder="Gia hạn đền ngày" data-format="date"
                                                                required>
                                                            <label for="date_contract">Ngày gia hạn</label>
                                                        </div>
                                                        <label class="input-group-text" for="date_contract">
                                                            <i data-feather="calendar"> </i>
                                                        </label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập ngày gia hạn
                                                    </div>
                                                </div>

                                                <div class="col-6">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control date-flat-picker"
                                                                name="date_terminate" id="date_terminate"
                                                                placeholder="Gia hạn đền ngày" data-format="date"
                                                                required>
                                                            <label for="date_terminate">Gia hạn đến</label>
                                                        </div>
                                                        <label class="input-group-text" for="date_terminate">
                                                            <i data-feather="calendar"> </i>
                                                        </label>
                                                    </div>
                                                    <div class="invalid-feedback">
                                                        Vui lòng nhập ngày muốn gia hạn
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="input-group">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control currency"
                                                                name="room_amount" id="room_amount"
                                                                data-format="numeric" min="0"
                                                                placeholder="Nhập giá thuê" required>
                                                            <label for="room_amount">Giá thuê (đ)</label>
                                                            <div class="invalid-feedback">
                                                                Vui lòng nhập giá thuê
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-extend" class="btn btn-primary">
                                            <i data-feather="plus"> </i>
                                            Gia hạn
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    form: $('#extend-form'),
                                    modal: $("#extendModal"),
                                    submit: $("#submit-extend")
                                };

                                let cell = null;
                                let roomData = null;

                                flatpickr(__el.form.find('input[name="date_terminate"]'), {
                                    defaultDate: 'today',
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "d/m/Y",
                                    locale: 'vn',
                                    minDate: new Date().fp_incr(+1),
                                });


                                flatpickr(__el.form.find('input[name="date_contract"]'), {
                                    defaultDate: 'today',
                                    allowInput: true,
                                    enableTime: false,
                                    dateFormat: "d/m/Y",
                                    locale: 'vn',
                                    defaultDate: 'today',
                                });

                                let oldDate = __format.dateVn(new Date());

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0),
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {

                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;
                                        __el.form.find('input[name="room_amount"]').val(roomData.room_amount);
                                        __el.modal.find('.modal-title').text(
                                            `Gia hạn hợp đồng - ${roomData.name}`);
                                    },
                                    __closeModalForm: function () {
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();

                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return;
                                        }

                                        data.contract_id = roomData.contract_id;

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.contract.extend, {
                                                block_id: roomData.block_id
                                            }),
                                            data: data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thành công!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0))
                                                        .hide();
                                                    res.data && cell &&
                                                        cell.getRow().update(res.data);
                                                });
                                            },
                                            fail: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    }
                                });
                            });
                        </script>
                        <!-- Modal add new session -->
                        <div class="modal fade" data-bs-backdrop="static" id="terminateCancelModal" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="log-out"> </i>
                                        </div>
                                        <h5 class="modal-title">Hủy báo kết thúc hợp đồng - <span class="room-name">Tên
                                                phòng/giường</span> </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="info-cancel-terminate d-flex"
                                            style="background-color: #ff572247; border: 1px solid #ff5722;border-radius: 5px; padding: 10px;">
                                            <i data-feather="alert-triangle"> </i>
                                            <div style="margin-left: 20px">
                                                <h6>Khách thuê đã báo kết thúc hợp đồng vào <span
                                                        class="date-tick-terminate">00/00/0000</span> trước đó</h6>
                                                <p>Hiện khách thuê vẫn muốn tiếp tục thuê nên bạn muốn hủy báo kết thúc
                                                    hợp đồng ?</p>
                                            </div>
                                        </div>
                                        <div id="task-cancel-container"></div>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-terminate-cancel" class="btn btn-primary">
                                            <i data-feather="plus"> </i>
                                            Hủy báo kết thúc hợp đồng
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#terminateCancelModal"),
                                    submit: $("#submit-terminate-cancel")
                                };

                                let cell = null;
                                let roomData = null;
                                //Danh sách task cần hủy báo kết thúc hợp đồng
                                let tasksCancel = [];
                                // Các task cancel đã được thực hiện
                                let tasksCancelChecked = [];

                                const doTaskCancel = (action, key, data) => {
                                    if (tasksCancel?.length === 0) {
                                        Swal.fire({
                                            title: 'Thông báo lỗi!',
                                            text: 'Không có công việc cần thực hiện',
                                            icon: 'warning',
                                            confirmButtonText: 'Đã hiểu'
                                        });
                                        return;
                                    }

                                    if (typeof tasksCancel[key] === 'undefined' || (tasksCancel[key] && tasksCancel[key].done === 1)) {
                                        Swal.fire({
                                            title: 'Thông báo lỗi!',
                                            text: 'Công việc đã được thực hiện',
                                            icon: 'warning',
                                            confirmButtonText: 'Đã hiểu'
                                        });
                                        return;
                                    }

                                    if (action === 'terminate_deposit_temp') {
                                        tasksCancelChecked = __helper.array.addOrRemoveItemInArray(tasksCancelChecked, action);
                                        tasksCancel[key].done = 1;
                                    } else {
                                        Swal.fire({
                                            title: 'Thông báo lỗi!',
                                            text: 'Đã có sự nhầm lẫn! Vui lòng báo cho nhà cung cấp dịch vụ để được khắc phục',
                                            icon: 'warning',
                                            confirmButtonText: 'Đã hiểu'
                                        });
                                    }
                                };

                                const renderTaskItem = (action_name, data) => {
                                    let container = $(`<div class="data">`);
                                    if (action_name === 'bill_collect') {
                                        container.append(`<div class="item d-flex justify-content-between"><div>Số tiền cần thu:</div><b>${__format.currency(data.remain_total)}</b></div>`);
                                        container.append(`<div class="item d-flex justify-content-between"><div>Kỳ thu:</div><b>${data.month}/${data.year}</b></div>`);
                                        container.append(`<div class="item d-flex justify-content-between"><div>Lý do hóa đơn thu tiền:</div><b>${data.reason}</b></div>`);
                                    }

                                    if (action_name === 'bill_return') {
                                        container.append(`<div class="item d-flex justify-content-between"><div>Số tiền hoàn</div><b>${__format.currency(data.remain_total)}</b></div>`);
                                        container.append(`<div class="item d-flex justify-content-between"><div>Lý do</div><b>Hoàn tiền lại cho khách thuê</b></div>`);
                                    }

                                    if (action_name === 'terminate_deposit_contract') {
                                        container.append(`<div class="item d-flex justify-content-between"><div>Người đặt cọc</div><b>${data.customer_name}</b></div>`);
                                        container.append(`<div class="item d-flex justify-content-between"><div>Số tiền đặt cọc</div><b>${__format.currency(data.deposit_contract_amount)}</b></div>`);
                                    }

                                    if (action_name === 'terminate_deposit_temp') {
                                        container.append(`<div class="item d-flex justify-content-between"><div>Người đặt cọc</div><b>${data.customer_name}</b></div>`);
                                        container.append(`<div class="item d-flex justify-content-between"><div>Số tiền đặt cọc giữ chỗ</div><b>${__format.currency(data.deposit_temp_amount)}</b></div>`);
                                    }

                                    if (action_name === 'debt_amount') {
                                        container.append(`<div class="item d-flex justify-content-between"><div>Số tiền khách thuê nợ</div><b>${__format.currency(data.debt_amount)}</b></div>`);
                                    }

                                    if (action_name === 'my_debt_amount') {
                                        container.append(`<div class="item d-flex justify-content-between"><div>Số tiền bạn nợ khách</div><b>${__format.currency(data.debt_amount)}</b></div>`);
                                    }
                                    return container;
                                };

                                const renderTaskCancel = function () {
                                    __el.modal.find('#task-cancel-container').html('');
                                    tasksCancel && tasksCancel.map((item, key) => {
                                        __el.modal.find('#task-cancel-container').append(
                                            $(`<h5 class="title text-center mt-3">
                            Các công việc cần làm trước khi hủy báo kết thúc hợp đồng
                            <p>(${tasksCancelChecked.length}/${tasksCancel.length})</p>
                       </h5>`)
                                        ).append(
                                            $(`<div class="task-item d-flex">`).append(
                                                $(`<div class="flex-shrink-1">`).append(
                                                    item.done !== 1 ?
                                                        $(`<div class="icon doing">${feather.icons['x'].toSvg()}</div>`) :
                                                        $(`<div class="icon done">${feather.icons['check'].toSvg()}</div>`)
                                                )
                                            ).append(
                                                $(`<div class="item flex-shrink-1" style="flex: 1">`).append(
                                                    $(`<h6 class="label">${item.label}</h6>`)
                                                ).append(
                                                    $(`<p class="des">${item.description}</p>`)
                                                ).append(
                                                    renderTaskItem(item.action, item.data)
                                                ).append(
                                                    item.done !== 1 ?
                                                        $(`<button class="btn btn-primary" style="margin-top: 10px; width: 100%">${item.name}</button>`).click((e) => {
                                                            doTaskCancel(item.action, key, item.data);
                                                            renderTaskCancel(tasksCancel ?? null)
                                                        }) :
                                                        $(`<span> </span>`)
                                                )
                                            )
                                        );
                                    });
                                };

                                const loadTask = function () {
                                    $.transferData({
                                        url: __helper.url.urlPattern(__routeApi.terminate.tasks, {
                                            room_id: roomData.id
                                        }),
                                        textLoading: 'Đang tải việc cần làm...',
                                        success: (res) => {
                                            tasksCancel = res.data?.tasks_cancel ?? [];
                                            tasksCancelChecked = [];
                                            renderTaskCancel();
                                        },
                                        fail: res => {
                                            tasks = [];
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: res.message,
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            })
                                        }
                                    });
                                };

                                __el.submit.click(function (e) {
                                    if (tasksCancel?.length > 0 && tasksCancelChecked.length !== tasksCancel.length) {
                                        Swal.fire({
                                            title: 'Thông báo!',
                                            text: "Phải hoàn thành các công việc trước khi thực hiện",
                                            icon: 'error',
                                            confirmButtonText: 'Đã hiểu'
                                        });
                                        return;
                                    }

                                    $.transferData({
                                        method: "POST",
                                        url: __helper.url.urlPattern(__routeApi.terminate.cancel, {
                                            room_id: roomData.id ?? 0,
                                            id: roomData?.contract?.id ?? 0
                                        }),
                                        data: {
                                            type: 'terminate_cancel',
                                            room_id: roomData.id,
                                            tasksCancel: tasksCancel,
                                            tasksCancelChecked: tasksCancelChecked
                                        },
                                        success: function (res) {
                                            Swal.fire({
                                                title: 'Thành công!',
                                                text: res.message,
                                                icon: 'success',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            }).then((result) => {
                                                bootstrap.Modal.getInstance(__el.modal.get(0)).hide();
                                                res.data && cell &&
                                                    cell.getRow().update(res.data);
                                            });
                                        },
                                        fail: function (res) {
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: res.message,
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                        }
                                    });
                                });

                                __el.modal.get(0).addEventListener('shown.bs.modal', function ({ relatedTarget }) {
                                    tasksCancel = [];
                                    tasksCancelChecked = [];

                                    cell = relatedTarget?.cell ?? null;
                                    roomData = relatedTarget?.cell?.getData() ?? null;

                                    __el.modal.find('.room-name').text(`${roomData.name}`);
                                    if (roomData?.contract?.date_tick_terminate_format) {
                                        __el.modal.find('.date-tick-terminate').text(roomData?.contract?.date_tick_terminate_format);
                                    }

                                    if (roomData.status === 'is_deposit_temp_terminate')
                                        loadTask();
                                });

                                __el.modal.get(0).addEventListener('hide.bs.modal', function () {
                                    tasksCancel = [];
                                    tasksCancelChecked = [];
                                });
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" data-bs-backdrop="static" id="priceItemSelect" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="inbox"> </i>
                                        </div>
                                        <h5 class="modal-title">Chỉnh sửa dịch vụ sử dụng <span class="room-name">Tên
                                                phòng</span></h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="price-item-selec-form"
                                            novalidate>
                                            <div class="list-price-item-render price-items-checkout-layout">

                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-price-item-select" class="btn btn-primary">
                                            Áp dụng dịch vụ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    price_item_render: $('#price-item-selec-form .list-price-item-render'),
                                    form: $('#price-item-selec-form'),
                                    modal: $("#priceItemSelect"),
                                    submit: $('#submit-price-item-select')
                                };

                                let cell = null;
                                let roomData = null;
                                let room_price_item_start = null;
                                let room_price_item_save = null;

                                let block_price_item = JSON.parse(JSON.stringify([{ "id": 23351, "name": "Ti\u1ec1n \u0111i\u1ec7n", "type": "constant", "unit": "kwh", "price": 1700, "rooms": [{ "id": 102158, "name": "Ph\u00f2ng 1", "sort": null, "value": 102158, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102159, "name": "Ph\u00f2ng 2", "sort": null, "value": 102159, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102160, "name": "Ph\u00f2ng 3", "sort": null, "value": 102160, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102161, "name": "Ph\u00f2ng 4", "sort": null, "value": 102161, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102162, "name": "Ph\u00f2ng 5", "sort": null, "value": 102162, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102163, "name": "Ph\u00f2ng 6", "sort": null, "value": 102163, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }], "value": null, "frames": [], "status": "is_active", "history": null, "user_id": 8151, "block_id": 7081, "category": "ele", "type_text": "Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh", "unit_text": "KWh", "is_default": 1, "status_text": "\u0110ang s\u1eed d\u1ee5ng", "subtraction": 1 }, { "id": 23352, "name": "Ti\u1ec1n n\u01b0\u1edbc", "type": "constant", "unit": "khoi", "price": 18000, "rooms": [{ "id": 102158, "name": "Ph\u00f2ng 1", "sort": null, "value": 102158, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102159, "name": "Ph\u00f2ng 2", "sort": null, "value": 102159, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102160, "name": "Ph\u00f2ng 3", "sort": null, "value": 102160, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102161, "name": "Ph\u00f2ng 4", "sort": null, "value": 102161, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102162, "name": "Ph\u00f2ng 5", "sort": null, "value": 102162, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }, { "id": 102163, "name": "Ph\u00f2ng 6", "sort": null, "value": 102163, "status": "is_empty", "group_id": null, "priority": null, "circle_day": null, "room_amount": null, "status_text": "\u0110ang tr\u1ed1ng", "circle_month": null, "active_status": "pending_create_bill", "priority_text": "Kh\u00f4ng x\u00e1c \u0111\u1ecbnh", "customer_count": null, "active_status_text": "Ch\u1edd k\u1ef3 thu t\u1edbi" }], "value": null, "frames": [], "status": "is_active", "history": null, "user_id": 8151, "block_id": 7081, "category": "water", "type_text": "Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh", "unit_text": "Kh\u1ed1i", "is_default": 1, "status_text": "\u0110ang s\u1eed d\u1ee5ng", "subtraction": 1 }]));

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0)
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {
                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;
                                        room_price_item_start = JSON.parse(JSON.stringify(__preparePriceItems(roomData.price_items ?? null, roomData ?? null))) ?? [];

                                        __el.modal.find(".room-name").text(`"${roomData.name}"`);

                                        if (room_price_item_start) {

                                            __el.price_item_render.html('');

                                            Array.isArray(block_price_item) &&
                                                block_price_item.length > 0 &&
                                                block_price_item.map((item, key) => {
                                                    let container = $(`<div class="item">`);
                                                    let checkNameContainer = $(`<div class="item-check-name">`);

                                                    let hasItem = true;
                                                    let itemUse = __helper.array.findObjectInArray(item.id, 'id', room_price_item_start);
                                                    if (!itemUse) {
                                                        itemUse = item;
                                                        hasItem = false;
                                                    }

                                                    let itemValue = __getDefaultPriceItemsValue(itemUse, roomData);

                                                    checkNameContainer.append(`<input class="form-check-input" type="hidden" value="${itemUse.id}" name="price_items[${itemUse.id}][id]">`);
                                                    checkNameContainer.append(`<input class="form-check-input" type="checkbox" id="check_price_item_select_${itemUse.id}" value="1" ${hasItem ? 'checked' : ''} name="price_items[${itemUse.id}][is_selected]">`);

                                                    if (itemUse.type === 'frame' && !__helper.checkType.isEmpty(itemUse.frames)) {
                                                        checkNameContainer.append(`<label for="check_price_item_select_${itemUse.id}"><b>${itemUse.name}</b>` +
                                                            $.map(itemUse.frames, function (frame, key) {
                                                                return `<div> ${parseInt(key) !== 0 ? itemUse.frames[parseInt(key) - 1]['volume'] : 0} - ${frame.volume}, Giá: <b>${__format.currency(frame.price)}/${itemUse.unit_text}</b></div>`
                                                            }).join('')
                                                            + "</label>")
                                                    } else {
                                                        checkNameContainer.append(`<label for="check_price_item_select_${itemUse.id}"><b>${itemUse.name}</b> <p>Giá: <b>${__format.currency(itemUse.price)}</b> / ${itemUse.unit_text}</p> </label>`);
                                                    }

                                                    let valueContainer = $('<div class="item-value">');
                                                    if (itemUse.subtraction) {
                                                        valueContainer.append(`<div class="input-group mb-2  "><input class="form-control" min="0" id="price_item_select_${itemUse.id}_0"  type="number" placeholder="Nhập số cũ" oninput="$(price_item_select_${itemUse.id}_1).val(this.value)" value="${itemValue[0] ?? ''}" name="price_items[${itemUse.id}][value][]"><label class="input-group-text" for="bill_price_item_${itemUse.id}_0">Chỉ số<br>hiện tại</label></div>`);
                                                        valueContainer.append(`<div class="input-group d-none"><input class="form-control" min="0" id="price_item_select_${itemUse.id}_1" type="number" placeholder="Nhập số mới" oninput="$(price_item_select_${item.id}_0).val(this.value)" value="${itemValue[1] ?? ''}" name="price_items[${itemUse.id}][value][]"> <label class="input-group-text" for="bill_price_item_${itemUse.id}_1">Số mới</label></div>`);
                                                    } else {
                                                        valueContainer.append(`<div class="input-group"><input class="form-control" min="0" type="number" id="price_item_select_${itemUse.id}" placeholder="Nhập giá trị" value="${itemValue[0] ?? ''}" name="price_items[${itemUse.id}][value][]"> <label class="input-group-text" for="bill_price_item_${itemUse.id}">${itemUse.unit_text}</label></div>`);
                                                    }

                                                    __el.price_item_render.append(container.append(checkNameContainer).append(valueContainer));
                                                });
                                        } else {
                                            __el.price_item_render.html('<div class="text-center" style="color: red">Không có dịch vụ nào</div>');
                                        }
                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();
                                        if (!__el.form.get(0).checkValidity()) {
                                            __el.form.get(0).classList.add('was-validated');
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                                                icon: 'error',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                            return false;
                                        }

                                        let priceItems = {
                                            count: 0,
                                            currentPriceItem: [],
                                            total: 0
                                        };

                                        let current_price_item_form = __el.form?.getObjectOfForm()?.price_items;

                                        if (block_price_item && current_price_item_form) {
                                            Object.keys(current_price_item_form).map((price_item_id) => {
                                                let searchItem = __helper.array.findObjectInArray(price_item_id, 'id', block_price_item);
                                                if (searchItem && parseInt(current_price_item_form[searchItem.id]?.is_selected)) {

                                                    let valueDefault = __getDefaultPriceItemsValue(searchItem, roomData);
                                                    searchItem.value = valueDefault;

                                                    priceItems.count += 1;

                                                    if (searchItem.subtraction) {
                                                        let subtraction = parseInt(__helper.convertStringToNumber(current_price_item_form[searchItem.id]['value'][1] ?? '0')) - parseInt(__helper.convertStringToNumber(current_price_item_form[searchItem.id]['value'][0] ?? '0'));

                                                        priceItems.total += (subtraction > 0 ? subtraction : 0) * searchItem.price;

                                                        searchItem.value[1] = parseInt(__helper.convertStringToNumber(current_price_item_form[searchItem.id]['value'][1] ?? '0'));
                                                        searchItem.value[0] = parseInt(__helper.convertStringToNumber(current_price_item_form[searchItem.id]['value'][0] ?? '0'));
                                                    } else {
                                                        priceItems.total += parseInt(__helper.convertStringToNumber(current_price_item_form[searchItem.id]['value'][0] ?? '0')) * searchItem.price;

                                                        searchItem.value = [parseInt(__helper.convertStringToNumber(current_price_item_form[searchItem.id]['value'][0] ?? '0'))];
                                                    }

                                                    priceItems.currentPriceItem.push(searchItem);
                                                }
                                            });
                                            room_price_item_save = priceItems.currentPriceItem;
                                        } else {
                                            room_price_item_save = null;
                                        }

                                        let data_save = {
                                            ...roomData,
                                            price_items: room_price_item_save
                                        };

                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.room.update, {
                                                room_id: roomData.id
                                            }),
                                            data: data_save,
                                            textLoading: 'Đang lưu thông tin dịch vụ...',
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thành công!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đóng'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();

                                                    cell.getRow().update(data_save);
                                                });
                                            },
                                            fail: (res) => {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    }
                                });
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" data-bs-backdrop="static" id="_rooms_list_modal" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-xl">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="list"> </i>
                                        </div>
                                        <div>
                                            <h5 class="modal-title title">Danh sách phòng</h5>
                                            <i class="description des">Danh sách phòng để thêm khách thuê</i>
                                        </div>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="room-list row g-2">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#_rooms_list_modal"),
                                    title: $("#_rooms_list_modal .title"),
                                    description: $("#_rooms_list_modal .description")
                                };

                                let roomsList = [];
                                let roomsShow = [];
                                let roomSelected = null;
                                let status = null;
                                let callback = null;

                                const renderRooms = () => {
                                    __el.modal.find('.room-list').html('');

                                    if (!roomsShow || roomsShow?.length === 0) {
                                        roomsShow = [];
                                        __el.modal.find('.room-list').html('<div class="text-center"><img width="200px" src="/images/empty-box-4085812-3385481.webp }}"/><div style="margin-top: 15px"><b>Không có phòng nào để để thực hiện thao tác!</b></div></div>');
                                        return false;
                                    }

                                    roomsShow.map((room) => {
                                        let isActive = (roomSelected?.id === room.id);
                                        let icon = isActive ? `<div class="flex-grow-0 icon-room">
                                        ${feather.icons['check'].toSvg()}
                                </div>` :
                                            `<div class="flex-grow-0 icon-room">
                                        <img width="20px" src="/images/icons/room.png" alt=""/>
                                </div>`;
                                        let item = $(`
                    <div class="col-6 room-item${isActive ? ' active' : ''}">
                        <div class="d-flex room-item-inner align-items-center">
                             ${icon}
                            <div class="flex-grow-1">
                                <div>
                                    <b>${room.name}</b>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-1">
                                    <div>${feather.icons['dollar-sign'].toSvg({
                                            width: 18,
                                            height: 18
                                        })} ${__format.currency(room.room_amount)}</div>
                                    <div>${feather.icons['user'].toSvg({
                                            width: 18,
                                            height: 18
                                        })} ${room.customers.length}/${room.customer_count} người</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).click(function (e) {
                                            if ($(this).hasClass("active")) {
                                                $(this).removeClass("active");
                                                roomSelected = null;
                                            } else {
                                                $(this).addClass("active");
                                                roomSelected = room;
                                            }
                                            renderRooms();

                                            if (typeof callback === 'function')
                                                callback(roomSelected);
                                        });
                                        __el.modal.find('.room-list').append(item);
                                    });

                                };

                                const loadRoom = () => $.transferData({
                                    method: "POST",
                                    url: __helper.url.urlPattern(__routeApi.room.list, {
                                        block_id: parseInt(7081)
                                    }),
                                    data: {
                                        filter: {
                                            status: status
                                        }
                                    },
                                    textLoading: `Đang tải danh sách ${__current_block?.room_type_name ?? ''}...`,
                                    success: (res) => {
                                        roomsList = res?.data?.payload ?? [];
                                        roomsShow = [...roomsList];
                                        renderRooms();
                                    },
                                    fail: (res) => {
                                        roomsShow = [];
                                        renderRooms();
                                    }
                                });

                                new __modalForm(
                                    __el.modal.get(0),
                                    null,
                                    null
                                ).start(null, {
                                    __openModalForm: function (e) {
                                        status = e.relatedTarget?.status ?? null;
                                        callback = e.relatedTarget?.callback ?? null;

                                        __el.title.text("Danh sách");
                                        __el.description.text("Chọn một trong danh sách để hành động");
                                        if (e.relatedTarget?.title) {
                                            __el.title.text(e.relatedTarget?.title);
                                        }
                                        if (e.relatedTarget?.description) {
                                            __el.description.text(e.relatedTarget?.description);
                                        }
                                        roomSelected = null;
                                        loadRoom(status);
                                    }
                                });
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" data-bs-backdrop="static" id="noteModal" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="edit-3"> </i>
                                        </div>
                                        <h5 class="modal-title">Ghi chú</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="note-form" novalidate>
                                            <div class="col-12 mt-2">
                                                <div class="form-floating">
                                                    <textarea type="text" rows="10" style="min-height: 100px"
                                                        class="form-control" name="note" id="input_note"
                                                        placeholder="Ghi chú"></textarea>
                                                    <label for="input_note">Nội dung ghi chú</label>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-note-form" class="btn btn-primary">
                                            Lưu
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#noteModal"),
                                    form: $('#note-form'),
                                    submit: $('#submit-note-form')
                                };

                                let roomData = null;

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0)
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {
                                        cell = relatedTarget?.cell ?? null;
                                        roomData = relatedTarget?.cell?.getData() ?? null;
                                        console.log(roomData.contract.note);
                                        __el.modal.find('#input_note').text(roomData.contract.note ?? '');

                                    },
                                    __submitModalForm: function (e) {
                                        let data = __el.form.getObjectOfForm();
                                        $.transferData({
                                            method: "POST",
                                            url: __helper.url.urlPattern(__routeApi.contract.updateNote, {
                                                contract_id: roomData?.contract.id
                                            }),
                                            textLoading: 'Đang lưu...',
                                            data,
                                            success: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đóng'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();
                                                });
                                            },
                                            fail: function (res) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            },
                                            error: function (e) {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: "Đã có lỗi xảy ra! " + e,
                                                    icon: 'error',
                                                    confirmButtonColor: '#3c9e47',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    },
                                });
                            });
                        </script>
                        <style>
                            .bill-item {
                                background-color: #fff4f4;
                                padding: 10px;
                            }
                        </style>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" id="billDebt" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="users"> </i>
                                        </div>
                                        <h5 class="modal-title">Hóa đơn cần thu <span class="room-name">Tên phòng</span>
                                        </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"> </button>
                                    </div>
                                    <div class="modal-body" id="bill-debt-list">
                                        <div class="text-center">
                                            <img src="/images/icons/bill.png" width="70" height="70" />
                                            <div>Không có hóa đơn nào cần thu!</div>
                                        </div>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#billDebt")
                                };

                                __el.modal.get(0).addEventListener('shown.bs.modal', function (e) {
                                    $.transferData({
                                        method: "GET",
                                        url: __helper.url.urlPattern(__routeApi.bill.listDepositByRoom, {
                                            room_id: parseInt(e?.relatedTarget?.room_id)
                                        }),

                                        success: (res) => {
                                            if (res.data?.payload) {
                                                let bills = res.data.payload;
                                                __el.modal.find('#bill-debt-list').html('')
                                                $.each(bills, function (key, bill) {
                                                    __el.modal.find('#bill-debt-list').append(`
                            <div class="bill-item mt-2" id="room-bill-${bill.id}">
                                <div class="d-flex" style="padding-bottom: 7px;">
                                    <div class="col-md-3" style="padding-right: 10px;">
                                        <div style="background-color: #f2f2f2;padding: 28px;border-radius: 100%;position:relative">
                                            <img src="/images/icons/bill.png" width="100%"/>
                                            <span style="font-weight: bold;color: ${bill.status_color};font-size: 10px;position: absolute;bottom: 8px;left: 0px;right: 0px;text-align: center;">${bill.status_text}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-9">
                                        <div class="row">
                                            <div class="col-md-12 row">
                                                <div class="col-6">
                                                    <b style="font-size: 17px;">${bill.customer_name}</b> - ${bill.customer_phone}
                                                </div>
                                                <div class="col-6 text-end">
                                                    <svg viewBox="0 0 24 24" width="17" height="17" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                                                    ${bill.date_format}
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                Lý do:<b>${bill.reason}</b>
                                            </div>
                                            <div style="margin-top: 10px;">
                                                <div class="d-flex" style="justify-content: space-between; background-color: #fff2f2;border-radius: 5px;padding: 5px 10px;">
                                                    <div>Tổng tiền<br><b style="color: red;font-size: 16px">${__format.currency(bill.total)}</b></div>
                                                    <div>Đã thu<br><b style="color: green;font-size: 16px">${__format.currency(bill.paid_total)}</b></div>
                                                    <div>Còn lại<br><b style="color: #000;font-size: 16px">${__format.currency(bill.remain_total)}</b></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="action-item" style="border-top: 0.5px solid #ccc;padding:0px;">
                                    <div class="col-12 text-end mt-2">
                                        <button type="button" data-bill-id=${bill.id} id="room-show-input-pay-${bill.id}" class="btn btn-primary room-show-input-pay">
                                            Thu nhanh
                                            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                                        </button>
                                    </div>
                                    <input type="hidden" class="form-control" name="type" id="room-type" value="bill_collect" required="">
                                    <div class="col-12 mt-2 d-none" id="room-input-paid-${bill.id}">
                                        <div class="form-floating">
                                            <input data-format="numeric" type="text" style="font-weight: bold;font-size: 18px;color: #3c9e46;" class="form-control" name="paid_amount" id="room-input_paid_amount-${bill.id}" placeholder="Nhập số tiền khách thanh toán (đ)" required value="${__format.currencyInput(bill?.remain_total ?? 0)}">
                                            <label for="input_paid_amount">Nhập số tiền khách thanh toán (đ)</label>
                                        </div>
                                    </div>
                                    <div class="col-12 mt-2 d-none" id="payment-method-${bill.id}">
                                        <div class="form-floating">
                                            <select name="payment_method" class="form-select form-control" id="input-payment-method-${bill.id}">
                                                <option value="cash">Trả tiền mặt</option>
                                                <option value="transfer_by_bank">Chuyển khoản</option>
                                            </select>
                                            <label for="input_payment_method">Phương thức thanh toán</label>
                                        </div>
                                    </div>
                                    <div class="col-12 mt-2 d-none" id="date-receipt-expense-${bill.id}">
                                        <div class="input-group">
                                            <div class="form-floating">
                                                <input type="text" class="form-control date-flat-picker" name="date_receipt_expense"
                                                    id="input-date-receipt-expense-${bill.id}" data-format="date"
                                                    placeholder="Ngày ghi nhận thu chi" pattern="\d{1,2}\/\d{1,2}\/\d{4}">
                                                <label for="date_receipt_expense">Ngày ghi nhận thu chi</label>
                                            </div>
                                        </div>
                                        <div class="invalid-feedback">
                                            Vui lòng nhập ngày ghi nhận thu chi và phải đúng định dạng
                                        </div>
                                    </div>
                                    <div class="col-12 text-end d-none mt-2" id="room-submit-paid-${bill.id}">
                                        <button type="button" data-bill-id=${bill.id} id="close-bill-pay-${bill.id}" class="btn btn-default submit-close" style="background-color: #000;color: #fff; margin-right: 10px;">
                                            Đóng thu
                                        </button>
                                        <button type="button" data-bill-id=${bill.id} id="room-submit-bill-pay-${bill.id}" class="btn btn-primary room-submit-paid">
                                            Thực hiện thu
                                        </button>
                                    </div>
                                </div>
                            </div>
                            `);

                                                    flatpickr(__el.modal.find('input[name="date_receipt_expense"]'), {
                                                        defaultDate: new Date().toLocaleDateString('vi', {
                                                            year: "numeric",
                                                            month: "2-digit",
                                                            day: "numeric"
                                                        }),
                                                        allowInput: true,
                                                        enableTime: false,
                                                        dateFormat: "d/m/Y",
                                                        locale: 'vn'
                                                    });
                                                });

                                                __el.modal.find('.room-name').text(bills[0]?.room?.name);

                                                $('input[data-format="numeric"][type="text"]').on('input', function () {
                                                    let value = $(this).val();

                                                    let number = __helper.convertStringToNumber(value);
                                                    let newVal = __format.currencyInput(number);

                                                    $(this).val(value === '' ? '' : isNaN(number) ? '' : newVal);
                                                });
                                            }
                                        },
                                    });
                                });

                                __el.modal.get(0).addEventListener('hide.bs.modal', function (e) {
                                    __el.modal.find('#bill-debt-list').html('')
                                });

                                __el.modal.find('#bill-debt-list').on('click', '.room-show-input-pay', function () {
                                    let id = parseInt($(this).data('bill-id'));
                                    __el.modal.find('#room-show-input-pay-' + id).hide();
                                    __el.modal.find('#room-input-paid-' + id).removeClass('d-none');
                                    __el.modal.find('#payment-method-' + id).removeClass('d-none');
                                    __el.modal.find('#date-receipt-expense-' + id).removeClass('d-none');
                                    __el.modal.find('#room-submit-paid-' + id).removeClass('d-none');

                                })
                                __el.modal.find('#bill-debt-list').on('click', '.submit-close', function () {
                                    let id = parseInt($(this).data('bill-id'));
                                    __el.modal.find('#room-show-input-pay-' + id).show();
                                    __el.modal.find('#room-input-paid-' + id).addClass('d-none');
                                    __el.modal.find('#payment-method-' + id).addClass('d-none');
                                    __el.modal.find('#date-receipt-expense-' + id).addClass('d-none');
                                    __el.modal.find('#room-submit-paid-' + id).addClass('d-none');
                                })

                                __el.modal.find('#bill-debt-list').on('click', '.room-submit-paid', function () {
                                    let id = parseInt($(this).data('bill-id'));

                                    let data = {
                                        type: __el.modal.find('#room-type').val(),
                                        paid_amount: parseInt(__helper.convertStringToNumber(__el.modal.find('#room-input_paid_amount-' + id).val())),
                                        payment_method: __el.modal.find(`#input-payment-method-${id} option:selected`).val(),
                                        date_receipt_expense: value = __convertData(__el.modal.find('#input-date-receipt-expense-' + id).val(), 'date'),
                                    };

                                    $.transferData({
                                        method: 'POST',
                                        url: __helper.url.urlPattern(__routeApi.billPay.store, {
                                            bill_id: id
                                        }),
                                        data: data,
                                        textLoading: 'Đang thu tiền...',
                                        success: function (res) {
                                            __el.modal.find('#room-bill-' + id).remove();

                                            Swal.fire({
                                                title: 'Thành công!',
                                                text: res.message,
                                                icon: 'success',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đóng'
                                            })
                                        },
                                        fail: (res) => {
                                            Swal.fire({
                                                title: 'Thông báo!',
                                                text: res.message,
                                                icon: 'error',
                                                confirmButtonColor: '#3c9e47',
                                                confirmButtonText: 'Đã hiểu'
                                            });
                                        }
                                    });
                                })
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <style>
                            .deposit-temp-info .item {
                                padding: 10px 0;
                                border-bottom: 1px solid #eee;
                            }
                        </style>
                        <div class="modal fade" data-bs-backdrop="static" id="viewDepositTemp" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="anchor"> </i>
                                        </div>
                                        <h5 class="modal-title">Thông tin cọc giữ chỗ</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">

                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    modal: $("#viewDepositTemp"),
                                };

                                let cell = null;
                                let roomData = null;
                                let deposit = null;

                                __el.modal.get(0).addEventListener('shown.bs.modal', function ({ relatedTarget }) {
                                    cell = relatedTarget?.cell ?? null;
                                    roomData = relatedTarget?.cell?.getData() ?? null;
                                    deposit = roomData?.deposit ?? null;

                                    __el.modal.find('.modal-body').html('');

                                    __el.modal.find('.modal-body').append(`
            <div class="deposit-temp-info">
                <div">
                    <div class="item d-flex justify-content-between">
                        <span>Tên người đặt cọc</span>
                        <span><b>${deposit.customer_name}</b></span>
                    </div>
                    <div class="item d-flex justify-content-between">
                        <span>Số điện thoại</span>
                        <span><b>${deposit.customer_phone}</b></span>
                    </div>
                    <div class="item d-flex justify-content-between">
                        <span>Số tiền cọc giữ chỗ</span>
                        <span><b>${__format.currency(deposit.deposit_temp_amount)}</b></span>
                    </div>
                
                    <div class="item d-flex justify-content-between">
                        <span>Ngày thu tiền cọc</span>
                        <span><b>${deposit.date_deposit_format}</b></span>
                    </div>
                    <div class="item d-flex justify-content-between">
                        <span>Ngày dự định vào ở</span>
                        <span><b>${deposit.date_will_join_format}</b></span>
                    </div>
                    <div class="item d-flex justify-content-between">
                        <span>Ghi chú</span>
                        <span><b>${deposit.note}</b></span>
                    </div>
                </div>
            </div>
            `)
                                });;
                            });
                        </script>
                        <!-- Modal deposit temp -->
                        <div class="modal fade" data-bs-backdrop="static" id="assetSelect" tabindex="-1"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div
                                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                            <i data-feather="inbox"> </i>
                                        </div>
                                        <h5 class="modal-title">Thông tin tài sản <span class="room-name">Tên
                                                phòng</span></h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form method="POST" class="needs-validation" id="asset-select-form" novalidate>
                                            <div class="list-asset-render asset-checkout-layout">

                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer modal-footer--sticky">
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng</button>
                                        <button type="button" id="submit-asset-select" class="btn btn-primary">
                                            Áp dụng tài sản
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <script type="text/javascript">
                            $(document).ready(function () {
                                let __el = {
                                    asset_render: $('#asset-select-form .list-asset-render'),
                                    form: $('#asset-select-form'),
                                    modal: $("#assetSelect"),
                                    submit: $('#submit-asset-select')
                                };

                                let cell = null;
                                let contractData = null;
                                let api = null;

                                let block_asset = JSON.parse(JSON.stringify(null));

                                new __modalForm(
                                    __el.modal.get(0),
                                    __el.form.get(0),
                                    __el.submit.get(0)
                                ).start(null, {
                                    __openModalForm: function ({ relatedTarget }) {
                                        cell = relatedTarget?.cell ?? null;
                                        page_use = relatedTarget?.page_use ?? null;
                                        data = relatedTarget?.cell?.getData() ?? null;
                                        if (page_use === 'rooms') {
                                            room_asset = data.asset
                                            __el.modal.find(".room-name").text(`"${data.name}"`);

                                            api = __helper.url.urlPattern(__routeApi.room.update, {
                                                room_id: parseInt(data.id)
                                            })
                                        } else {
                                            room_asset = data.room.asset
                                            __el.modal.find(".room-name").text(`"${data.room.name}"`);

                                            api = __helper.url.urlPattern(__routeApi.contract.update, {
                                                contract_id: parseInt(data.id)
                                            })
                                        }

                                        if (block_asset) {
                                            __el.asset_render.html('');

                                            Array.isArray(block_asset) &&
                                                block_asset.length > 0 &&
                                                block_asset.map((item, key) => {
                                                    let container = $(`<div class="item">`);
                                                    let checkNameContainer = $(`<div class="item-check-name">`);

                                                    let itemUse = __helper.array.findObjectInArray(item.id, 'id', room_asset);

                                                    let hasItem = false;
                                                    let itemValue = 1;

                                                    if (itemUse) {
                                                        hasItem = true;
                                                        itemValue = itemUse.data.quantity
                                                    } else {
                                                        itemUse = item;
                                                    }

                                                    checkNameContainer.append(`<input class="form-check-input" type="hidden" value="${itemUse.id}" name="assets[${itemUse.id}][id]">`);
                                                    checkNameContainer.append(`<input class="form-check-input" type="checkbox" id="check_asset_select_${itemUse.id}" value="1"  ${hasItem ? 'checked' : ''} name="assets[${itemUse.id}][is_selected]">`);
                                                    checkNameContainer.append(`<label for="check_asset_select_${itemUse.id}"><b>${itemUse.name}</b><p>Giá: <b>${__format.currency(itemUse.amount)}</b> / ${itemUse.unit}</p></label>`);

                                                    let valueContainer = $('<div class="item-value">');
                                                    valueContainer.append(`<div class="input-group"><input class="form-control" min="0" type="number" id="asset_select_${itemUse.id}" placeholder="Nhập số lương" value="${itemValue}" name="assets[${itemUse.id}[quantity]"><label class="input-group-text" for="bill_price_item_${item.id}">Số lượng</label></div>`);

                                                    __el.asset_render.append(container.append(checkNameContainer).append(valueContainer));
                                                });
                                        } else {
                                            __el.asset_render.html('<div class="text-center" style="color: red">Không có tài sản nào!. Vui lòng tạo tài sản ở menu Quản lý tài sản</div>');
                                        }
                                    },
                                    __submitModalForm: function (e) {
                                        let assets = [];
                                        let current_asset_form = __el.form?.getObjectOfForm()?.assets;

                                        if (block_asset && current_asset_form) {
                                            Object.keys(current_asset_form).map((asset_id) => {
                                                let searchItem = __helper.array.findObjectInArray(asset_id, 'id', block_asset);

                                                if (parseInt(current_asset_form[asset_id]?.is_selected)) {
                                                    searchItem.quantity_room = 0;
                                                    searchItem.quantity_room = parseInt(current_asset_form[asset_id]['quantity']);
                                                    assets.push(searchItem);
                                                }
                                            });
                                            data.assets = assets;
                                        } else {
                                            data.assets = null;
                                        }

                                        $.transferData({
                                            method: "POST",
                                            url: api,
                                            data: data,
                                            success: (res) => {
                                                Swal.fire({
                                                    title: 'Thao tác thành công!',
                                                    text: res.message,
                                                    icon: 'success',
                                                    confirmButtonText: 'Đã hiểu'
                                                }).then((result) => {
                                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();
                                                    if (res.data && cell) {
                                                        cell.getRow().update(res.data);
                                                    }
                                                });
                                            },
                                            fail: (res) => {
                                                Swal.fire({
                                                    title: 'Thông báo!',
                                                    text: res.message,
                                                    icon: 'warning',
                                                    confirmButtonText: 'Đã hiểu'
                                                });
                                            }
                                        });
                                    }
                                });
                            });
                        </script>
                    </div>
                </div>
                <script type="text/javascript" src="https://quanlytro.me/tabulator-5.5/dist/js/tabulator.js"></script>
                <script type="text/javascript"
                    src="https://quanlytro.me/tabulator-5.5/dist/js/jquery_wrapper.js"></script>
                <script type="text/javascript"
                    src="https://quanlytro.me/householder-admin/plugins/flatpickr/js/flatpickr-4.6.9.min.js"></script>
                <script type="text/javascript"
                    src="https://quanlytro.me/householder-admin/plugins/flatpickr/js/month-select-4.6.9.min.js"></script>
                <script type="text/javascript"
                    src="https://quanlytro.me/householder-admin/plugins/flatpickr/js/vn.js"></script>
                <script type="text/javascript"
                    src="https://quanlytro.me/householder-admin/plugins/xlsx.full.min.js"></script>

                <script type="text/javascript"
                    src="https://quanlytro.me/householder-admin/js/tabulator-setting.js?version=1.3.8"></script>

                <link href="householder-admin/plugins/flatpickr/css/flatpickr.min.css" rel="stylesheet">
                <link href="householder-admin/plugins/flatpickr/css/month-select.min.css" rel="stylesheet">
                <link href="https://quanlytro.me/tabulator-5.5/dist/css/tabulator_semanticui.min.css" rel="stylesheet">


                <script type="text/javascript">
                    Tabulator.extendModule("edit", "editors", common_editors);
                    Tabulator.extendModule("accessor", "accessors", common_accessor);
                    Tabulator.extendModule("format", "formatters", Object.assign(common_formatters, {
                        deposit_contract: function (cell, formatterParams) {
                            return cell.getValue()
                        },
                        room_name: function (cell, formatterParams) {
                            let data = cell.getData();
                            if (data?.contract)
                                return `<div>
                    <b>${data.name}</b>
                    <div style="font-size: 13px">${data.contract.customer_name ? data.contract.customer_name : 'Thiếu thông tin khách thuê'}</div>
                    <div>${(data.contract && !data.contract.can_connect) ? '<span style="font-size: 11px; color:#3c9d46;">Đã sử dụng app</span>' : '<span style="font-size: 11px; color:#666;">Chưa sử dụng app</span>'}</div>
                </div>`;

                            return `<div><b>${data.name}</b></div>`;
                        }
                    }));
                </script>

                <script type="text/javascript">
                    $(document).ready(function () {
                        if (window.location.hash !== '') {
                            var triggerEl = document.querySelector(`#myTab a[href="${window.location.hash}"]`)
                            var tab = new bootstrap.Tab(triggerEl);
                            tab.show();
                        }

                        $('.report').click(() => {
                            Swal.fire({
                                title: 'Thông báo!',
                                text: 'Tính năng thông kê đang trong quá trình phát triển. Vui lòng thử lại sau trong phiên bản sắp tới!',
                                icon: 'success',
                                confirmButtonText: 'Đã hiểu',
                                confirmButtonColor: '#3c9e47',
                            })
                        });

                    });
                </script>
                <style>
                    .bill-item {
                        background-color: #fff;
                        border: 0.5px solid #ccc;
                        border-radius: 10px;
                        padding: 10px;
                    }
                </style>
                <!-- Modal deposit temp -->
                <div class="modal fade" id="reportBillDebt" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <div
                                    style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                    <i data-feather="users"> </i>
                                </div>
                                <h5 class="modal-title">Khách đang nợ</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                </button>
                            </div>
                            <div class="modal-body">
                                <div style="border-radius: 10px;">
                                    <div style="border-radius: 10px; padding: 30px; text-align:center">
                                        <img width="200px"
                                            src="https://quanlytro.me/images/empty-box-4085812-3385481.webp" />
                                        <h4>Không có hóa đơn nợ nào!</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer modal-footer--sticky">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>
                <script type="text/javascript">
                    $(document).ready(function () {

                        let __el = {
                            modal: $("#reportBillDebt")
                        };

                        flatpickr(__el.modal.find('input[name="date_receipt_expense"]'), {
                            defaultDate: new Date().toLocaleDateString('vi', {
                                year: "numeric",
                                month: "2-digit",
                                day: "numeric"
                            }),
                            allowInput: true,
                            enableTime: false,
                            dateFormat: "d/m/Y",
                            locale: 'vn'
                        });

                        __el.modal.find('.show-input-pay').click(function () {
                            let id = parseInt($(this).data('bill-id'));
                            __el.modal.find('#show-input-pay-' + id).hide();
                            __el.modal.find('#input-paid-' + id).removeClass('d-none');
                            __el.modal.find('#submit-paid-' + id).removeClass('d-none');
                            __el.modal.find('#payment-method-' + id).removeClass('d-none');
                            __el.modal.find('#date-receipt-expense-' + id).removeClass('d-none');
                        });

                        __el.modal.find('.submit-close').click(function () {
                            let id = parseInt($(this).data('bill-id'));
                            __el.modal.find('#show-input-pay-' + id).show();
                            __el.modal.find('#input-paid-' + id).addClass('d-none');
                            __el.modal.find('#submit-paid-' + id).addClass('d-none');
                            __el.modal.find('#payment-method-' + id).addClass('d-none');
                            __el.modal.find('#date-receipt-expense-' + id).addClass('d-none');
                        });

                        __el.modal.find('.submit-paid').click(function () {
                            let id = parseInt($(this).data('bill-id'));
                            let data = {
                                type: __el.modal.find('#type').val(),
                                paid_amount: parseInt(__helper.convertStringToNumber(__el.modal.find('#input_paid_amount-' + id).val())),
                                payment_method: __el.modal.find(`#input-payment-method-${id} option:selected`).val(),
                                date_receipt_expense: value = __convertData(__el.modal.find('#input-date-receipt-expense-' + id).val(), 'date'),
                            };

                            $.transferData({
                                method: 'POST',
                                url: __helper.url.urlPattern(__routeApi.billPay.store, {
                                    bill_id: id
                                }),
                                data: data,
                                textLoading: 'Đang thu tiền...',
                                success: function (res) {
                                    __el.modal.find('#bill-' + id).remove();

                                    Swal.fire({
                                        title: 'Thành công!',
                                        text: res.message,
                                        icon: 'success',
                                        confirmButtonColor: '#3c9e47',
                                        confirmButtonText: 'Đóng'
                                    })
                                },
                                fail: (res) => {
                                    Swal.fire({
                                        title: 'Thông báo!',
                                        text: res.message,
                                        icon: 'error',
                                        confirmButtonColor: '#3c9e47',
                                        confirmButtonText: 'Đã hiểu'
                                    });
                                }
                            });
                        })
                    })
                </script>
                <style>
                    .contract-item {
                        background-color: #fff;
                        border: 0.5px solid #ccc;
                        border-radius: 10px;
                        padding: 10px;
                    }
                </style>
                <!-- Modal deposit temp -->
                <div class="modal fade" id="reportContractDeposit" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <div
                                    style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                    <i data-feather="users"> </i>
                                </div>
                                <h5 class="modal-title">Danh sách tiền cọc các phòng</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                </button>
                            </div>
                            <div class="modal-body">
                                <div style="border-radius: 10px;">
                                    <div style="border-radius: 10px; padding: 30px; text-align:center">
                                        <img width="200px"
                                            src="https://quanlytro.me/images/empty-box-4085812-3385481.webp" />
                                        <h4>Chưa có tiền cọc</h4>
                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer modal-footer--sticky">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>
                <style>
                    .deposit-item {
                        background-color: #fff;
                        border: 0.5px solid #ccc;
                        border-radius: 10px;
                        padding: 5px 5px;
                    }
                </style>
                <!-- Modal deposit temp -->
                <div class="modal fade" id="reportDepositTemp" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <div
                                    style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                                    <i data-feather="users"> </i>
                                </div>
                                <h5 class="modal-title">Danh sách tiền cọc giữ chỗ</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                </button>
                            </div>
                            <div class="modal-body">
                                <div style="border-radius: 10px;">
                                    <div style="border-radius: 10px; padding: 30px; text-align:center">
                                        <img width="200px"
                                            src="https://quanlytro.me/images/empty-box-4085812-3385481.webp" />
                                        <h4>Chưa có tiền cọc giữ chỗ</h4>
                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer modal-footer--sticky">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal manage block -->
        <div class="modal fade" id="manageBlock" tabindex="-1" aria-labelledby="manageBlockLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header modal-header--sticky">
                        <i style="margin-right: 15px" data-feather="home"> </i>
                        <h5 class="modal-title" id="manageBlockLabel">
                            Danh sách nhà trọ của bạn
                            <p style="font-size: 14px; font-weight: normal; font-style: italic; margin: 0">Tới 1 nhà trọ
                                và quản lý</p>
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"> </button>
                    </div>
                    <div class="modal-body">
                        <div class="item-feature active d-flex align-items-center justify-content-between mb-2">
                            <div class="info" style="flex: 1">
                                <h6>Nhà trọ ASUS</h6>
                                <p>63, An Tịnh, Trảng Bàng, Tây Ninh</p>
                            </div>

                            <div class="btn-round disabled btn-secondary" data-bs-toggle="tooltip"
                                data-bs-placement="top" title="Không thể xóa nhà trọ đang thao tác">
                                <i data-feather="trash-2"> </i>
                            </div>

                            <div class="btn-round btn-edit" data-bs-toggle="modal" data-bs-target="#addBlock"
                                data-block='{"id":7081,"name":"ASUS","name_full":"Nh\u00e0 tr\u1ecd ASUS","user_id":8151,"category":0,"category_name":"Nh\u00e0 tr\u1ecd","category_name_short":"Nh\u00e0 tr\u1ecd","room_type":"room","room_type_name":"ph\u00f2ng","type":"floors","room_total":6,"count_floor":2,"area":15,"room_amount":36,"ele_amount":0,"water_amount":0,"price_items_cache":[{"id":23351,"name":"Ti\u1ec1n \u0111i\u1ec7n","type":"constant","unit":"kwh","price":1700,"rooms":[{"id":102158,"name":"Ph\u00f2ng 1","sort":null,"value":102158,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102159,"name":"Ph\u00f2ng 2","sort":null,"value":102159,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102160,"name":"Ph\u00f2ng 3","sort":null,"value":102160,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102161,"name":"Ph\u00f2ng 4","sort":null,"value":102161,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102162,"name":"Ph\u00f2ng 5","sort":null,"value":102162,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102163,"name":"Ph\u00f2ng 6","sort":null,"value":102163,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"}],"value":null,"frames":[],"status":"is_active","history":null,"user_id":8151,"block_id":7081,"category":"ele","type_text":"Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh","unit_text":"KWh","is_default":1,"status_text":"\u0110ang s\u1eed d\u1ee5ng","subtraction":1},{"id":23352,"name":"Ti\u1ec1n n\u01b0\u1edbc","type":"constant","unit":"khoi","price":18000,"rooms":[{"id":102158,"name":"Ph\u00f2ng 1","sort":null,"value":102158,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102159,"name":"Ph\u00f2ng 2","sort":null,"value":102159,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102160,"name":"Ph\u00f2ng 3","sort":null,"value":102160,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102161,"name":"Ph\u00f2ng 4","sort":null,"value":102161,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102162,"name":"Ph\u00f2ng 5","sort":null,"value":102162,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102163,"name":"Ph\u00f2ng 6","sort":null,"value":102163,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"}],"value":null,"frames":[],"status":"is_active","history":null,"user_id":8151,"block_id":7081,"category":"water","type_text":"Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh","unit_text":"Kh\u1ed1i","is_default":1,"status_text":"\u0110ang s\u1eed d\u1ee5ng","subtraction":1}],"circle_order":6,"deadline_bill":10,"bill_setting":{"note":{"content":null},"enable_qr":1,"payment_default":"cash","show_circle_day":0,"single_send_zalo":0,"template_bill_zalo":1,"enable_rounding_money":1,"extract_receipt_expense":0},"app_renter_setting":{"allow_update_car":1,"default_password":123456789,"allow_close_clock":0,"auto_create_account":0,"allow_ticket_contract":1,"allow_update_customer":1},"room_group":[{"id":1,"name":"T\u1ea7ng tr\u1ec7t","index":0,"label":"T\u1ea7ng tr\u1ec7t","value":1},{"id":2,"name":"T\u1ea7ng 1","index":1,"label":"T\u1ea7ng 1","value":2}],"max_member":1,"open_door":null,"close_door":null,"rule":null,"extension":null,"data_log":{"menu_label":{"pay_bill":0,"room_list":"0\/6","new_session":6,"deposit_request":6,"terminate_contract":0}},"setting":{"car_function":1,"post_function":1,"agent_function":1,"asset_function":1,"price_item_ele":3,"price_item_wifi":0,"price_item_trash":0,"price_item_water":3,"task_job_function":1,"send_sms_when_create_bill":1,"contract_document_function":0},"province_id":72,"district_id":712,"ward_id":25732,"address_component":{"address":"63, An T\u1ecbnh, Tr\u1ea3ng B\u00e0ng, T\u00e2y Ninh","ward_id":"25732","position":{"latitude":"10.7829132","longitude":"106.6961898"},"district_id":"712","province_id":"72","address_detail":"63"},"address":"63, An T\u1ecbnh, Tr\u1ea3ng B\u00e0ng, T\u00e2y Ninh","latitude":10.7829132,"longitude":106.6961898,"auto_create_room":1,"post_ids":[]}'>
                                <div style="width: 100%; height: 100%; align-items: center;
                            display: inherit;
                            text-align: center;
                            justify-content: center; color: #000" data-bs-toggle="tooltip" data-bs-placement="top"
                                    title="Chỉnh sửa Nhà trọ">
                                    <i data-feather="edit"> </i>
                                </div>
                            </div>

                            <a class="btn-round btn-go-to" data-bs-toggle="tooltip" data-bs-placement="top"
                                title="Tới quản lý Nhà trọ" href="/quan-ly/nha-tro/7081">
                                <i data-feather="arrow-right"> </i>
                            </a>

                            
        </div>
        <script type="text/javascript">
            $(document).ready(function () {
                $("#manageBlock .btn-edit").click(function (e) {
                    let ModalAddBlock = $($(this).data('bsTarget'));
                    ModalAddBlock &&
                        ModalAddBlock.data('block', $(this).data('block'));
                });

                $("#manageBlock .btn-delete").click(function (e) {
                    Swal.fire({
                        title: 'Thông báo!',
                        text: "Bạn có chắc chắn muốn xóa nhà trọ",
                        icon: 'warning',
                        showCancelButton: true,
                        cancelButtonColor: '#d33',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'Vâng! tôi muốn xóa',
                        cancelButtonText: 'Không xóa'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            $.transferData({
                                method: "GET",
                                url: __helper.url.urlPattern(__routeApi.block.delete, {
                                    block_id: parseInt($(this).data('id'))
                                }),
                                success: (res) => {
                                    Swal.fire({
                                        title: 'Thành công!',
                                        text: res.message,
                                        icon: 'success',
                                        confirmButtonColor: '#3c9e47',
                                        confirmButtonText: 'Đóng'
                                    }).then((result) => {
                                        window.location.href = "/quan-ly";
                                    });
                                }
                            });
                        }
                    });
                });
            });
        </script>
        <!-- Modal add block -->
        <div class="modal fade" data-bs-backdrop="static" id="addBlock" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <div
                            style="margin-right: 15px;outline: 0;box-shadow: 0 0 0 .25rem rgb(76 175 80 / 16%);opacity: 1;border-radius: 100%;width: 36px;height: 36px;justify-content: center;align-items: center;display: flex;background-color: #b1e1b8;">
                            <i data-feather="home"> </i>
                        </div>
                        <h5 class="modal-title">Thêm nhà trọ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"> </button>
                    </div>
                    <div class="modal-body">
                        <form method="POST" class="needs-validation" id="add-block-form" novalidate>
                            <input type="hidden" name="_token" value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="title-item-small">
                                        <b>Thông tin:</b>
                                        <i class="des">Các thông tin nhà trọ cơ bản</i>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select data-format="numeric" id="category" name="category"
                                            class="form-select form-control" required>
                                            <option value="0">Nhà trọ</option>
                                            <option value="1">Ký túc xá/sleepbox</option>
                                            <option value="2">Chung cư mini</option>
                                            <option value="5">Tòa nhà chung cư</option>
                                            <option value="3">Nhà nguyên căn</option>
                                            <option value="4">Văn phòng cho thuê</option>
                                        </select>
                                        <label for="category">Loại nhà trọ</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" name="name" id="name" required
                                            placeholder="Tên nhà trọ">
                                        <label for="name">Tên nhà trọ</label>
                                        <div class="invalid-feedback">
                                            Vui lòng nhập tên nhà trọ
                                        </div>
                                    </div>
                                </div>

                                <div class="col-6 mt-2 invisible d-none">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="room_type_room"
                                            name="room_type" value="room">
                                        <label class="form-check-label" for="room_type_room">
                                            <b>Thuê theo phòng</b>
                                            <p>Tính tiền thuê theo phòng</p>
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="room_type_bed" name="room_type"
                                            value="bed">
                                        <label class="form-check-label" for="room_type_bed">
                                            <b>Thuê theo giường</b>
                                            <p>Tính tiền theo giường</p>
                                        </label>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="title-item-small">
                                        <b>Chọn phương thức khởi tạo dữ liệu</b>
                                        <i class="des">Chọn 1 trong 3 phương thức tạo khởi tạo dữ liệu</i>
                                    </div>
                                </div>
                                <div class="col-12 mt-2 type-input-room hide-when-edit d-flex"
                                    style="text-align: center;">
                                    <style type="text/css">
                                        .type-input-room .item {
                                            width: 100%;
                                            border: 1px solid #ccc;
                                            margin: 5px;
                                            padding: 5px;
                                            border-radius: 10px;
                                        }
                                    </style>
                                    <div class="item">
                                        <div class="form-check form-check-inline">
                                            <input data-format="numeric" class="form-check-input" type="radio"
                                                name="auto_create_room" id="enable" checked value="1">
                                            <label class="form-check-label" for="enable">
                                                <b>Tạo dữ liệu <span class="room_type_name">phòng</span> tự động </b>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="item">
                                        <div class="form-check form-check-inline">
                                            <input data-format="numeric" class="form-check-input" type="radio"
                                                name="auto_create_room" id="excel" value="2">
                                            <label class="form-check-label" for="excel">
                                                <b>Tạo dữ liệu <span class="room_type_name">phòng</span> từ Excel</b>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="item">
                                        <div class="form-check form-check-inline">
                                            <input data-format="numeric" class="form-check-input" type="radio"
                                                name="auto_create_room" id="disable" value="0">
                                            <label class="form-check-label" for="disable">
                                                <b>Tạo dữ liệu <span class="room_type_name">phòng</span> thủ công </b>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12 mt-2 info-auto-create-room-enable">
                                    <div class="loz-alert info mt-2 mb-2">
                                        <div class="icon flex-0">
                                            <i data-feather="info" size="20"> </i>
                                        </div>
                                        <div class="des flex-1">
                                            <b>Ghi chú:</b> Vui lòng chọn số tầng và nhập số <span
                                                class="room_type_name">phòng</span> để hệ thống tự động tạo dữ liệu
                                            <span class="room_type_name">phòng</span> cho bạn
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12 mt-2 d-none info-auto-create-room-disable">
                                    <div class="loz-alert warning mt-2 mb-2">
                                        <div class="icon flex-0">
                                            <i data-feather="info" size="20"> </i>
                                        </div>
                                        <div class="des flex-1">
                                            <b>Ghi chú:</b> Bạn phải thực hiện tạo dữ liệu cho từng <span
                                                class="room_type_name">phòng</span> bằng thủ công.
                                        </div>
                                    </div>
                                </div>

                                <div class="d-none import-from-excel-layout">
                                    <style type="text/css">
                                        .stepProgress {
                                            position: relative;
                                            padding-left: 45px;
                                            list-style: none;
                                        }

                                        .stepProgress::before {
                                            display: inline-block;
                                            content: '';
                                            position: absolute;
                                            top: 0;
                                            left: 15px;
                                            width: 10px;
                                            height: 100%;
                                            border-left: 2px solid #CCC;
                                        }

                                        .stepProgress-item {
                                            position: relative;
                                            counter-increment: list;
                                        }

                                        .stepProgress-item:not(:last-child) {
                                            padding-bottom: 20px;
                                        }

                                        .stepProgress-item::before {
                                            display: inline-block;
                                            content: '';
                                            position: absolute;
                                            left: -30px;
                                            height: 100%;
                                            width: 10px;
                                        }

                                        .stepProgress-item::after {
                                            content: '';
                                            display: inline-block;
                                            position: absolute;
                                            top: 0;
                                            left: -39px;
                                            width: 20px;
                                            height: 20px;
                                            border: 2px solid #CCC;
                                            border-radius: 50%;
                                            background-color: #FFF;
                                        }
                                    </style>
                                    <ul class="stepProgress">
                                        <li class="stepProgress-item">Bước 1: Tải file mẫu</li>
                                        <li class="stepProgress-item">Bước 2: Nhập dữ liệu của bạn vào file mẫu</li>
                                        <li class="stepProgress-item">Bước 3: Upload file mẫu lên để nhập liệu</li>
                                    </ul>
                                    <div class="row g-2">
                                        <div class="col-6 mt-2 import-excel">
                                            <div class="image-upload-simple" style="height: 100px;">
                                                <input type="file" style="display: none" id="file-excel" accept=".xlsx">
                                                <div class="container-upload " id="import-excel-trigger"
                                                    style="border: 2px dashed #ccc;">
                                                    <div class="placeholder __add-more-imge"
                                                        style="display: grid;cursor: pointer !important;width: 100%;align-items: center;justify-content: center;height: 100%;margin:-10px;">
                                                        <div class="icon-upload" style="margin:auto"><svg
                                                                xmlns="http://www.w3.org/2000/svg" width="30"
                                                                height="30" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="feather feather-upload-cloud">
                                                                <polyline points="16 16 12 12 8 16"></polyline>
                                                                <line x1="12" y1="12" x2="12" y2="21"></line>
                                                                <path
                                                                    d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3">
                                                                </path>
                                                                <polyline points="16 16 12 12 8 16"></polyline>
                                                            </svg>
                                                        </div>
                                                        <label style="text-decoration:underline" id="text-import">File
                                                            Excel cần nhập dữ liệu</label>
                                                    </div>
                                                </div>
                                                <div class="invalid-feedback"> Vui lòng chọn file Excel</div>
                                            </div>
                                        </div>
                                        <div class="col-6 mt-2 download-template-excel">
                                            <a href="/download-template-excel" style=" color: inherit;">
                                                <div class="image-upload-simple" style="height: 100px;">
                                                    <div class="container-upload " id="download-excel-trigger"
                                                        style="border: 2px dashed #ccc;">
                                                        <div class="placeholder __add-more-imge"
                                                            style="display: grid;cursor: pointer !important;width: 100%;align-items: center;justify-content: center;height: 100%;margin:-10px;">
                                                            <div class="icon-upload" style="margin:auto">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                    viewBox="0 0 24 24" width="24" height="24"
                                                                    class="main-grid-item-icon" fill="none"
                                                                    stroke="currentColor" stroke-linecap="round"
                                                                    stroke-linejoin="round" stroke-width="2">
                                                                    <polyline points="8 17 12 21 16 17" />
                                                                    <line x1="12" x2="12" y1="12" y2="21" />
                                                                    <path
                                                                        d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29" />
                                                                </svg>
                                                            </div>
                                                            <label style="text-decoration:underline"
                                                                id="text-download">Tải file Excel mẫu</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>

                                        </div>
                                    </div>
                                </div>

                                <div class="col-6 mt-2 count_floor">
                                    <div class="form-floating">
                                        <select data-format="numeric" id="count_floor" name="count_floor"
                                            class="form-select form-control" required>
                                            <option value="1">Tầng trệt (không có tầng)</option>
                                            <option value="2">2 tầng (Gồm 1 trệt + 1 tầng)</option>
                                            <option value="3">3 tầng (Gồm 1 trệt + 2 tầng)</option>
                                            <option value="4">4 tầng (Gồm 1 trệt + 3 tầng)</option>
                                            <option value="5">5 tầng (Gồm 1 trệt + 4 tầng)</option>
                                            <option value="6">6 tầng (Gồm 1 trệt + 5 tầng)</option>
                                            <option value="7">7 tầng (Gồm 1 trệt + 6 tầng)</option>
                                            <option value="8">8 tầng (Gồm 1 trệt + 7 tầng)</option>
                                        </select>
                                        <label for="count_floor">Loại nhà trọ</label>
                                    </div>
                                </div>

                                <div class="col-6 mt-2 total-room">
                                    <div class="form-floating">
                                        <input data-format="numeric" type="text" class="form-control" name="room_total"
                                            id="room_total" placeholder="Số phòng/giường" required>
                                        <label for="room_total">Số <span class="room_type_name">phòng</span></label>
                                        <div class="invalid-feedback">
                                            Vui lòng nhập tổng số <span class="room_type_name">phòng</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="title-item-small">
                                        <b>Địa chỉ:</b>
                                        <i class="des">Giúp cho khách thuê của bạn có thể tìm thấy nhà trọ của bạn dễ
                                            dàng hơn</i>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div id="block_address" class="address_component_container row g-2">
                                        <div class="col-6 mt-2">
                                            <div class="form-floating">
                                                <select data-format="numeric" name="address_component[province_id]"
                                                    class="form-select form-control province" required>
                                                    <option value="">Tỉnh/Thành phố</option>
                                                </select>
                                                <label for="province">Chọn Tỉnh/Thành phố</label>
                                                <div class="invalid-feedback">
                                                    Vui lòng chọn thành phố
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6 mt-2">
                                            <div class="form-floating">
                                                <select data-format="numeric" name="address_component[district_id]"
                                                    class="form-select form-control district" required>
                                                    <option value="">Quận/Huyện</option>
                                                </select>
                                                <label for="district">Chọn Quận/Huyện</label>
                                                <div class="invalid-feedback">
                                                    Vui lòng chọn quận hoặc huyện
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-2">
                                            <div class="form-floating">
                                                <select data-format="numeric" name="address_component[ward_id]"
                                                    class="form-select form-control ward" required>
                                                    <option value="">Phường/Xã</option>
                                                </select>
                                                <label for="ward">Chọn Phường/Xã</label>
                                                <div class="invalid-feedback">
                                                    Vui lòng chọn phường hoặc xã
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-2">
                                            <div class="form-floating">
                                                <input type="text" class="form-control address_detail"
                                                    name="address_component[address_detail]"
                                                    placeholder="ví dụ: 122 - Đường Nguyễn Duy Trinh" required>
                                                <label for="address_detail">Địa chỉ chi tiết. Ví dụ: 122 - Đường Nguyễn
                                                    Duy Trinh</label>
                                                <div class="invalid-feedback">
                                                    Vui lòng nhập địa chỉ chi tiết
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <script type="text/javascript">
                                        $(document).ready(function () {
                                            let __el = {
                                                province: $("#block_address").find(".province"),
                                                district: $("#block_address").find(".district"),
                                                ward: $("#block_address").find(".ward"),

                                                address_detail: $("#block_address").find(".address_detail"),
                                                address_show_container: $("#block_address").find(".address-detail-show-container"),
                                                address_show: $("#block_address").find(".address-detail-show"),
                                            };

                                            function getAddressFull() {
                                                let arrayText = [
                                                    __el.address_detail.val(),
                                                    __el.ward.find('option:selected').text().trim(),
                                                    __el.district.find('option:selected').text().trim(),
                                                    __el.province.find('option:selected').text().trim()
                                                ];
                                                if (arrayText[0].lengh !== '' && arrayText[1].lengh !== '' && arrayText[2].lengh !== '' && arrayText[2].lengh !== '') {
                                                    __el.address_show_container.show();
                                                    __el.address_show.text(arrayText.join(', '));
                                                } else {
                                                    __el.address_show_container.hide();
                                                }
                                            }

                                            __el.address_detail.keyup((e) => {
                                                getAddressFull();
                                            });

                                            __el.province.change(function () {
                                                __el.district.empty();
                                                __el.ward.empty();

                                                $.transferData({
                                                    url: __helper.url.urlPattern(__routeApi.location.showProvince, {
                                                        id: parseInt($(this).val())
                                                    }),
                                                    method: 'GET',
                                                    success: function (res) {
                                                        __el.district.append(`<option value=''>Quận/Huyện</option>`);
                                                        $.each(res.data.districts, function (key, value) {
                                                            __el.district.append(`<option value='${value.id}'>${value.name}</option>`);
                                                        });
                                                        getAddressFull();
                                                    }
                                                });

                                            });

                                            __el.district.change(function () {
                                                __el.ward.empty();
                                                $.transferData({
                                                    url: __helper.url.urlPattern(__routeApi.location.showDistrict, {
                                                        id: parseInt($(this).val())
                                                    }),
                                                    method: 'GET',
                                                    success: function (res) {
                                                        __el.ward.append(`<option value=''>Phường/Xã</option>`);
                                                        $.each(res.data.wards, function (key, value) {
                                                            __el.ward.append(`<option value='${value.id}'>${value.name}</option>`);
                                                        });
                                                        getAddressFull();
                                                    }
                                                });
                                            });

                                            __el.ward.change(function () {
                                                getAddressFull();
                                            });
                                        });
                                    </script>

                                </div>

                                <div class="col-12 mt-2 text-center" style="display: none">
                                    <div style="border: 1px solid #ccc; border-radius: 5px; padding: 10px">
                                        <i data-feather="map-pin"></i>
                                        <input type="hidden" required value="10.7829132" class="form-control"
                                            name="address_component[position][latitude]"
                                            id="address_component[position][latitude]">
                                        <input type="hidden" required value="106.6961898" class="form-control"
                                            name="address_component[position][longitude]"
                                            id="address_component[position][longitude]">
                                        <div class="invalid-feedback">
                                            Vui lòng thêm vị trí nhà trọ
                                        </div>
                                        <b>Vị trí nhà trọ</b>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="title-item-small">
                                        <b>Thông tin cơ bản:</b>
                                        <i class="des not-edit">Thông tin diện tích, giá thuê, số lượng thành viên</i>
                                        <i class="des note" style="color:red; display: none"> <b>*Các thông tin dưới đây
                                                chỉ áp dụng cho lúc tạo nhà trọ tự động và khởi tạo đăng tin cho
                                                thuê</b></i>
                                    </div>
                                </div>

                                <div class="col-6 hide-when-not-room">
                                    <div class="form-floating">
                                        <input data-format="numeric" type="text" class="form-control" name="area"
                                            id="area" value="15" required placeholder="Nhập diện tích">
                                        <label for="area">Diện tích (m2)</label>
                                        <div class="invalid-feedback">
                                            Vui lòng nhập diện tích
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-floating">
                                        <input data-format="numeric" type="text" class="form-control" name="room_amount"
                                            id="room_amount" placeholder="Giá thuê" required>
                                        <label for="room_amount">Giá thuê trung bình (đ)</label>
                                        <div class="invalid-feedback">
                                            Vui lòng nhập giá thuê
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12 hide-when-not-room">
                                    <div class="form-floating">
                                        <select data-format="numeric" id="max_member" name="max_member"
                                            class="form-select form-control">
                                            <option value="1">1 người ở</option>
                                            <option value="2">2 người ở</option>
                                            <option value="3">3 người ở</option>
                                            <option value="4">4 người ở</option>
                                            <option value="5">5-6 người ở</option>
                                            <option value="6">7-10 người ở</option>
                                            <option value="0">Không giới hạn</option>
                                        </select>
                                        <label for="max_member">Tối đa người ở / <span
                                                class="room_type_name">phòng</span></label>
                                    </div>
                                </div>

                                <div class="col-12 hide-when-edit">
                                    <div class="title-item-small">
                                        <b>Cài đặt dịch vụ:</b>
                                        <i class="des">Thiết lập các dịch vụ khi khách thuê sử dụng khi thuê</i>
                                    </div>
                                </div>

                                <div class="col-6 mt-2 hide-when-edit">
                                    <div class="form-floating">
                                        <select data-format="numeric" id="setting[price_item_ele]"
                                            name="setting[price_item_ele]" class="form-select form-control">
                                            <option value="0">Miễn phí/Không sử dụng</option>
                                            <option value="1">Tính theo người</option>
                                            <option value="2">Tính theo tháng</option>
                                            <option value="3" selected>Tính theo đồng hồ (phổ biến)</option>
                                        </select>
                                        <label for="setting[price_item_ele]">Dịch vụ điện</label>
                                    </div>
                                </div>
                                <div class="col-6 mt-2 hide-when-edit">
                                    <div class="form-floating">
                                        <select data-format="numeric" id="setting[price_item_water]"
                                            name="setting[price_item_water]" class="form-select form-control">
                                            <option value="0">Miễn phí/Không sử dụng</option>
                                            <option value="1">Tính theo người</option>
                                            <option value="2">Tính theo tháng</option>
                                            <option value="3" selected>Tính theo đồng hồ (phổ biến)</option>
                                        </select>
                                        <label for="setting[price_item_water]">Dịch vụ nước</label>
                                    </div>
                                </div>
                                <div class="col-6 mt-2 hide-when-edit">
                                    <div class="form-floating">
                                        <select data-format="numeric" id="setting[price_item_trash]"
                                            name="setting[price_item_trash]" class="form-select form-control">
                                            <option value="0">Miễn phí/Không sử dụng</option>
                                            <option value="1">Tính theo người</option>
                                            <option value="2">Tính theo tháng</option>
                                        </select>
                                        <label for="setting[price_item_trash]">Dịch vụ rác</label>
                                    </div>
                                </div>

                                <div class="col-6 mt-2 hide-when-edit">
                                    <div class="form-floating">
                                        <select data-format="numeric" id="setting[price_item_wifi]"
                                            name="setting[price_item_wifi]" class="form-select form-control">
                                            <option value="0">Miễn phí/Không sử dụng</option>
                                            <option value="1">Tính theo người</option>
                                            <option value="2">Tính theo tháng</option>
                                        </select>
                                        <label for="setting[price_item_wifi]">Dịch vụ wifi/internet</label>
                                    </div>
                                </div>

                                <div class="col-12 hide-when-edit">
                                    <div class="title-item-small">
                                        <b>Cài đặt tính năng:</b>
                                        <i class="des">Thiết lập các tính năng cho nhà trọ</i>
                                    </div>
                                </div>

                                <div class="col-6 mt-2 hide-when-edit">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" value="1"
                                            id="setting[asset_function]" name="setting[asset_function]" checked>
                                        <label class="form-check-label" for="setting[asset_function]">
                                            <b>Quản lý tài sản</b>
                                            <p>Quản lý tài sản khách thuê sử dụng</p>
                                        </label>
                                    </div>
                                </div>

                                <div class="col-6 mt-2 hide-when-edit">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" value="1"
                                            id="setting[car_function]" name="setting[car_function]" checked>
                                        <label class="form-check-label" for="setting[car_function]">
                                            <b>Quản lý xe</b>
                                            <p>Các thông tin xe của khách thuê</p>
                                        </label>
                                    </div>
                                </div>

                                <div class="col-6 mt-2">
                                    <div class="form-check form-switch">
                                        <input data-format="numeric" class="form-check-input" type="checkbox" value="1"
                                            id="setting[agent_function]" name="setting[agent_function]" checked>
                                        <label class="form-check-label" for="setting[agent_function]">
                                            <b>Quản lý mô giới</b>
                                            <p>Các thông tin về mô giới</p>
                                        </label>
                                    </div>
                                </div>

                                <div class="col-6 mt-2">
                                    <div class="form-check form-switch">
                                        <input data-format="numeric" class="form-check-input" type="checkbox" value="1"
                                            id="setting[post_function]" name="setting[post_function]" checked>
                                        <label class="form-check-label" for="setting[post_function]">
                                            <b>Quản lý tin đăng</b>
                                            <p>Các thông tin về tin đăng</p>
                                        </label>
                                    </div>
                                </div>

                                <div class="col-6 mt-2 hide-when-edit">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" value="1"
                                            id="setting[send_sms_when_create_bill]"
                                            name="setting[send_sms_when_create_bill]" checked>
                                        <label class="form-check-label" for="setting[send_sms_when_create_bill]">
                                            <b>Gửi tin nhắn tự động cho khách thuê</b>
                                            <p>Giửi tin nhắn SMS tự động cho khách thuê sau khi lập phiếu</p>
                                        </label>
                                    </div>

                                </div>

                                <div class="col-12">
                                    <div class="title-item-small">
                                        <b>Cài đặt cho phiếu thu (hóa đơn):</b>
                                        <i class="des">Thiết lập cho hóa đơn khi bạn lập hóa đơn tiền thuê cho khách
                                            thuê</i>
                                    </div>
                                </div>

                                <div class="col-6">
                                    <div class="form-floating">
                                        <input data-format="numeric" type="text" class="form-control" id="circle_order"
                                            name="circle_order" placeholder="Ngày lập hóa đơn" min="1" max="31"
                                            required>
                                        <label for="circle_order">Ngày lập hóa đơn và trong khoảng 1 đến 31</label>
                                        <div class="invalid-feedback">
                                            Vui lòng nhập ngày lập hóa đơn
                                        </div>
                                    </div>
                                    <div class="loz-alert info mt-2 mb-2">
                                        <div class="icon flex-0">
                                            <i data-feather="info" size="20"> </i>
                                        </div>
                                        <div class="des flex-1">
                                            <b>Thông tin:</b> Khi đến ngày lập hóa đơn hệ thống sẽ nhắc nhở qua
                                            thông báo
                                        </div>
                                    </div>
                                    <p>
                                        - Là ngày lập hóa đơn tiền điện, nước...<br>
                                        - Nhập một ngày trong tháng. Nếu không nhập mặc định là cuối tháng.
                                    </p>
                                </div>

                                <div class="col-6">
                                    <div class="form-floating">
                                        <input data-format="numeric" type="text" class="form-control" id="deadline_bill"
                                            name="deadline_bill" placeholder="Ngày lập hóa đơn" min="1" max="20"
                                            required>
                                        <label for="deadline_bill">Hạn đóng tiền</label>
                                        <div class="invalid-feedback">
                                            Vui lòng nhập hạn đóng tiền và trong khoảng 1 đến 20 ngày
                                        </div>
                                    </div>
                                    <div class="loz-alert info mt-2 mb-2">
                                        <div class="icon flex-0">
                                            <i data-feather="info" size="20"> </i>
                                        </div>
                                        <div class="des flex-1">
                                            <b>Thông tin:</b> Khi khách đóng tiền không đúng thời hạn hệ thống sẽ nhắc
                                            nhở
                                        </div>
                                    </div>
                                    <p>
                                        <b>Ví dụ:</b> Bạn lập phiếu ngày 01 và hạn đóng tiền thuê trọ ở đây là 5 ngày
                                        thì ngày 05
                                        sẽ là ngày hết hạn
                                    </p>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer modal-footer--sticky">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                        <button type="button" id="submit-block" class="btn btn-primary">
                            <i data-feather="plus"> </i>
                            Thêm nhà trọ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- <script type="text/javascript">
    $(document).ready(function(){
        var __el = {
            form    : $('#add-block-form'),
            modal   : $("#addBlock"),
            submit  : $('#submit-block'),
            province: $("#province"),
            district: $("#district"),
            ward    : $("#ward"),

        };

        let dataBlock =  null;

        const excelFile = (file)=> {
            try {
                var reader = new FileReader();
                reader.readAsBinaryString(file);
                reader.onload = function(e) {
            
                    var data = e.target.result;

                    var workbook = XLSX.read(data, {
                        type : 'binary',
                        UTC  : false
                    });

                    if(workbook.SheetNames && workbook.SheetNames.length!==0){
                        const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], { header: 1 });
                        if (jsonData.length !== 0) {
                            let header = jsonData[0];
                            let data = [];
                            jsonData.forEach((row, rowIndex) => {
                                if(row.length!==0 && rowIndex !== 0){
                                    data[rowIndex] = []
                                    row.forEach((value, colIndex) => {
                                        let header = jsonData[0][colIndex];
                                        data[rowIndex].push({
                                            colIndex: colIndex,
                                            name: header,
                                            value: value
                                        });
                                    })
                                }
                            
                            })

                            $.transferData({
                                method: "POST",
                                url: __helper.url.urlPattern(__routeApi.checkDataFromFile),
                                data : {
                                    data_excel: data
                                },
                                success: (res) => {
                                    __el.form.find('#count_floor').val(res.data.count_floor).change();
                                    Swal.fire({
                                        title: 'Thành công!',
                                        text: res.message,
                                        icon: 'success',
                                        confirmButtonColor: '#3c9e47',
                                        confirmButtonText: 'Đóng'
                                    });
                                },
                                fail: (res) => {
                                    Swal.fire({
                                        title: 'Dữ liệu không chính xác',
                                        html: res.message,
                                        icon: 'error',
                                        confirmButtonText: 'Đã hiểu'
                                    });

                                    $('#file-excel').val('');
                                    $('#text-import').text('Chưa có tệp nào được chọn');
                                }
                            });
                        }
                    }
                }
            }catch(e){
                console.error(e);
            }
        }

        const changeRoomType = (room_type)=>{
            if(room_type ==='room'){
                __el.form.find('input[name="room_total"]').attr('placeholder', 'Nhập số phòng');
                __el.form.find('.room_type_name').text('phòng');
                __el.form.find('.hide-when-not-room').show();

            }else{
                __el.form.find('input[name="room_total"]').attr('placeholder', 'Nhập số giường');
                __el.form.find('.room_type_name').text('giường');
                __el.form.find('.hide-when-not-room').hide();
            }
        };

        __el.form.find("#import-excel-trigger").on("click", function() {
            __el.form.find("#file-excel").click();
        });
        
        __el.modal.find("#province").change(function(){
            __el.modal.find("#district").empty();
            __el.modal.find("#ward").empty();

            $.transferData({
                url: __helper.url.urlPattern(__routeApi.location.showProvince, {
                        id : parseInt($(this).val())
                    }),
                method: 'GET',
                loadingEle:false,
                success:function(res){
                    __el.modal.find("#district").append(`<option value=''>Chọn Quận/Huyện</option>`);
                    $.each(res.data.districts, function(key, value) {
                        __el.modal.find("#district").append(`<option value='${value.id}'>${value.name}</option>`);
                    });
                }
            });

        });

        __el.modal.find("#district").change(function(){
            __el.modal.find("#ward").empty();
            $.transferData({
                url: __helper.url.urlPattern(__routeApi.location.showDistrict, {
                        id : parseInt($(this).val())
                    }),
                method: 'GET',
                loadingEle:false,
                success:function(res){
                    __el.modal.find("#ward").append(`<option value=''>Chọn Phường/Xã</option>`);
                    $.each(res.data.wards, function(key, value) {
                        __el.modal.find("#ward").append(`<option value='${value.id}'>${value.name}</option>`);
                    });
                }
            });
        });


        __el.form.on("change","#file-excel", function(e) {
            var file = e.target.files[0];
            if (file) {
                __el.form.find("#text-import").text(file.name)
                excelFile(file);
            } else {
                alert("Vui lòng chọn file excel để tiếp tục!");
            }
        });

        __el.form.on('change', 'input[name="room_type"]', function (e) {
            changeRoomType($(this).val())
        });

        __el.form.on('change', 'select[name="category"]', function (e) {
            if($(this).val() == 1)
                __el.form.find('#room_type_bed').prop('checked', true).change();
            else
                __el.form.find('#room_type_room').prop('checked', true).change();
                
        });

        __el.form.on('change', 'input[name="auto_create_room"]', function (e) {
            if (__el.form.find("#disable").is(':checked')) {
                __el.form.find("#file-excel").removeAttr('required'); 
                __el.form.find("#room_total").removeAttr('required');

                __el.form.find("#room_total").attr("disabled", true);
                __el.form.find("#room_total").val(0);

                __el.form.find('.total-room').removeClass("d-none");
                __el.form.find('.count_floor').removeClass("d-none");   
                __el.form.find('.import-from-excel-layout').addClass("d-none");  
                __el.form.find(".info-auto-create-room-enable").addClass("d-none");
                __el.form.find(".info-auto-create-room-disable").removeClass("d-none");
                __el.form.find('.total-room').addClass("d-none");
                __el.form.find('.count_floor').addClass("d-none");  

                __el.form.find('#file-excel').val('');
                __el.form.find('#text-import').text('File Excel cần nhập dữ liệu');

            } else if (__el.form.find("#enable").is(':checked')) {
                __el.form.find("#room_total").attr('required', 'required');
                __el.form.find("#file-excel").removeAttr('required');   

                __el.form.find("#room_total").removeAttr("disabled");
                __el.form.find("#room_total").val('');

                __el.form.find('.total-room').removeClass("d-none");
                __el.form.find('.count_floor').removeClass("d-none");   
                __el.form.find(".info-auto-create-room-enable").removeClass("d-none");
                __el.form.find(".info-auto-create-room-disable").addClass("d-none");

                __el.form.find('.import-from-excel-layout').addClass("d-none"); 

                __el.form.find('#file-excel').val('');
                __el.form.find('#text-import').text('File Excel cần nhập dữ liệu');

            } else if (__el.form.find("#excel").is(':checked')) {
                __el.form.find('.total-room').addClass("d-none");
                __el.form.find('.count_floor').addClass("d-none");    
                __el.form.find(".info-auto-create-room-enable").addClass("d-none");
                __el.form.find('.import-from-excel-layout').removeClass("d-none");     
                __el.form.find(".info-auto-create-room-disable").addClass("d-none");
                __el.form.find("#room_total").removeAttr('required');  
                 
                __el.form.find("#file-excel").attr('required', 'required');    
            }
        });

        __el.form.on('change', '#room_total', function (e) {
            if(parseInt($(this).val()) === 0){
                __el.form.find('#auto_create_room').prop('checked', false);
                __el.form.find("#auto_create_room").attr("disabled", true);
            }else{
                __el.form.find('#auto_create_room').prop('checked', true);
                __el.form.find("#auto_create_room").removeAttr("disabled");
            }
        });

        
        new __modalForm(
            __el.modal.get(0),
            __el.form.get(0),
            __el.submit.get(0)
        ).start(null, {
            __openModalForm: function () {
                __el.form.get(0).reset();
                dataBlock = __el.modal.data('block');
                __el.modal.find('.title-disable').remove();
                __el.modal.find('input[name="count_floor"]').remove();
                __el.modal.find("#province").empty();
                __el.modal.find("#district").empty();
                __el.modal.find("#ward").empty();
                if(dataBlock){
                    __el.modal.find('.count_floor').before(`
                    <div class="col-12 title-disable">
                        <div class="title-item-small">
                            <b>Thông tin không thể chỉnh sửa:</b>
                            <i class="des">Các thông tin dưới đây không thể được chỉnh sửa</i>
                        </div>
                    </div>`);
                    __el.modal.find('.not-edit').hide();
                    __el.modal.find('.note').show();
                    __el.modal.find('#count_floor').attr("disabled", true);
                    __el.modal.find('#count_floor').after(`<input type="hidden" data-format="numeric" class="form-control" name="count_floor" placeholder="Số phòng/giường" value="${dataBlock.count_floor}">`);
                    __el.modal.find('#room_total').attr("readonly", true);
                    __el.modal.find('.hide-when-edit').addClass("d-none");
                    
                    $.transferData({
                        method: "POST",
                        url: __helper.url.urlPattern(__routeApi.location.init),
                        data: {
                            'province_id': dataBlock.province_id,
                            'district_id': dataBlock.district_id,
                            'ward_id': dataBlock.ward_id,
                        },
                        loadingEle:false,
                        success: (res) => {
                            $.each(res.data.provinces, function(key, province) {
                                __el.modal.find(".province").append(`<option value='${province.id}'>${province.short_name}</option>`);
                                if(parseInt(province.id) === parseInt(dataBlock.province_id))
                                    $(`.province option[value=${province.id}]`).prop('selected', true);
                            });

                            $.each(res.data.districts, function(key, district) {
                                __el.modal.find(".district").append(`<option value='${district.id}'>${district.name}</option>`);
                                if(parseInt(district.id) === parseInt(dataBlock.district_id))
                                    $(`.district option[value=${district.id}]`).prop('selected', true);
                            });

                            $.each(res.data.wards, function(key, ward) {
                                __el.modal.find(".ward").append(`<option value='${ward.id}'>${ward.name}</option>`);
                                if(parseInt(ward.id) === parseInt(dataBlock.ward_id))
                                    $(`.ward option[value=${ward.id}]`).prop('selected', true);
                            });
                        },
                    });

                    __el.modal.find('.modal-title').text(`Chỉnh sửa ${dataBlock.category_name} ${dataBlock.name}`);
                    __el.modal.find('.modal-footer .btn-primary').text(`Chỉnh sửa ${dataBlock.category_name}`);
                    __el.form.setObjectToForm(dataBlock);
                    changeRoomType(dataBlock.room_type);
                }else{
                    __el.modal.find('.not-edit').show();
                    __el.modal.find('.note').hide();
                    __el.modal.find('input[name="count_floor"]').remove();
                    __el.modal.find('.title-disable').remove();
                    __el.modal.find('#count_floor').attr("disabled", false);
                    __el.modal.find('#room_total').attr("readonly", false);
                    __el.form.find('input[name="room_type"]').val(['room']);
                    __el.modal.find('.hide-when-edit').removeClass("d-none");
                    changeRoomType('room');

                    __el.modal.find(".district").empty();
                    __el.modal.find(".ward").empty();
                    if(!__el.modal.find(".province option[value='79']").length){
                        $.transferData({
                            method: "GET",
                            url: __helper.url.urlPattern(__routeApi.location.provinces),
                            loadingEle:false,
                            success: (res) => {
                                __el.modal.find(".province").empty();
                                __el.modal.find(".province").append(`<option value=''>Chọn Tỉnh/Thành phố</option>`);
                                $.each(res.data, function(key, value) {
                                    __el.modal.find(".province").append(`<option value='${value.id}'>${value.short_name}</option>`);
                                });
                            },
                        });
                    }
                }
            },
            __closeModalForm: function () {
                __el.form.get(0).reset();
                __el.form.get(0).classList.remove('was-validated');

                __el.modal.data('block', null);

                __el.modal.find('.modal-title').text("Thêm nhà trọ");
                __el.modal.find('.modal-footer .btn-primary').text("Thêm nhà trọ");
                __el.modal.find('input[name="auto_create_room"][value="1"]').prop('checked', true).change();
            },
            __submitModalForm: function(e){
                let data = __el.form.getObjectOfForm();
                if (!__el.form.get(0).checkValidity()) {
                    __el.form.get(0).classList.add('was-validated');
                    Swal.fire({
                        title: 'Thông báo!',
                        text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                        icon: 'error',
                        confirmButtonText: 'Đã hiểu'
                    });
                    return false;
                }

                if(parseInt(__el.form.find('input[name="auto_create_room"]:checked').val()) === 2){}
                    data.file = $("#file-excel")[0].files[0]
     
                data.address_component['address'] = ([
                    __el.modal.find(".address_detail").val(),
                    __el.modal.find(".ward option:selected").val() ? __el.modal.find(".ward option:selected").text() : '',
                    __el.modal.find(".district option:selected").val() ? __el.modal.find(".district option:selected").text() : '',
                    __el.modal.find(".province option:selected").val() ? __el.modal.find(".province option:selected").text() : '',
                ]).join(', ');

                let url  = !dataBlock ? __helper.url.urlPattern(__routeApi.block.create) : __helper.url.urlPattern(__routeApi.block.update, {
                    block_id : parseInt(dataBlock.id)
                });
  
                $.transferForm({
                    method: "POST",
                    url,
                    data ,
                    success: function(res) {
                        Swal.fire({
                            title: 'Thành công!',
                            text: res.message,
                            icon: 'success',
                            confirmButtonColor: '#3c9e47',
                            confirmButtonText: 'Đóng'
                        }).then((result) => {
                            window.location.href = "/quan-ly";
                        });
                    },
                    fail:(res)=>{
                        Swal.fire({
                            title: 'Thông báo!',
                            text: res.message,
                            icon: 'error',
                            confirmButtonText: 'Đã hiểu'
                        });
                    }
                });
            },
        });
    });
</script> -->
    </div>
    <div class="text-center mt-5"><span style="color: #727272; font-style: italic;">Copyright @ <strong
                style="color: #000">HPT-NTMT</strong> 2020</span></div>
    <div class="text-center">
        <p style="color: #727272; font-style: italic;">Version <strong style="color: #000">1.3.8</strong></p>
    </div>
    <div class="zalo-container fix item-contact">
        <a id="zalo-btn" href="https://zalo.me/0965227453" target="_blank" rel="noopener">
            <div class="animated_zalo infinite zoomIn_zalo cmoz-alo-circle"></div>
            <div class="animated_zalo infinite pulse_zalo cmoz-alo-circle-fill"></div>
            <span>
                <img width="100%" src="https://quanlytro.me/images/icons/zalo-icon-white.webp"
                    alt="Liên hệ với LOZIDO - Quản lý nhà cho thuê qua Zalo">
            </span>
        </a>
    </div>

    <script>
        feather.replace();

        $(document).ready(function () {
            $(document).find('input[data-format="numeric"][type="text"]').map((key, element) => {
                element.addEventListener('keyup', e => {
                    let value = $(element).val();
                    let number = __helper.convertStringToNumber(value);
                    let newVal = __format.currencyInput(number);

                    $(element).val(value === '' ? '' : isNaN(number) ? '' : newVal);
                });
            });

            $(document).find('input[data-format="stringNumber"]').map((key, element) => {
                element.addEventListener('keyup', e => {
                    $(element).val(__format.phone($(element).val()));
                });
            });

            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });

            setTimeout(() => {
                $.transferData({
                    url: __helper.url.urlPattern(__routeApi.notification.all, {
                        page: 1
                    }),
                    loadingEle: false,
                    success: (res) => {
                        $('.count-notification').text(res?.data?.unread_count ?? 0);
                        res?.data?.notifications?.length > 0 &&
                            $(".notication-dropdown").html('') &&
                            res.data.notifications.map((notification) => {
                                $(".notication-dropdown").append($(`
                                <li style="cursor: pointer" class="item-notication d-flex align-items-center">
                                        <div class="icon ${!notification?.read_at ? 'not-read' : ''}">
                                            <i data-feather="bell" size="20"></i>
                                        </div>
                                        <div class="content">
                                            <div class="des">
                                                <b>
                                                    ${notification?.data?.title ?? ''}
                                                </b>
                                                <p>${notification?.data?.body ?? ''}</p>
                                            </div>
                                            <div class="time">${notification?.created_at ?? ''}</div>
                                        </div>
                                </li>
                            `).click((e) => {
                                    Swal.fire({
                                        title: 'Thông báo!',
                                        text: "Tính năng đi đến thông báo đang phát triển. Hệ thống sẽ hoàn thành sớm!",
                                        icon: 'warning',
                                        confirmButtonText: 'Đã hiểu'
                                    });
                                }));
                            });
                        feather.replace();
                    },
                    fail: (res) => {

                    }
                });
            }, 5000);

        });
    </script>
</body>

</html>