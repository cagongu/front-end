<!DOCTYPE html>
<html lang="vi" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

<head>
    <meta charset="utf-8">
    <meta name="geo.region" content="vi">
    <meta name="language" content="vi">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>LOZIDO - Đăng tin cho thuê</title>
    <meta name="keywords" content="Phần mềm nhà trọ, phần mềm phòng trọ, phần mềm quản lý nhà trọ, phần mềm quản lý nhà trọ, quản lý nhà trọ, quản lý trọ, quản lý phòng trọ">
    <meta name="description" content="Hỗ trợ đăng tin cho thuê tới khách thuê tiềm năng trên LOZIDO">

    <meta name="robots" content="noindex, nofollow" />
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="csrf-token" content="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">

    <meta name="author" content="LOZIDO - Quản lý nhà cho thuê">
    <meta name="copyright" content="LOZIDO - Quản lý nhà cho thuê - Platform Quan ly nha tro, phong tro">
    <meta name="abstract" content="Phần mềm quản lý nhà trọ, phòng trọ, ký túc xá, chung cư tốt nhất hiện nay">

    <meta property="og:image" content="https://quanlytro.me/householder-admin/images/lozido_facebook-recovered.jpg">
    <meta property="og:image:secure_url" content="https://quanlytro.me/householder-admin/images/lozido_facebook-recovered.jpg">
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="370">
    <meta property="og:image:type" content="image/webp">

    <link rel="shortcut icon" href="https://quanlytro.me/images/favicon.ico" type="image/x-icon">
    <link rel="alternate" href="https://quanlytro.me/dang-tin" hreflang="vi-vn" />

    <script type="text/javascript">
        var recaptcha_site_key = '6Ld0LAYeAAAAABA67PAls5DpnkfNJ-rkgHbsSilR';
        var __environment = 'production';
    </script>

    <script src="https://quanlytro.me/plugins/jquery-3.6.0/jquery.min.js"></script>
    <script src="https://quanlytro.me/plugins/jquery-3.6.0/jquery-ui-1.8.13.min.js"></script>
    <script src="https://quanlytro.me/plugins/feather.min.js"></script>
    <!-- <script src="https://quanlytro.me/plugins/sweetalert2@11"></script>
    <script src="https://quanlytro.me/bootstrap-5.0/js/popper.min.js"></script> -->
    <script src="https://quanlytro.me/bootstrap-5.0/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/helper.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/format.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/route-api.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/index.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/transporter.js?version=1.3.8"></script>
    <script type="text/javascript" src="https://quanlytro.me/householder-admin/js/upload-image.js?version=1.3.8"></script>
    <style>
        .modal.show .btn-close {
            outline: 0;
            box-shadow: 0 0 0 .25rem rgb(255 87 34 / 9%);
            opacity: 1;
            border-radius: 100%;
            padding: 10px;
        }
        .btn{
            font-size: 14px!important;
            font-weight: 600!important;
        }
    </style>
    <script type="text/javascript">
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        var __current_block = JSON.parse(JSON.stringify({"id":7081,"name":"ASUS","name_full":"Nh\u00e0 tr\u1ecd ASUS","user_id":8151,"category":0,"category_name":"Nh\u00e0 tr\u1ecd","category_name_short":"Nh\u00e0 tr\u1ecd","room_type":"room","room_type_name":"ph\u00f2ng","type":"floors","room_total":6,"count_floor":2,"area":15,"room_amount":36,"ele_amount":0,"water_amount":0,"price_items_cache":[{"id":23351,"name":"Ti\u1ec1n \u0111i\u1ec7n","type":"constant","unit":"kwh","price":1700,"rooms":[{"id":102158,"name":"Ph\u00f2ng 1","sort":null,"value":102158,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102159,"name":"Ph\u00f2ng 2","sort":null,"value":102159,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102160,"name":"Ph\u00f2ng 3","sort":null,"value":102160,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102161,"name":"Ph\u00f2ng 4","sort":null,"value":102161,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102162,"name":"Ph\u00f2ng 5","sort":null,"value":102162,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102163,"name":"Ph\u00f2ng 6","sort":null,"value":102163,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"}],"value":null,"frames":[],"status":"is_active","history":null,"user_id":8151,"block_id":7081,"category":"ele","type_text":"Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh","unit_text":"KWh","is_default":1,"status_text":"\u0110ang s\u1eed d\u1ee5ng","subtraction":1},{"id":23352,"name":"Ti\u1ec1n n\u01b0\u1edbc","type":"constant","unit":"khoi","price":18000,"rooms":[{"id":102158,"name":"Ph\u00f2ng 1","sort":null,"value":102158,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102159,"name":"Ph\u00f2ng 2","sort":null,"value":102159,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102160,"name":"Ph\u00f2ng 3","sort":null,"value":102160,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102161,"name":"Ph\u00f2ng 4","sort":null,"value":102161,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102162,"name":"Ph\u00f2ng 5","sort":null,"value":102162,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"},{"id":102163,"name":"Ph\u00f2ng 6","sort":null,"value":102163,"status":"is_empty","group_id":null,"priority":null,"circle_day":null,"room_amount":null,"status_text":"\u0110ang tr\u1ed1ng","circle_month":null,"active_status":"pending_create_bill","priority_text":"Kh\u00f4ng x\u00e1c \u0111\u1ecbnh","customer_count":null,"active_status_text":"Ch\u1edd k\u1ef3 thu t\u1edbi"}],"value":null,"frames":[],"status":"is_active","history":null,"user_id":8151,"block_id":7081,"category":"water","type_text":"Theo gi\u00e1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh","unit_text":"Kh\u1ed1i","is_default":1,"status_text":"\u0110ang s\u1eed d\u1ee5ng","subtraction":1}],"circle_order":6,"deadline_bill":10,"bill_setting":{"note":{"content":null},"enable_qr":1,"payment_default":"cash","show_circle_day":0,"single_send_zalo":0,"template_bill_zalo":1,"enable_rounding_money":1,"extract_receipt_expense":0},"app_renter_setting":{"allow_update_car":1,"default_password":123456789,"allow_close_clock":0,"auto_create_account":0,"allow_ticket_contract":1,"allow_update_customer":1},"room_group":[{"id":1,"name":"T\u1ea7ng tr\u1ec7t","index":0,"label":"T\u1ea7ng tr\u1ec7t","value":1},{"id":2,"name":"T\u1ea7ng 1","index":1,"label":"T\u1ea7ng 1","value":2}],"max_member":1,"open_door":null,"close_door":null,"rule":null,"extension":null,"data_log":{"menu_label":{"pay_bill":0,"room_list":"0\/6","new_session":6,"deposit_request":6,"terminate_contract":0}},"setting":{"car_function":1,"post_function":1,"agent_function":1,"asset_function":1,"price_item_ele":3,"price_item_wifi":0,"price_item_trash":0,"price_item_water":3,"task_job_function":1,"send_sms_when_create_bill":1,"contract_document_function":0},"province_id":72,"district_id":712,"ward_id":25732,"address_component":{"address":"63, An T\u1ecbnh, Tr\u1ea3ng B\u00e0ng, T\u00e2y Ninh","ward_id":"25732","position":{"latitude":"10.7829132","longitude":"106.6961898"},"district_id":"712","province_id":"72","address_detail":"63"},"address":"63, An T\u1ecbnh, Tr\u1ea3ng B\u00e0ng, T\u00e2y Ninh","latitude":10.7829132,"longitude":106.6961898,"auto_create_room":1,"post_ids":[]}));

        var __permission_block = JSON.parse(JSON.stringify(null));

        let user = JSON.parse(JSON.stringify({"staff":false,"free":false,"trial":true,"fee":false}));
       
    </script>
    <link href="/bootstrap-5.0/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
                        <link href="/householder-admin/css/common.cssversion=1.3.8.css"
                rel="stylesheet">
            </head>

<body style="overflow-x: hidden">
    
    <div id="app_loading" class="text-center" style="padding:40vh 10px">
        <div class="inner-loading">
            <img style="margin: auto" src="/images/icons/loading.gif" alt="Đang tải..." width="50px"/>
            <i class="loading_text" style="font-size: 13px; margin-top: -10px;">Đang tải dữ liệu...</i>
        </div>
    </div>
    <header>
    <div class="header-inner">
                <div class="header-sticky">
            <nav class="navbar navbar-expand-lg navbar-light">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#lozido-main-menu" aria-controls="lozido-main-menu" aria-expanded="false"
                            aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"> </span>
                    </button>
                    <nav class="collapse navbar-collapse lozido-main-menu">
                        <ul class="navbar-nav main-menu-left  me-auto mb-2 mb-lg-0">
                            <li class="nav-item menu-item active">
                                <a href="/" class="nav-link ">
                                    <i data-feather="arrow-left"></i>
                                                                            <img width="180px" src="/images/logo-lozido-quan-ly-tro-white.png"/>
                                                                    </a>
                            </li>
                        </ul>

                        <ul class="topbar-items main-menu-right navbar-nav">
                                                                                                <li class="nav-item menu-item ">
                                        <a href="/quan-ly.html" class="nav-link ">
                                            <i data-feather="home"></i>
                                            <span style="margin-top: 5px" class="text">Quản lý nhà</span>
                                        </a>
                                    </li>
                                                                                                                                                                <li class="nav-item menu-item ">
                                        <a href="/bao-cao.html" class="nav-link ">
                                            <i data-feather="pie-chart"></i>
                                            <span style="margin-top: 5px" class="text">Tổng báo cáo</span>
                                        </a>
                                    </li>
                                                                                                                                                                <li class="nav-item menu-item active">
                                        <a href="/dang-tin.html" class="nav-link ">
                                            <i data-feather="plus"></i>
                                            <span style="margin-top: 5px" class="text">Đăng tin</span>
                                        </a>
                                    </li>
                                                                                                                                                                <li class="nav-item menu-item ">
                                        <a href="/moi-gioi.html" class="nav-link ">
                                            <i data-feather="users"></i>
                                            <span style="margin-top: 5px" class="text">Môi giới</span>
                                        </a>
                                    </li>
                                                                                                                                                                <li class="nav-item menu-item ">
                                        <a href="/phan-quyen.html" class="nav-link ">
                                            <i data-feather="box"></i>
                                            <span style="margin-top: 5px" class="text">Công ty/nhóm</span>
                                        </a>
                                    </li>
                                                                                                                                                                <li class="nav-item menu-item ">
                                        <a href="/cai-dat.html" class="nav-link ">
                                            <i data-feather="settings"></i>
                                            <span style="margin-top: 5px" class="text">Cài đặt chung</span>
                                        </a>
                                    </li>
                                                                                                                                                                                                                                                                                            <li class="nav-item btn-group menu-item ">
                                        <a href="javascript:;" class="nav-link" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span class="count-notification badge">0</span>
                                            <i data-feather="bell"></i>
                                            <span style="margin-top: 5px" class="text">Thông báo</span>
                                        </a>
                                        <ul class="dropdown-menu notication-dropdown dropdown-menu-lg-end">
                                            <div class="text-center" style="padding: 20px">
                                                <img style="margin: auto" src="/images/icons/loading.gif" alt="Đang tải..." width="50px"/>
                                                <div>
                                                    <i class="loading_text" style="font-size: 13px; margin-top: -10px;">Đang tải thông báo...</i>
                                                </div>
                                            </div>
                                        </ul>
                                    </li>

                                                                                                                                <li class="nav-item menu-item ">
                                        <a href="/tai-khoan.html" class="nav-link ">
                                            <i data-feather="user"></i>
                                            <span style="margin-top: 5px" class="text">Tài khoản</span>
                                        </a>
                                    </li>
                                                                                                                                                                <li class="nav-item menu-item ">
                                        <a href="/dang-xuat.html" class="nav-link ">
                                            <i data-feather="log-out"></i>
                                            <span style="margin-top: 5px" class="text">Đăng xuất</span>
                                        </a>
                                    </li>
                                                                                                                    </ul>
                    </nav>
                </div>
            </nav>
        </div>
    </div>
</header>
    <div>
        <style>
    .bg-zalo {
    width: 35px;
    height: 35px;
    background: url(/images/icons/icon-zalo.png) center no-repeat;
    background-size: contain;
    margin: 0 10px;
    display: block!important;
}
    
</style>

<script type="text/javascript" src="https://quanlytro.me/tabulator-5.5/dist/js/tabulator.js"></script>
<script type="text/javascript" src="https://quanlytro.me/tabulator-5.5/dist/js/jquery_wrapper.js"></script>
<script type="text/javascript" src="https://quanlytro.me/householder-admin/plugins/flatpickr/js/flatpickr-4.6.9.min.js"></script>
<script type="text/javascript" src="https://quanlytro.me/householder-admin/plugins/flatpickr/js/month-select-4.6.9.min.js"></script>
<script type="text/javascript" src="https://quanlytro.me/householder-admin/plugins/flatpickr/js/vn.js"></script>
<script type="text/javascript" src="https://quanlytro.me/householder-admin/plugins/xlsx.full.min.js"></script>

<script type="text/javascript" src="https://quanlytro.me/householder-admin/js/tabulator-setting.js?version=1.3.8"></script>

<link href="https://quanlytro.me/householder-admin/plugins/flatpickr/css/flatpickr.min.css" rel="stylesheet">
<link href="https://quanlytro.me/householder-admin/plugins/flatpickr/css/month-select.min.css" rel="stylesheet">
<link href="https://quanlytro.me/tabulator-5.5/dist/css/tabulator_semanticui.min.css" rel="stylesheet">

<script type="text/javascript">
    Tabulator.extendModule("edit", "editors", common_editors);
    Tabulator.extendModule("accessor", "accessors", common_accessor);
    Tabulator.extendModule("format", "formatters", Object.assign(common_formatters, {
        zalo_icon: function (cell, formatterParams) {
            return `
            <a data-phone="${cell.getValue()}" href="https://zalo.me/${cell.getValue()}" target="_blank">
                <i class="bg-zalo"></i>
            </a>
            `;
        }
    }));
</script>

<div class="page-setting">
    <div class="container">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <h4 class="title-item">
                Tin đăng & khách tiềm năng
                <i style="font-size: 14px;
            font-weight: normal;">Tất cả tin đăng cho thuê</i>
            </h4>
        </div>
        <div class="card-feature overflow-hidden">
            <div class="tab">
                <!-- Nav tabs -->
                <ul id="post-tab" class="nav setting-tabs-horizontal" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#post">
                            <i data-feather="list"></i>
                            Tin đăng cho thuê
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link potential" data-bs-toggle="tab" href="#customer-from-lozido">
                            <i data-feather="user"></i>
                            Khách thuê tiềm năng
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="tab-content">
                <div id="post" class="container tab-pane active">
                    <div row>
    <div class="header-item">
        <h4 class="title-item">
            Danh sách tin đăng
            <i class="des">Danh sách tin đăng tìm kiếm khách thuê</i>
        </h4>
        <button class="add-round" data-bs-toggle="modal" data-bs-target="#addPost">
            <span data-bs-toggle="tooltip" data-bs-placement="left" title="Thêm tin đăng">
                <i data-feather="plus"> </i>
            </span>
        </button>
    </div>
    <div id="table-posts" class="celled">
        <div style="border-radius: 10px;">
    <div style="border-radius: 10px; padding: 30px; text-align:center">
        <img width="200px"
             src="https://quanlytro.me/images/empty-box-4085812-3385481.webp"/>
        <h4>Chưa có tin đăng nào!</h4>
            </div>
</div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var __el = {
            table: $("#table-posts"),
        };

        var dataEdited = {};
        var tableDataInit = {};
        var tableData = {};
        let columns = {};

         //Build Tabulator
        let table = new Tabulator(__el.table.get(0), {
            index:'id',
            layout: "fitColumns",
            resizableColumnFit:true,
            //enable reactive data
            reactiveData: true,
            height: false,
            movableRows: true,
            columnHeaderVertAlign: 'middle',
            selectable: false,
            placeholder: `<div class="empty-table" style="margin: auto; display: inline-grid;"><img width="300px" src="https://quanlytro.me/images/empty-box-4085812-3385481.webp" />Không tìm thấy dữ liệu!</div>`
        });

        window.postsTable = table;

        const prepareColumns = function (column) {
            if (column?.clickMenu && typeof commonClickMenu[column?.clickMenu] !== "undefined")
                column.clickMenu = commonClickMenu[column?.clickMenu];
            
            if (!column?.cssClass) {
                if (column?.editor) {
                    column.cssClass = "edit_enable"
                } else {
                    column.cssClass = "edit_disable";
                }
            } 

            return column;
        };

        const loadData = (filter = null) => $.transferData({
            method: "POST",
            data: {
                filter: filter ?? null
            },
            url: __helper.url.urlPattern(__routeApi.post.list),
            success: (res) => {
                if (res?.data?.meta?.level_sale) {
                    let level_sale = res?.data?.meta?.level_sale;
                    level_sale.forEach(function(item) {
                        $('#level_sale').append(`
                        <p>Thời gian sale <b>${ item['name'] }</b>: hoa hồng là : <b> ${ item['value'] }%</b></p>
                        `)
                    });
                }

                if (res?.data?.meta?.reason_cancel_list) {
                    let reason_cancel_list = res?.data?.meta?.reason_cancel_list;
                    reason_cancel_list.forEach(function(item) {
                        $("#cancel_reason_id").append(`<option value='${item.value}'>${item.name}</option>`);
                    });
                }

                if (res?.data?.meta?.during_time) {
                    $('#during_time').text(res?.data?.meta?.during_time);
                }

                if (res?.data?.table_data?.columns) {
                    columns = res?.data?.table_data?.columns;
                    tableData = res?.data?.payload;
                    dataEdited = {};

                    columns.map((column) => {
                        prepareColumns(column);
                        if (column?.columns && column.columns.length > 0) {
                            column.columns.map((col, index_col) => {
                                column.columns[index_col] = prepareColumns(col);
                            });
                        }
                        return column;
                    });

                    tableDataInit = JSON.parse(JSON.stringify(tableData));

                    table.setColumns(columns);
                    table.setData(tableData);
                }
            },
            error: (e) => {
                Swal.fire({
                    title: 'Thông báo!',
                    text: 'Đã có lỗi trong quán trình tải danh sách'+e,
                    icon: 'error',
                    confirmButtonText: 'Đã hiểu'
                });
            }
        });

        loadData(null);
    })
</script>
<!-- Modal -->
<div class="modal fade" data-bs-backdrop="static"  id="addPost" tabindex="-1" aria-labelledby="addPostLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <i style="margin-right: 15px" data-feather="box"> </i>
                <h5 class="modal-title" id="addPostLabel">Thêm tin đăng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"> </button>
            </div>
            <div class="modal-body">
                <form class="needs-validation" id="add-post-form" novalidate>
                    <input type="hidden" name="_token" value="CZqXP04OzKEuLEt01gkxMY2DrN3sCqnCK8eSZ2o4">                    <div class="row g-2">
                        <div class="col-12 mt-2">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" value="1" id="post-status" name="status"
                                       checked>
                                <label class="form-check-label" for="status">
                                    <b>Cho thuê</b>
                                    <p>Khi bật cho thuê, khách thuê có thể tiếp cận tin của bạn
                                </label>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="title-item-small">
                                <b>Thông tin chủ nhà</b>
                                <i class="des">Nhập các thông tin về người cho thuê</i>
                                <i class="des">*Tiêu đề tốt: <b>Cho thuê + loại hình phòng trọ + diện tích + giá + tên đường/quận</b><br>Ví dụ: <br> Cho thuê phòng trọ 18m2 giá rẻ tại Bình Thạnh</i>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" name="title" id="post-title" required
                                    placeholder="Tiêu đề tin đăng">
                                <label for="title">Tiêu đề</label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập tiêu đề
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                                                        <div class="form-floating">
                                <select data-format="numeric" id="post-catogory" name="category_id" class="form-select form-control">
                                                                            <option value="1">Phòng trọ, nhà trọ</option>
                                                                            <option value="2">Ký túc xá, sleepbox</option>
                                                                            <option value="3">Nhà cho thuê</option>
                                                                            <option value="4">Căn hộ chung cư</option>
                                                                            <option value="5">Văn phòng</option>
                                                                            <option value="6">Kho, nhà xưởng</option>
                                                                    </select>
                                <label for="post-catogory">Danh mục thuê</label>
                            </div>
                                                    </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" name="contact_name" id="post-contact-name" required
                                    placeholder="Tên người liên hệ">
                                <label for="contact_name">Tên người liên hệ</label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập Tên người liên hệ
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input data-format="stringNumber" type="text" class="form-control" name="phone" id="post-phone" required
                                    placeholder="Sô điện thoại">
                                <label for="phone">SĐT</label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập số điện thoại
                                </div>
                            </div>
                        </div>
                        <div class="col-12 description-item">
                            <div class="title-item-small">
                                <b>Mô tả</b>
                                <i class="des">Nhập mô tả về nhà cho thuê</i>
                            </div>
                        </div>

                        <div class="col-12 mt-2 description-item">
                            <div class="form-floating">
                                    <textarea type="text" rows="10" style="min-height: 100px" class="form-control"
                                              name="description"
                                              id="description" placeholder="Mô tả" required></textarea>
                                <label for="input_note">Nhập mô tả</label>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="title-item-small">
                                <b>Thông tin cơ bản & giá</b>
                                <i class="des">Nhập các thông tin về phòng cho thuê</i>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="form-floating">
                                <input data-format="numeric" type="text" class="form-control" name="room_amount" id="post-room-amount" required placeholder="Giá thuê">
                                <label for="room_amount">Giá thuê</label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập giá cho thuê
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-floating">
                                <input data-format="numeric" type="text" class="form-control" name="discount_amount" id="post-discount-amount" placeholder="Giảm giá">
                                <label for="discount_amount">Giá thuê khuyến mãi</label>
                                <div class="invalid-feedback">
                                    Phòng có giá thuê khuyến mãi sẽ dễ tiếp cận hơn
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-floating">
                                <input data-format="numeric" type="text" class="form-control" name="deposit_amount" id="post-deposit-amount" placeholder="Tiền cọc">
                                <label for="deposit_amount">Tiền cọc</label>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-floating">
                                <input data-format="numeric" type="text" class="form-control" name="area" id="post-area" required
                                    placeholder="Diện tích">
                                <label for="area">Diện tích </label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập diện tích phòng
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-floating">
                                <input data-format="numeric" type="text" class="form-control" name="ele_amount" id="post-ele-amount" required
                                    placeholder="Giá điện">
                                <label for="ele_amount">Giá điện</label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập Giá điện
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-floating">
                                <input data-format="numeric" type="text" class="form-control" name="water_amount" id="post-water-amount" required
                                    placeholder="Giá nước">
                                <label for="ele_amount">Giá nước</label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập Giá nước
                                </div>
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="form-floating">
                                <select data-format="numeric" id="post-max-member" name="max_member" class="form-select form-control">
                                                                                                                        <option value="1">1 người ở</option>
                                                                                    <option value="2">2 người ở</option>
                                                                                    <option value="3">3 người ở</option>
                                                                                    <option value="4">4 người ở</option>
                                                                                    <option value="5">5-6 người ở</option>
                                                                                    <option value="6">7-10 người ở</option>
                                                                                    <option value="0">Không giới hạn</option>
                                                                                                            </select>
                                <label for="max_member">Tối đa người ở / <span class="room_type_name">phòng</span></label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="input-group">
                                <div class="form-floating">
                                    <input required type="text" class="form-control date-flat-picker" name="available_date"
                                           data-format="date"
                                           id="available-date"
                                           placeholder="Ngày lập hóa đơn" pattern="\d{1,2}\/\d{1,2}\/\d{4}">
                                    <label for="available_date">Ngày có thể vào ở</label>
                                </div>
                                <label class="input-group-text" for="available_date">
                                    <i data-feather="calendar"> </i>
                                </label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập Ngày có thể vào ở
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="title-item-small">
                                <b>Tiện ích cho thuê</b>
                                <i class="des">Tùy chọn tiện ích của nhà cho thuê</i>
                            </div>
                        </div>
                        <div class="col-md-12">
                                                                    <ul style="    padding: 0px;
                                    margin: 0px;
                                    display: grid;
                                    grid-template-columns: repeat(3,1fr);
                                    list-style-type: none;">
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_1" name="extensions[]" value="1">
                                            <label class="form-check-label" for="extesnion_1">
                                                <b>Có gác lửng</b>
                                            </label>
                                        </div>
                                        </li>
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_2" name="extensions[]" value="2">
                                            <label class="form-check-label" for="extesnion_2">
                                                <b>Có chỗ giữ xe</b>
                                            </label>
                                        </div>
                                        </li>
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_3" name="extensions[]" value="3">
                                            <label class="form-check-label" for="extesnion_3">
                                                <b>Toilet riêng</b>
                                            </label>
                                        </div>
                                        </li>
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_4" name="extensions[]" value="4">
                                            <label class="form-check-label" for="extesnion_4">
                                                <b>Riêng với chủ</b>
                                            </label>
                                        </div>
                                        </li>
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_5" name="extensions[]" value="5">
                                            <label class="form-check-label" for="extesnion_5">
                                                <b>Có wifi</b>
                                            </label>
                                        </div>
                                        </li>
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_6" name="extensions[]" value="6">
                                            <label class="form-check-label" for="extesnion_6">
                                                <b>Có camera an ninh</b>
                                            </label>
                                        </div>
                                        </li>
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_7" name="extensions[]" value="7">
                                            <label class="form-check-label" for="extesnion_7">
                                                <b>Được nuôi thú cưng</b>
                                            </label>
                                        </div>
                                        </li>
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_8" name="extensions[]" value="8">
                                            <label class="form-check-label" for="extesnion_8">
                                                <b>Có ban công</b>
                                            </label>
                                        </div>
                                        </li>
                                                                            <li>
                                        <div class="form-check">
                                            <input data-format="numeric" class="form-check-input" type="checkbox" id="extesnion_9" name="extensions[]" value="9">
                                            <label class="form-check-label" for="extesnion_9">
                                                <b>Có nơi sinh hoạt</b>
                                            </label>
                                        </div>
                                        </li>
                                                                        </ul>
                                                        </div>
                        <div class="col-12">
                            <div class="title-item-small">
                                <b>Quy định giờ giấc</b>
                                <i class="des">Tùy chọn thời gian hoạt động của nhà cho thuê</i>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-floating">
                                <select id="open_door" name="open_door" class="form-select form-control">
                                                                                                                        <option value="04:00:00">4 giờ sáng</option>
                                                                                    <option value="05:00:00">5 giờ sáng</option>
                                                                                    <option value="06:00:00">6 giờ sáng</option>
                                                                                                            </select>
                                <label for="open_door">Giờ mở cửa</label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-floating">
                                <select id="close_door" name="close_door" class="form-select form-control">
                                                                                                                        <option value="22:00:00">22 giờ tối</option>
                                                                                    <option value="23:00:00">23 giờ tối</option>
                                                                                    <option value="00:00:00">00 giờ sáng</option>
                                                                                                            </select>
                                <label for="close_door">Giờ đóng cửa</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="title-item-small">
                                <b>Nội quy</b>
                                <i class="des">Tùy chọn nội quy của nhà cho thuê</i>
                            </div>
                        </div>
                        <div class="col-12">
                                                            <ul style="    padding: 0px;
                                        margin: 0px;
                                        display: grid;
                                        grid-template-columns: repeat(2,1fr);
                                        list-style-type: none;">
                                                                            <li>
                                            <div class="form-check">
                                                <input data-format="numeric" class="form-check-input" type="checkbox" id="rule_1" name="rules[]" value="1">
                                                <label class="form-check-label" for="rule_1">
                                                    <b>Nhà trọ có giờ giấc không về quá khuya</b>
                                                    <p>Không về sau 12h tối</p>
                                                </label>
                                            </div>
                                        </li>
                                                                            <li>
                                            <div class="form-check">
                                                <input data-format="numeric" class="form-check-input" type="checkbox" id="rule_2" name="rules[]" value="2">
                                                <label class="form-check-label" for="rule_2">
                                                    <b>Đóng tiền trọ đúng ngày</b>
                                                    <p>Đóng tiền trọ đúng ngày</p>
                                                </label>
                                            </div>
                                        </li>
                                                                            <li>
                                            <div class="form-check">
                                                <input data-format="numeric" class="form-check-input" type="checkbox" id="rule_3" name="rules[]" value="3">
                                                <label class="form-check-label" for="rule_3">
                                                    <b>Không hút thuốc, say xỉn</b>
                                                    <p>Không tụ tập nhậu nhặt hát hò làm ảnh hưởng phòng xung quanh</p>
                                                </label>
                                            </div>
                                        </li>
                                                                            <li>
                                            <div class="form-check">
                                                <input data-format="numeric" class="form-check-input" type="checkbox" id="rule_4" name="rules[]" value="4">
                                                <label class="form-check-label" for="rule_4">
                                                    <b>Không chứa chấp tội phạm</b>
                                                    <p>Không che dấu và chứa chấp tội phạm trong phòng</p>
                                                </label>
                                            </div>
                                        </li>
                                                                            <li>
                                            <div class="form-check">
                                                <input data-format="numeric" class="form-check-input" type="checkbox" id="rule_5" name="rules[]" value="5">
                                                <label class="form-check-label" for="rule_5">
                                                    <b>Không hát karaoke, nhậu nhặt ảnh hưởng tới phòng kế bên</b>
                                                    <p>Không gây ồn ào, mất trật tự, nhậu nhặt, say xỉn...</p>
                                                </label>
                                            </div>
                                        </li>
                                                                            <li>
                                            <div class="form-check">
                                                <input data-format="numeric" class="form-check-input" type="checkbox" id="rule_6" name="rules[]" value="6">
                                                <label class="form-check-label" for="rule_6">
                                                    <b>Cư xử văn hóa</b>
                                                    <p>Không gây gỗ chữi thề, gây hiềm khích với mọi người, tạo văn hóa phòng trọ yên bình hòa đồng.</p>
                                                </label>
                                            </div>
                                        </li>
                                                                    </ul>
                                                    </div>
                        <div class="col-12">
                            <div class="title-item-small">
                                <b>Địa chỉ</b>
                                <i class="des">Vui lòng nhập địa chỉ chính xác để có thể tìm đến nhà cho thuê của bạn</i>
                            </div>
                        </div>

                        <div class="col-12">
                            <div id="post" class="address_container row g-2">
    <div class="col-6 mt-2">
        <div class="form-floating">
            <select data-format="numeric" name="province_id" class="form-select form-control province" required>
                <option value="">Tỉnh/Thành phố</option>
            </select>
            <label for="province">Chọn Tỉnh/Thành phố</label>
            <div class="invalid-feedback">
                Vui lòng chọn thành phố
            </div>
        </div>
    </div>
    <div class="col-6 mt-2">
        <div class="form-floating">
            <select data-format="numeric" name="district_id" class="form-select form-control district" required>
                <option value="">Quận/Huyện</option>
            </select>
            <label for="district">Chọn Quận/Huyện</label>
            <div class="invalid-feedback">
                Vui lòng chọn quận hoặc huyện
            </div>
        </div>
    </div>
    <div class="col-12 mt-2">
        <div class="form-floating">
            <select data-format="numeric" name="ward_id" class="form-select form-control ward" required>
                <option value="">Phường/Xã</option>
            </select>
            <label for="ward">Chọn Phường/Xã</label>
            <div class="invalid-feedback">
                Vui lòng chọn phường hoặc xã
            </div>
        </div>
    </div>
    <div class="col-12 mt-2">
        <div class="form-floating">
            <input type="text" class="form-control address_detail" name="address_detail"
                placeholder="ví dụ: 122 - Đường Nguyễn Duy Trinh" required>
            <label for="address_detail">Địa chỉ chi tiết. Ví dụ: 122 - Đường Nguyễn Duy Trinh</label>
            <div class="invalid-feedback">
                Vui lòng nhập địa chỉ chi tiết
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="address-detail-show-container" style="display: none; padding: 10px; background-color: #eee; border-radius: 5px;">
            <i data-feather="map-pin" data-feather-size="14"></i>
            <span class="address-detail-show">

            </span>
            <input style="display: none" type="text" class="form-control address" name="address"
                    placeholder="ví dụ: 122 - Đường Nguyễn Duy Trinh" required>
        </div>    
    </div>    
</div>

<script type="text/javascript">
    $(document).ready(function () {
        let __el = {
            province: $("#post").find(".province"),
            district: $("#post").find(".district"), 
            ward    : $("#post").find(".ward"),
            address_detail    : $("#post").find(".address_detail"),
            address    : $("#post").find("input[name='address']"),
            address_show_container: $("#post").find(".address-detail-show-container"),  
            address_show: $("#post").find(".address-detail-show"),  
        };

        function getAddressFull(){
            let arrayText = [
                __el.address_detail.val(),
                __el.ward.find('option:selected').text().trim(),
                __el.district.find('option:selected').text().trim(),
                __el.province.find('option:selected').text().trim() 
            ];
            if(arrayText[0].lengh !== '' && arrayText[1].lengh !== '' && arrayText[2].lengh !== '' && arrayText[3].lengh !== ''){
                __el.address_show_container.show();
                __el.address_show.text(arrayText.join(', '));
                __el.address.val(arrayText.join(', '));
            }else{
                __el.address_show_container.hide();
            }
            
        }

        __el.address_detail.keyup((e)=>{
            getAddressFull();
        });

        __el.province.change(function(){
            __el.district.empty();
            __el.ward.empty();

            $.transferData({
                url: __helper.url.urlPattern(__routeApi.location.showProvince, {
                        id : parseInt($(this).val())
                    }),
                method: 'GET',
                success:function(res){
                     __el.district.append(`<option value=''>Quận/Huyện</option>`);
                    $.each(res.data.districts, function(key, value) {
                        __el.district.append(`<option value='${value.id}'>${value.name}</option>`);
                    });
                    getAddressFull();
                }
            });
        });

        __el.district.change(function(){
            __el.ward.empty();
            $.transferData({
                url: __helper.url.urlPattern(__routeApi.location.showDistrict, {
                        id : parseInt($(this).val())
                    }),
                method: 'GET',
                success:function(res){
                    __el.ward.append(`<option value=''>Phường/Xã</option>`);
                    $.each(res.data.wards, function(key, value) {
                        __el.ward.append(`<option value='${value.id}'>${value.name}</option>`);
                    });
                    getAddressFull();
                }
            });
        });

        __el.ward.change(function(){
            getAddressFull();
        });
    });
</script> 

                        </div>

                        <div class="col-12">
                            <div class="title-item-small">
                                <b>Tọa độ</b>
                                <i class="des">Di chuyển bản đồ để xác định tọa độ</i>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input data-format="numeric" type="text" class="form-control" name="latitude" id="post-latitude" required placeholder="Kinh tuyến">
                                <label for="latitude">Kinh tuyến</label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập kinh tuyến
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input data-format="numeric" type="text" class="form-control" name="longitude" id="post-longitude" required placeholder="Vĩ tuyến">
                                <label for="longitude">Vĩ tuyến</label>
                                <div class="invalid-feedback">
                                    Vui lòng nhập vĩ tuyến
                                </div>
                            </div>
                        </div>

                        <div style="position: relative; height: 300px">
                            <img style="position: absolute;
                            left: calc(50% - 15px);
                            top: calc(50% - 22.5px);
                            width: 30px;
                            z-index: 1;" src="/householder-admin/images/pin.png" width="30px"/>
                            <div class="col-md-12" id="map-show-post" style="height: 300px;border: 1px solid #ced4da; border-radius: 5px;">
                                
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="title-item-small">
                                <b>Hình ảnh</b>
                                <i class="des">Hình ảnh về phòng cho thuê</i>
                            </div>
                        </div>
                        <div id="post-image" class="image-upload-simple" data-service="renter">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer modal-footer--sticky">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" id="submit-post" class="btn btn-primary">
                    <i data-feather="plus"> </i>
                    Thêm tin đăng
                </button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var map = null;
    function initMap() {
        map = new google.maps.Map(document.getElementById('map-show-post'), {
            zoom: 15
        });
    }

    function isValidLatitude(latitude) {
        // Kiểm tra xem latitude có nằm trong khoảng từ -90 đến 90 không
        return typeof latitude === 'number' && !isNaN(latitude) && latitude >= -90 && latitude <= 90;
    }

    function isValidLongitude(longitude) {
        // Kiểm tra xem longitude có nằm trong khoảng từ -180 đến 180 không
        return typeof longitude === 'number' && !isNaN(longitude) && longitude >= -180 && longitude <= 180;
    }

    $(document).ready(function() {
        let __el = {
            form: $('#add-post-form'),
            modal: $("#addPost"),
            submit: $('#submit-post')
        };  

        let image = $('#post-image').uploadImageSimple({
            label: 'Chọn tối đa 5 ảnh',
            name: 'images',
            error: 'Vui nhập ảnh ',
            required: false,
            multiple:true
        });

        flatpickr(__el.form.find('input[name="available_date"]'), {
            defaultDate: 'today',
            allowInput: true,
            enableTime: false,
            dateFormat: "d/m/Y",
            locale: 'vn',
            minDate: "today", 
        });

        let api = __helper.url.urlPattern(__routeApi.post.create);

        map &&
        map.addListener("center_changed", () => {
            __el.modal.find("input[name='latitude']").val(map.getCenter().lat());
            __el.modal.find("input[name='longitude']").val(map.getCenter().lng());
        });

        new __modalForm(
            __el.modal.get(0),
            __el.form.get(0),
            __el.submit.get(0)
        ).start(null, {
            __openModalForm: function({relatedTarget}) {
                cell = relatedTarget?.cell ?? null;
                postData = relatedTarget?.cell?.getData() ?? null;

                $.transferData({
                    method: "POST",
                    url: __helper.url.urlPattern(__routeApi.location.init),
                    data: {
                        'province_id': postData?.province_id ?? null,
                        'district_id': postData?.district_id ?? null,
                        'ward_id': postData?.ward_id ?? null,
                    },
                    loadingEle:false,
                    success: (res) => {
                        $.each(res.data.provinces, function(key, province) {
                            __el.modal.find(".province").append(`<option value='${province.id}'>${province.short_name}</option>`);
                            if(parseInt(province.id) === parseInt(postData?.province_id))
                                __el.modal.find(`.province option[value=${province.id}]`).prop('selected', true);
                        });

                        $.each(res.data.districts, function(key, district) {
                            __el.modal.find(".district").append(`<option value='${district.id}'>${district.name}</option>`);
                            if(parseInt(district.id) === parseInt(postData?.district_id))
                                __el.modal.find(`.district option[value=${district.id}]`).prop('selected', true);
                        });

                        $.each(res.data.wards, function(key, ward) {
                            __el.modal.find(".ward").append(`<option value='${ward.id}'>${ward.name}</option>`);
                            if(parseInt(ward.id) === parseInt(postData?.ward_id)){
                                __el.modal.find(`.ward option[value=${ward.id}]`).prop('selected', true);
                                __el.modal.find(`.ward`).trigger("change");
                            }
                        });
                    }
                });
                
                if(postData){
                    if(map){
                        if(postData?.latitude && postData?.longitude && isValidLatitude(postData.latitude) && isValidLongitude(postData.longitude))
                            map.setCenter(new google.maps.LatLng(postData.latitude, postData.longitude));
                        else
                            map.setCenter(new google.maps.LatLng(10.782912917573109, 106.69618936255574));
                    }

                    api = __helper.url.urlPattern(__routeApi.post.update, {
                        id: parseInt(postData.id)
                    })

                    __el.modal.find('.modal-title').text("Chỉnh sửa tin đăng");
                    __el.modal.find('.modal-footer .btn-primary').text("Chỉnh sửa");
                    __el.modal.find('.description-item').hide();
                    __el.modal.find("#description").removeAttr("required");

                    __el.form.setObjectToForm(postData);
                    __el.form.find('#post-status')

                    if(postData.status === 'enable')
                        __el.form.find('#post-status').prop("checked", true);
                    else
                        __el.form.find('#post-status').prop("checked", false);

                    if(postData?.rule){
                        $.each(postData.rule , function (index, rule){  
                            __el.form.find(`#rule_${rule.value}`).prop('checked', true);
                        });
                    }

                    if(postData?.extension){
                        $.each(postData.extension , function (index, extension){  
                            __el.form.find(`#extesnion_${extension.value}`).prop('checked', true);
                        });
                    }   

                    if(postData?.images){
                        image.setValue(postData.images)
                    }else{
                        image.setValue(null);
                    }
                    __el.form.find('input[name="available_date"]').get(0)._flatpickr.setDate(postData.available_date ? new Date(postData.available_date) : new Date(), true, "d/m/Y");
 
                }else{
                    api = __helper.url.urlPattern(__routeApi.post.create); 
                    image.setValue(null); 
                    
                    map &&
                    map.setCenter(new google.maps.LatLng(10.782912917573109, 106.69618936255574));

                    __el.modal.find('.description-item').show();
                    __el.modal.find("#attr").removeAttr("required");

                    __el.form.find('input[name="available_date"]').get(0)._flatpickr.setDate(new Date(), true, "d/m/Y");
                }

                __el.form.on('change', 'select', function (e) {
                    if ($(this).attr('name') === 'commission_percent') {
                        
                        let commission_percent = $(this).val()?.length === 0 ? 0 : parseInt($(this).val());
                        let roomAmount =__el.form.find('#post-room-amount').val() === "" ? 0 : parseFloat(__el.form.find('#post-room-amount').val().replace(/\./g, ""));
                        let commissionAmount = roomAmount;
    
                        commissionAmount = (roomAmount * commission_percent)/100;

                        __el.form.find('#commission_amount').val(__format.currencyInput(commissionAmount));
                    }
                });

                __el.form.on('keyup', 'input', function (e) {
                    if ($(this).attr('name') === 'room_amount') {
                        if(__el.form.find("#commission_percent").val().length !== 0){
                            let commission_percent = parseInt(__el.form.find("#commission_percent").val());
                            let roomAmount =__el.form.find('#post-room-amount').val() === "" ? 0 : parseFloat(__el.form.find('#post-room-amount').val().replace(/\./g, ""));
                            let commissionAmount = roomAmount;
        
                            commissionAmount = (roomAmount * commission_percent)/100;
        
                            __el.form.find('#commission_amount').val(__format.currencyInput(commissionAmount));
                        }
                    }
                })
                   
   
            },
            __closeModalForm: function () {
                __el.form.get(0).reset();
                __el.form.get(0).classList.remove('was-validated');

                __el.modal.find('.modal-title').text("Thêm tin đăng");
                __el.modal.find('.modal-footer .btn-primary').text("Thêm tin đăng");
            },
            __submitModalForm: function({relatedTarget}) {
                let data = __el.form.getObjectOfForm();

                data.source = 'web_admin_owner';

                if (!__el.form.get(0).checkValidity()) {
                    $('#add-post-form').get(0).classList.add('was-validated');
                    Swal.fire({
                        title: 'Thông báo!',
                        text: "Vui lòng nhập đầy đủ thông tin trước khi thực hiện",
                        icon: 'error',
                        confirmButtonText: 'Đã hiểu'
                    });
                    return false;
                }
            
                if(image?.value)
                    data.images = image.value
                else{
                    Swal.fire({
                        title: 'Thông báo!',
                        text: "Vui lòng thêm ít nhất 1 hình ảnh về phòng cho thuê",
                        icon: 'error',
                        confirmButtonText: 'Đã hiểu'
                    });
                    return false;
                }

                $.transferData({
                    method: "POST",
                    url: api,
                    data,
                    success: function(res) {
                        if(postData){
                            Swal.fire({
                                title: 'Thành công!',
                                text: res.message,
                                icon: 'success',
                                confirmButtonColor: '#3c9e47',
                                confirmButtonText: 'Đã hiểu'
                            }).then((result)=>{
                                bootstrap.Modal.getInstance(__el.modal.get(0)).hide();
                            });
                        }else{
                            Swal.fire({
                                title: 'Thông báo!',
                                text: res.message,
                                icon: 'success',
                                confirmButtonText: 'Tiếp tục tạo mới',
                                confirmButtonColor: '#3c9e47',
                                showCancelButton: true,
                                cancelButtonText: 'Kết thúc',
                            }).then((result) => {
                                if (!result.isConfirmed)
                                    bootstrap.Modal.getInstance(__el.modal.get(0)).hide();
                            });
                        }

                        res.data && window.postsTable &&
                                    window.postsTable.updateOrAddData([res.data]);
                        
                    },
                    fail: (res) => {
                        Swal.fire({
                            title: 'Thông báo!',
                            text: res.message,
                            icon: 'error',
                            confirmButtonText: 'Đã hiểu'
                        });
                    }
                });
            },
        });

        
    });
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCpQX4H0QPxVgKuNMZ0ELG_ymgT8RHcKh4&callback=initMap"></script>

                </div>
                <div id="customer-from-lozido" class="container tab-pane fade">
                    <div row>
    <div id="potential-list" class="celled">
        <div style="border-radius: 10px;">
    <div style="border-radius: 10px; padding: 30px; text-align:center">
        <img width="200px"
             src="https://quanlytro.me/images/empty-box-4085812-3385481.webp"/>
        <h4>Chưa có khách thuê tiềm năng nào phù hợp với tin đăng của bạn!</h4>
            </div>
</div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var __el = {
            table: $("#potential-list"),
        };

        var tableDataInit = {};
        var tableData = {};
        let columns = {};

         //Build Tabulator
        let table = new Tabulator(__el.table.get(0), {
            index:'id',
            layout: "fitColumns",
            resizableColumnFit:true,
            //enable reactive data
            reactiveData: true,
            height: false,
            movableRows: true,
            columnHeaderVertAlign: 'middle',
            selectable: false,
            placeholder: `<div class="empty-table" style="margin: auto; display: inline-grid;"><img width="300px" src="https://quanlytro.me/images/empty-box-4085812-3385481.webp" />Không tìm thấy dữ liệu!</div>`
        });

        window.potentialTable = table;

        const prepareColumns = function (column) {
            if (column?.cellClick && typeof commonCellClick[column?.cellClick] !== "undefined")
                column.cellClick = commonCellClick[column?.cellClick];
            
            if (!column?.cssClass) {
                if (column?.editor) {
                    column.cssClass = "edit_enable"
                } else {
                    column.cssClass = "edit_disable";
                }
            } 
            return column;
        };

        const loadData = (filter = null) => $.transferData({
            method: "GET",
            data: {
                filter: filter ?? null
            },
            url: __helper.url.urlPattern(__routeApi.potential.list),
            success: (res) => {
                if (res?.data?.columns) {
                    columns = res?.data?.columns;
                    tableData = res?.data?.customers;

                    columns.map((column) => {
                        prepareColumns(column);
                        if (column?.columns && column.columns.length > 0) {
                            column.columns.map((col, index_col) => {
                                column.columns[index_col] = prepareColumns(col);
                            });
                        }
                        return column;
                    });

                    tableDataInit = JSON.parse(JSON.stringify(tableData));

                    table.setColumns(columns);
                    table.setData(tableData);
                }
            },
            error: (e) => {
                Swal.fire({
                    title: 'Thông báo!',
                    text: 'Đã có lỗi trong quán trình tải danh sách'+e,
                    icon: 'error',
                    confirmButtonText: 'Đã hiểu'
                });
            }
        });

        var tabEl = document.querySelector('#post-tab a.potential');
        tabEl.addEventListener('shown.bs.tab', function (event) {
            loadData(null);
        });
    })
</script>                </div>
            </div>
        </div>
    </div>
</div>
    </div>
    <div class="text-center mt-5"><span style="color: #727272; font-style: italic;">Copyright @ <strong style="color: #000">HPT-NTMT</strong> 2020</span></div>
<div class="text-center"><p style="color: #727272; font-style: italic;">Version <strong style="color: #000">1.3.8</strong></p></div>
<div class="zalo-container fix item-contact">
    <a id="zalo-btn"
       href="https://zalo.me/0965227453"
       target="_blank" rel="noopener">
        <div class="animated_zalo infinite zoomIn_zalo cmoz-alo-circle"></div>
        <div class="animated_zalo infinite pulse_zalo cmoz-alo-circle-fill"></div>
        <span>
            <img width="100%"
                   src="https://quanlytro.me/images/icons/zalo-icon-white.webp"
                   alt="Liên hệ với LOZIDO - Quản lý nhà cho thuê qua Zalo">
        </span>
    </a>
</div>

<script>
    feather.replace();

    $(document).ready(function () {
        $(document).find('input[data-format="numeric"][type="text"]').map((key, element) => {
            element.addEventListener('keyup', e => {
                let value = $(element).val();
                let number = __helper.convertStringToNumber(value);
                let newVal = __format.currencyInput(number);
                
                $(element).val(value ==='' ? '': isNaN(number) ? '': newVal);
            });
        });

        $(document).find('input[data-format="stringNumber"]').map((key, element) => {
            element.addEventListener('keyup', e => {
                $(element).val(__format.phone($(element).val()));
            });
        });

        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });

        setTimeout(() => {
                $.transferData({
                    url: __helper.url.urlPattern(__routeApi.notification.all,{
                        page: 1
                    }),
                    loadingEle:false,
                    success: (res) => {
                        $('.count-notification').text(res?.data?.unread_count ?? 0);
                        res?.data?.notifications?.length > 0 &&
                        $(".notication-dropdown").html('') &&
                        res.data.notifications.map((notification)=>{
                            $(".notication-dropdown").append($(`
                                <li style="cursor: pointer" class="item-notication d-flex align-items-center">
                                        <div class="icon ${!notification?.read_at ? 'not-read':''}">
                                            <i data-feather="bell" size="20"></i>
                                        </div>
                                        <div class="content">
                                            <div class="des">
                                                <b>
                                                    ${notification?.data?.title ?? ''}
                                                </b>
                                                <p>${notification?.data?.body ?? ''}</p>
                                            </div>
                                            <div class="time">${notification?.created_at ?? ''}</div>
                                        </div>
                                </li>
                            `).click((e)=>{
                                Swal.fire({
                                    title: 'Thông báo!',
                                    text: "Tính năng đi đến thông báo đang phát triển. Hệ thống sẽ hoàn thành sớm!",
                                    icon: 'warning',
                                    confirmButtonText: 'Đã hiểu'
                                });
                            }));
                        });
                        feather.replace();
                    },
                    fail:(res)=>{

                    }
            });
        }, 5000);
       
    });
</script>
</body>

</html>
